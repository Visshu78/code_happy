
 /*
  * JsSIP 3.11.1
  * The Javascript SIP library
  * Copyright: 2012-2026 José Luis Millán <jmillan@aliax.net> (https://github.com/jmillan) Iñaki Baz Castillo <ibc@aliax.net> (https://inakibaz.me)
  * Homepage: https://jssip.net
  * License: MIT
  */
var JsSIP=(()=>{var W=(f,l)=>()=>(l||f((l={exports:{}}).exports,l),l.exports);var er=W((Cf,lo)=>{lo.exports={name:"jssip",title:"JsSIP",description:"The Javascript SIP library",version:"3.11.1",homepage:"https://jssip.net",contributors:["Jos\xE9 Luis Mill\xE1n <jmillan@aliax.net> (https://github.com/jmillan)","I\xF1aki Baz Castillo <ibc@aliax.net> (https://inakibaz.me)"],types:"src/JsSIP.d.ts",main:"src/JsSIP.js",keywords:["sip","websocket","webrtc","node","browser","library"],license:"MIT",repository:{type:"git",url:"https://github.com/versatica/JsSIP.git"},bugs:{url:"https://github.com/versatica/JsSIP/issues"},dependencies:{debug:"^4.3.1",events:"^3.3.0","sdp-transform":"^2.14.1"},devDependencies:{"@eslint/eslintrc":"^3.3.3","@eslint/js":"^9.39.2","@types/debug":"^4.1.12","@types/events":"^3.0.3",esbuild:"^0.27.2",eslint:"^9.39.1","eslint-plugin-jest":"^29.12.1",globals:"^17.0.0",jest:"^30.2.0",pegjs:"^0.7.0"},scripts:{lint:"node npm-scripts.js lint",test:"node npm-scripts.js test",build:"node npm-scripts.js build",release:"node npm-scripts.js release"}}});var le=W((Ef,Pn)=>{var Un=er();Pn.exports={USER_AGENT:"".concat(Un.title," ").concat(Un.version),SIP:"sip",SIPS:"sips",causes:{CONNECTION_ERROR:"Connection Error",REQUEST_TIMEOUT:"Request Timeout",SIP_FAILURE_CODE:"SIP Failure Code",INTERNAL_ERROR:"Internal Error",BUSY:"Busy",REJECTED:"Rejected",REDIRECTED:"Redirected",UNAVAILABLE:"Unavailable",NOT_FOUND:"Not Found",ADDRESS_INCOMPLETE:"Address Incomplete",INCOMPATIBLE_SDP:"Incompatible SDP",MISSING_SDP:"Missing SDP",AUTHENTICATION_ERROR:"Authentication Error",BYE:"Terminated",WEBRTC_ERROR:"WebRTC Error",CANCELED:"Canceled",NO_ANSWER:"No Answer",EXPIRES:"Expires",NO_ACK:"No ACK",DIALOG_ERROR:"Dialog Error",USER_DENIED_MEDIA_ACCESS:"User Denied Media Access",BAD_MEDIA_DESCRIPTION:"Bad Media Description",RTP_TIMEOUT:"RTP Timeout"},SIP_ERROR_CAUSES:{REDIRECTED:[300,301,302,305,380],BUSY:[486,600],REJECTED:[403,603],NOT_FOUND:[404,604],UNAVAILABLE:[480,410,408,430],ADDRESS_INCOMPLETE:[484,424],INCOMPATIBLE_SDP:[488,606],AUTHENTICATION_ERROR:[401,407]},ACK:"ACK",BYE:"BYE",CANCEL:"CANCEL",INFO:"INFO",INVITE:"INVITE",MESSAGE:"MESSAGE",NOTIFY:"NOTIFY",OPTIONS:"OPTIONS",REGISTER:"REGISTER",REFER:"REFER",UPDATE:"UPDATE",SUBSCRIBE:"SUBSCRIBE",DTMF_TRANSPORT:{INFO:"INFO",RFC2833:"RFC2833"},REASON_PHRASE:{100:"Trying",180:"Ringing",181:"Call Is Being Forwarded",182:"Queued",183:"Session Progress",199:"Early Dialog Terminated",200:"OK",202:"Accepted",204:"No Notification",300:"Multiple Choices",301:"Moved Permanently",302:"Moved Temporarily",305:"Use Proxy",380:"Alternative Service",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",410:"Gone",412:"Conditional Request Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Unsupported URI Scheme",417:"Unknown Resource-Priority",420:"Bad Extension",421:"Extension Required",422:"Session Interval Too Small",423:"Interval Too Brief",424:"Bad Location Information",428:"Use Identity Header",429:"Provide Referrer Identity",430:"Flow Failed",433:"Anonymity Disallowed",436:"Bad Identity-Info",437:"Unsupported Certificate",438:"Invalid Identity Header",439:"First Hop Lacks Outbound Support",440:"Max-Breadth Exceeded",469:"Bad Info Package",470:"Consent Needed",478:"Unresolvable Destination",480:"Temporarily Unavailable",481:"Call/Transaction Does Not Exist",482:"Loop Detected",483:"Too Many Hops",484:"Address Incomplete",485:"Ambiguous",486:"Busy Here",487:"Request Terminated",488:"Not Acceptable Here",489:"Bad Event",491:"Request Pending",493:"Undecipherable",494:"Security Agreement Required",500:"JsSIP Internal Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Server Time-out",505:"Version Not Supported",513:"Message Too Large",580:"Precondition Failure",600:"Busy Everywhere",603:"Decline",604:"Does Not Exist Anywhere",606:"Not Acceptable"},ALLOWED_METHODS:"INVITE,ACK,CANCEL,BYE,UPDATE,MESSAGE,OPTIONS,REFER,INFO,NOTIFY",ACCEPTED_BODY_TYPES:"application/sdp, application/dtmf-relay",MAX_FORWARDS:69,SESSION_EXPIRES:90,MIN_SESSION_EXPIRES:60,CONNECTION_RECOVERY_MAX_INTERVAL:30,CONNECTION_RECOVERY_MIN_INTERVAL:2}});var He=W((Af,Ln)=>{var tr=class extends Error{constructor(l,s){super(),this.code=1,this.name="CONFIGURATION_ERROR",this.parameter=l,this.value=s,this.message=this.value?"Invalid value ".concat(JSON.stringify(this.value),' for parameter "').concat(this.parameter,'"'):"Missing parameter: ".concat(this.parameter)}},sr=class extends Error{constructor(l){super(),this.code=2,this.name="INVALID_STATE_ERROR",this.status=l,this.message="Invalid status: ".concat(l)}},rr=class extends Error{constructor(l){super(),this.code=3,this.name="NOT_SUPPORTED_ERROR",this.message=l}},lr=class extends Error{constructor(l){super(),this.code=4,this.name="NOT_READY_ERROR",this.message=l}};Ln.exports={ConfigurationError:tr,InvalidStateError:sr,NotSupportedError:rr,NotReadyError:lr}});var us=W((Sf,Fn)=>{var no=qe(),io=Re();Fn.exports=class Mn{static parse(l){if(l=io.parse(l,"Name_Addr_Header"),l!==-1)return l}constructor(l,s,a){if(!l||!(l instanceof no))throw new TypeError('missing or invalid "uri" parameter');this._uri=l,this._parameters={},this.display_name=s;for(let h in a)Object.prototype.hasOwnProperty.call(a,h)&&this.setParam(h,a[h])}get uri(){return this._uri}get display_name(){return this._display_name}set display_name(l){this._display_name=l===0?"0":l}setParam(l,s){l&&(this._parameters[l.toLowerCase()]=typeof s=="undefined"||s===null?null:s.toString())}getParam(l){if(l)return this._parameters[l.toLowerCase()]}hasParam(l){if(l)return this._parameters.hasOwnProperty(l.toLowerCase())&&!0||!1}deleteParam(l){if(l=l.toLowerCase(),this._parameters.hasOwnProperty(l)){let s=this._parameters[l];return delete this._parameters[l],s}}clearParams(){this._parameters={}}clone(){return new Mn(this._uri.clone(),this._display_name,JSON.parse(JSON.stringify(this._parameters)))}_quote(l){return l.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}toString(){let l=this._display_name?'"'.concat(this._quote(this._display_name),'" '):"";l+="<".concat(this._uri.toString(),">");for(let s in this._parameters)Object.prototype.hasOwnProperty.call(this._parameters,s)&&(l+=";".concat(s),this._parameters[s]!==null&&(l+="=".concat(this._parameters[s])));return l}}});var Re=W((vf,Hn)=>{Hn.exports=(function(){function f(s){return'"'+s.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E-\x1F\x80-\uFFFF]/g,escape)+'"'}var l={parse:function(s,a){var h={CRLF:$,DIGIT:x,ALPHA:O,HEXDIG:w,WSP:H,OCTET:fe,DQUOTE:se,SP:ne,HTAB:y,alphanum:b,reserved:I,unreserved:R,mark:we,escaped:Z,LWS:re,SWS:K,HCOLON:Ve,TEXT_UTF8_TRIM:je,TEXT_UTF8char:Ae,UTF8_NONASCII:ve,UTF8_CONT:ye,LHEX:rt,token:F,token_nodot:Le,separators:lt,word:Ie,STAR:Ke,SLASH:Me,EQUAL:Y,LPAREN:G,RPAREN:q,RAQUOT:V,LAQUOT:j,COMMA:B,SEMI:k,COLON:ee,LDQUOT:Be,RDQUOT:Te,comment:ys,ctext:Is,quoted_string:Bt,quoted_string_clean:Tt,qdtext:Ct,quoted_pair:Ye,SIP_URI_noparams:Et,SIP_URI:Wt,uri_scheme:Ns,uri_scheme_sips:Wr,uri_scheme_sip:Vr,userinfo:Vt,user:jr,user_unreserved:Os,password:Kr,hostport:jt,host:At,hostname:xs,domainlabel:Ds,toplabel:Yr,IPv6reference:Us,IPv6address:Ps,h16:P,ls32:Ce,IPv4address:St,dec_octet:vt,port:zr,uri_parameters:Jr,uri_parameter:Ls,transport_param:Xr,user_param:Qr,method_param:Zr,ttl_param:el,maddr_param:tl,lr_param:sl,other_param:rl,pname:ll,pvalue:nl,paramchar:Rt,param_unreserved:il,headers:ul,header:Kt,hname:ol,hvalue:al,hnv_unreserved:bt,Request_Response:Eu,Request_Line:fl,Request_URI:cl,absoluteURI:Ms,hier_part:hl,net_path:dl,abs_path:Yt,opaque_part:_l,uric:wt,uric_no_slash:pl,path_segments:ml,segment:zt,param:Fs,pchar:yt,scheme:gl,authority:Tl,srvr:Cl,reg_name:El,query:Al,SIP_Version:Hs,INVITEm:Sl,ACKm:vl,OPTIONSm:Rl,BYEm:bl,CANCELm:wl,REGISTERm:yl,SUBSCRIBEm:Il,NOTIFYm:Nl,REFERm:Ol,Method:Jt,Status_Line:xl,Status_Code:Dl,extension_code:Ul,Reason_Phrase:Pl,Allow_Events:Au,Call_ID:Su,Contact:vu,contact_param:Xt,name_addr:ze,display_name:Qt,contact_params:qs,c_p_q:Ll,c_p_expires:Ml,delta_seconds:Je,qvalue:Fl,generic_param:ie,gen_value:Hl,Content_Disposition:Ru,disp_type:ql,disp_param:$s,handling_param:$l,Content_Encoding:bu,Content_Length:wu,Content_Type:yu,media_type:kl,m_type:Gl,discrete_type:Bl,composite_type:Wl,extension_token:Zt,x_token:Vl,m_subtype:jl,m_parameter:ks,m_value:Kl,CSeq:Iu,CSeq_value:Yl,Expires:Nu,Event:Ou,event_type:It,From:xu,from_param:Gs,tag_param:Bs,Max_Forwards:Du,Min_Expires:Uu,Name_Addr_Header:Pu,Proxy_Authenticate:Lu,challenge:Ws,other_challenge:zl,auth_param:Nt,digest_cln:es,realm:Jl,realm_value:Xl,domain:Ql,URI:ts,nonce:Zl,nonce_value:en,opaque:tn,stale:sn,algorithm:rn,qop_options:ln,qop_value:ss,Proxy_Require:Mu,Record_Route:Fu,rec_route:rs,Reason:Hu,reason_param:Vs,reason_cause:nn,Require:qu,Route:$u,route_param:ls,Subscription_State:ku,substate_value:un,subexp_params:js,event_reason_value:on,Subject:Gu,Supported:Bu,To:Wu,to_param:Ks,Via:Vu,via_param:ns,via_params:Ys,via_ttl:an,via_maddr:fn,via_received:cn,via_branch:hn,response_port:dn,rport:_n,sent_protocol:pn,protocol_name:mn,transport:gn,sent_by:Tn,via_host:Cn,via_port:En,ttl:zs,WWW_Authenticate:ju,Session_Expires:Ku,s_e_expires:An,s_e_params:Js,s_e_refresher:Sn,extension_header:Yu,header_value:vn,message_body:zu,uuid_URI:Ju,uuid:Rn,hex4:Fe,hex8:bn,hex12:wn,Refer_To:Xu,Replaces:Qu,call_id:yn,replaces_param:Xs,to_tag:In,from_tag:Nn,early_flag:On};if(a!==void 0){if(h[a]===void 0)throw new Error("Invalid rule name: "+f(a)+".")}else a="CRLF";var t=0,u=0,p=0,g=[];function S(e,r,n){for(var i=e,o=n-e.length,d=0;d<o;d++)i=r+i;return i}function N(e){var r=e.charCodeAt(0),n,i;return r<=255?(n="x",i=2):(n="u",i=4),"\\"+n+S(r.toString(16).toUpperCase(),"0",i)}function c(e){t<p||(t>p&&(p=t,g=[]),g.push(e))}function $(){var e;return s.substr(t,2)==="\r\n"?(e="\r\n",t+=2):(e=null,u===0&&c('"\\r\\n"')),e}function x(){var e;return/^[0-9]/.test(s.charAt(t))?(e=s.charAt(t),t++):(e=null,u===0&&c("[0-9]")),e}function O(){var e;return/^[a-zA-Z]/.test(s.charAt(t))?(e=s.charAt(t),t++):(e=null,u===0&&c("[a-zA-Z]")),e}function w(){var e;return/^[0-9a-fA-F]/.test(s.charAt(t))?(e=s.charAt(t),t++):(e=null,u===0&&c("[0-9a-fA-F]")),e}function H(){var e;return e=ne(),e===null&&(e=y()),e}function fe(){var e;return/^[\0-\xFF]/.test(s.charAt(t))?(e=s.charAt(t),t++):(e=null,u===0&&c("[\\0-\\xFF]")),e}function se(){var e;return/^["]/.test(s.charAt(t))?(e=s.charAt(t),t++):(e=null,u===0&&c('["]')),e}function ne(){var e;return s.charCodeAt(t)===32?(e=" ",t++):(e=null,u===0&&c('" "')),e}function y(){var e;return s.charCodeAt(t)===9?(e="	",t++):(e=null,u===0&&c('"\\t"')),e}function b(){var e;return/^[a-zA-Z0-9]/.test(s.charAt(t))?(e=s.charAt(t),t++):(e=null,u===0&&c("[a-zA-Z0-9]")),e}function I(){var e;return s.charCodeAt(t)===59?(e=";",t++):(e=null,u===0&&c('";"')),e===null&&(s.charCodeAt(t)===47?(e="/",t++):(e=null,u===0&&c('"/"')),e===null&&(s.charCodeAt(t)===63?(e="?",t++):(e=null,u===0&&c('"?"')),e===null&&(s.charCodeAt(t)===58?(e=":",t++):(e=null,u===0&&c('":"')),e===null&&(s.charCodeAt(t)===64?(e="@",t++):(e=null,u===0&&c('"@"')),e===null&&(s.charCodeAt(t)===38?(e="&",t++):(e=null,u===0&&c('"&"')),e===null&&(s.charCodeAt(t)===61?(e="=",t++):(e=null,u===0&&c('"="')),e===null&&(s.charCodeAt(t)===43?(e="+",t++):(e=null,u===0&&c('"+"')),e===null&&(s.charCodeAt(t)===36?(e="$",t++):(e=null,u===0&&c('"$"')),e===null&&(s.charCodeAt(t)===44?(e=",",t++):(e=null,u===0&&c('","'))))))))))),e}function R(){var e;return e=b(),e===null&&(e=we()),e}function we(){var e;return s.charCodeAt(t)===45?(e="-",t++):(e=null,u===0&&c('"-"')),e===null&&(s.charCodeAt(t)===95?(e="_",t++):(e=null,u===0&&c('"_"')),e===null&&(s.charCodeAt(t)===46?(e=".",t++):(e=null,u===0&&c('"."')),e===null&&(s.charCodeAt(t)===33?(e="!",t++):(e=null,u===0&&c('"!"')),e===null&&(s.charCodeAt(t)===126?(e="~",t++):(e=null,u===0&&c('"~"')),e===null&&(s.charCodeAt(t)===42?(e="*",t++):(e=null,u===0&&c('"*"')),e===null&&(s.charCodeAt(t)===39?(e="'",t++):(e=null,u===0&&c('"\'"')),e===null&&(s.charCodeAt(t)===40?(e="(",t++):(e=null,u===0&&c('"("')),e===null&&(s.charCodeAt(t)===41?(e=")",t++):(e=null,u===0&&c('")"')))))))))),e}function Z(){var e,r,n,i,o;return i=t,o=t,s.charCodeAt(t)===37?(e="%",t++):(e=null,u===0&&c('"%"')),e!==null?(r=w(),r!==null?(n=w(),n!==null?e=[e,r,n]:(e=null,t=o)):(e=null,t=o)):(e=null,t=o),e!==null&&(e=(function(d,_){return _.join("")})(i,e)),e===null&&(t=i),e}function re(){var e,r,n,i,o,d;for(i=t,o=t,d=t,e=[],r=H();r!==null;)e.push(r),r=H();if(e!==null?(r=$(),r!==null?e=[e,r]:(e=null,t=d)):(e=null,t=d),e=e!==null?e:"",e!==null){if(n=H(),n!==null)for(r=[];n!==null;)r.push(n),n=H();else r=null;r!==null?e=[e,r]:(e=null,t=o)}else e=null,t=o;return e!==null&&(e=(function(_){return" "})(i)),e===null&&(t=i),e}function K(){var e;return e=re(),e=e!==null?e:"",e}function Ve(){var e,r,n,i,o;for(i=t,o=t,e=[],r=ne(),r===null&&(r=y());r!==null;)e.push(r),r=ne(),r===null&&(r=y());return e!==null?(s.charCodeAt(t)===58?(r=":",t++):(r=null,u===0&&c('":"')),r!==null?(n=K(),n!==null?e=[e,r,n]:(e=null,t=o)):(e=null,t=o)):(e=null,t=o),e!==null&&(e=(function(d){return":"})(i)),e===null&&(t=i),e}function je(){var e,r,n,i,o,d,_;if(o=t,d=t,r=Ae(),r!==null)for(e=[];r!==null;)e.push(r),r=Ae();else e=null;if(e!==null){for(r=[],_=t,n=[],i=re();i!==null;)n.push(i),i=re();for(n!==null?(i=Ae(),i!==null?n=[n,i]:(n=null,t=_)):(n=null,t=_);n!==null;){for(r.push(n),_=t,n=[],i=re();i!==null;)n.push(i),i=re();n!==null?(i=Ae(),i!==null?n=[n,i]:(n=null,t=_)):(n=null,t=_)}r!==null?e=[e,r]:(e=null,t=d)}else e=null,t=d;return e!==null&&(e=(function(T){return s.substring(t,T)})(o)),e===null&&(t=o),e}function Ae(){var e;return/^[!-~]/.test(s.charAt(t))?(e=s.charAt(t),t++):(e=null,u===0&&c("[!-~]")),e===null&&(e=ve()),e}function ve(){var e;return/^[\x80-\uFFFF]/.test(s.charAt(t))?(e=s.charAt(t),t++):(e=null,u===0&&c("[\\x80-\\uFFFF]")),e}function ye(){var e;return/^[\x80-\xBF]/.test(s.charAt(t))?(e=s.charAt(t),t++):(e=null,u===0&&c("[\\x80-\\xBF]")),e}function rt(){var e;return e=x(),e===null&&(/^[a-f]/.test(s.charAt(t))?(e=s.charAt(t),t++):(e=null,u===0&&c("[a-f]"))),e}function F(){var e,r,n;if(n=t,r=b(),r===null&&(s.charCodeAt(t)===45?(r="-",t++):(r=null,u===0&&c('"-"')),r===null&&(s.charCodeAt(t)===46?(r=".",t++):(r=null,u===0&&c('"."')),r===null&&(s.charCodeAt(t)===33?(r="!",t++):(r=null,u===0&&c('"!"')),r===null&&(s.charCodeAt(t)===37?(r="%",t++):(r=null,u===0&&c('"%"')),r===null&&(s.charCodeAt(t)===42?(r="*",t++):(r=null,u===0&&c('"*"')),r===null&&(s.charCodeAt(t)===95?(r="_",t++):(r=null,u===0&&c('"_"')),r===null&&(s.charCodeAt(t)===43?(r="+",t++):(r=null,u===0&&c('"+"')),r===null&&(s.charCodeAt(t)===96?(r="`",t++):(r=null,u===0&&c('"`"')),r===null&&(s.charCodeAt(t)===39?(r="'",t++):(r=null,u===0&&c('"\'"')),r===null&&(s.charCodeAt(t)===126?(r="~",t++):(r=null,u===0&&c('"~"')))))))))))),r!==null)for(e=[];r!==null;)e.push(r),r=b(),r===null&&(s.charCodeAt(t)===45?(r="-",t++):(r=null,u===0&&c('"-"')),r===null&&(s.charCodeAt(t)===46?(r=".",t++):(r=null,u===0&&c('"."')),r===null&&(s.charCodeAt(t)===33?(r="!",t++):(r=null,u===0&&c('"!"')),r===null&&(s.charCodeAt(t)===37?(r="%",t++):(r=null,u===0&&c('"%"')),r===null&&(s.charCodeAt(t)===42?(r="*",t++):(r=null,u===0&&c('"*"')),r===null&&(s.charCodeAt(t)===95?(r="_",t++):(r=null,u===0&&c('"_"')),r===null&&(s.charCodeAt(t)===43?(r="+",t++):(r=null,u===0&&c('"+"')),r===null&&(s.charCodeAt(t)===96?(r="`",t++):(r=null,u===0&&c('"`"')),r===null&&(s.charCodeAt(t)===39?(r="'",t++):(r=null,u===0&&c('"\'"')),r===null&&(s.charCodeAt(t)===126?(r="~",t++):(r=null,u===0&&c('"~"'))))))))))));else e=null;return e!==null&&(e=(function(i){return s.substring(t,i)})(n)),e===null&&(t=n),e}function Le(){var e,r,n;if(n=t,r=b(),r===null&&(s.charCodeAt(t)===45?(r="-",t++):(r=null,u===0&&c('"-"')),r===null&&(s.charCodeAt(t)===33?(r="!",t++):(r=null,u===0&&c('"!"')),r===null&&(s.charCodeAt(t)===37?(r="%",t++):(r=null,u===0&&c('"%"')),r===null&&(s.charCodeAt(t)===42?(r="*",t++):(r=null,u===0&&c('"*"')),r===null&&(s.charCodeAt(t)===95?(r="_",t++):(r=null,u===0&&c('"_"')),r===null&&(s.charCodeAt(t)===43?(r="+",t++):(r=null,u===0&&c('"+"')),r===null&&(s.charCodeAt(t)===96?(r="`",t++):(r=null,u===0&&c('"`"')),r===null&&(s.charCodeAt(t)===39?(r="'",t++):(r=null,u===0&&c('"\'"')),r===null&&(s.charCodeAt(t)===126?(r="~",t++):(r=null,u===0&&c('"~"'))))))))))),r!==null)for(e=[];r!==null;)e.push(r),r=b(),r===null&&(s.charCodeAt(t)===45?(r="-",t++):(r=null,u===0&&c('"-"')),r===null&&(s.charCodeAt(t)===33?(r="!",t++):(r=null,u===0&&c('"!"')),r===null&&(s.charCodeAt(t)===37?(r="%",t++):(r=null,u===0&&c('"%"')),r===null&&(s.charCodeAt(t)===42?(r="*",t++):(r=null,u===0&&c('"*"')),r===null&&(s.charCodeAt(t)===95?(r="_",t++):(r=null,u===0&&c('"_"')),r===null&&(s.charCodeAt(t)===43?(r="+",t++):(r=null,u===0&&c('"+"')),r===null&&(s.charCodeAt(t)===96?(r="`",t++):(r=null,u===0&&c('"`"')),r===null&&(s.charCodeAt(t)===39?(r="'",t++):(r=null,u===0&&c('"\'"')),r===null&&(s.charCodeAt(t)===126?(r="~",t++):(r=null,u===0&&c('"~"')))))))))));else e=null;return e!==null&&(e=(function(i){return s.substring(t,i)})(n)),e===null&&(t=n),e}function lt(){var e;return s.charCodeAt(t)===40?(e="(",t++):(e=null,u===0&&c('"("')),e===null&&(s.charCodeAt(t)===41?(e=")",t++):(e=null,u===0&&c('")"')),e===null&&(s.charCodeAt(t)===60?(e="<",t++):(e=null,u===0&&c('"<"')),e===null&&(s.charCodeAt(t)===62?(e=">",t++):(e=null,u===0&&c('">"')),e===null&&(s.charCodeAt(t)===64?(e="@",t++):(e=null,u===0&&c('"@"')),e===null&&(s.charCodeAt(t)===44?(e=",",t++):(e=null,u===0&&c('","')),e===null&&(s.charCodeAt(t)===59?(e=";",t++):(e=null,u===0&&c('";"')),e===null&&(s.charCodeAt(t)===58?(e=":",t++):(e=null,u===0&&c('":"')),e===null&&(s.charCodeAt(t)===92?(e="\\",t++):(e=null,u===0&&c('"\\\\"')),e===null&&(e=se(),e===null&&(s.charCodeAt(t)===47?(e="/",t++):(e=null,u===0&&c('"/"')),e===null&&(s.charCodeAt(t)===91?(e="[",t++):(e=null,u===0&&c('"["')),e===null&&(s.charCodeAt(t)===93?(e="]",t++):(e=null,u===0&&c('"]"')),e===null&&(s.charCodeAt(t)===63?(e="?",t++):(e=null,u===0&&c('"?"')),e===null&&(s.charCodeAt(t)===61?(e="=",t++):(e=null,u===0&&c('"="')),e===null&&(s.charCodeAt(t)===123?(e="{",t++):(e=null,u===0&&c('"{"')),e===null&&(s.charCodeAt(t)===125?(e="}",t++):(e=null,u===0&&c('"}"')),e===null&&(e=ne(),e===null&&(e=y())))))))))))))))))),e}function Ie(){var e,r,n;if(n=t,r=b(),r===null&&(s.charCodeAt(t)===45?(r="-",t++):(r=null,u===0&&c('"-"')),r===null&&(s.charCodeAt(t)===46?(r=".",t++):(r=null,u===0&&c('"."')),r===null&&(s.charCodeAt(t)===33?(r="!",t++):(r=null,u===0&&c('"!"')),r===null&&(s.charCodeAt(t)===37?(r="%",t++):(r=null,u===0&&c('"%"')),r===null&&(s.charCodeAt(t)===42?(r="*",t++):(r=null,u===0&&c('"*"')),r===null&&(s.charCodeAt(t)===95?(r="_",t++):(r=null,u===0&&c('"_"')),r===null&&(s.charCodeAt(t)===43?(r="+",t++):(r=null,u===0&&c('"+"')),r===null&&(s.charCodeAt(t)===96?(r="`",t++):(r=null,u===0&&c('"`"')),r===null&&(s.charCodeAt(t)===39?(r="'",t++):(r=null,u===0&&c('"\'"')),r===null&&(s.charCodeAt(t)===126?(r="~",t++):(r=null,u===0&&c('"~"')),r===null&&(s.charCodeAt(t)===40?(r="(",t++):(r=null,u===0&&c('"("')),r===null&&(s.charCodeAt(t)===41?(r=")",t++):(r=null,u===0&&c('")"')),r===null&&(s.charCodeAt(t)===60?(r="<",t++):(r=null,u===0&&c('"<"')),r===null&&(s.charCodeAt(t)===62?(r=">",t++):(r=null,u===0&&c('">"')),r===null&&(s.charCodeAt(t)===58?(r=":",t++):(r=null,u===0&&c('":"')),r===null&&(s.charCodeAt(t)===92?(r="\\",t++):(r=null,u===0&&c('"\\\\"')),r===null&&(r=se(),r===null&&(s.charCodeAt(t)===47?(r="/",t++):(r=null,u===0&&c('"/"')),r===null&&(s.charCodeAt(t)===91?(r="[",t++):(r=null,u===0&&c('"["')),r===null&&(s.charCodeAt(t)===93?(r="]",t++):(r=null,u===0&&c('"]"')),r===null&&(s.charCodeAt(t)===63?(r="?",t++):(r=null,u===0&&c('"?"')),r===null&&(s.charCodeAt(t)===123?(r="{",t++):(r=null,u===0&&c('"{"')),r===null&&(s.charCodeAt(t)===125?(r="}",t++):(r=null,u===0&&c('"}"'))))))))))))))))))))))))),r!==null)for(e=[];r!==null;)e.push(r),r=b(),r===null&&(s.charCodeAt(t)===45?(r="-",t++):(r=null,u===0&&c('"-"')),r===null&&(s.charCodeAt(t)===46?(r=".",t++):(r=null,u===0&&c('"."')),r===null&&(s.charCodeAt(t)===33?(r="!",t++):(r=null,u===0&&c('"!"')),r===null&&(s.charCodeAt(t)===37?(r="%",t++):(r=null,u===0&&c('"%"')),r===null&&(s.charCodeAt(t)===42?(r="*",t++):(r=null,u===0&&c('"*"')),r===null&&(s.charCodeAt(t)===95?(r="_",t++):(r=null,u===0&&c('"_"')),r===null&&(s.charCodeAt(t)===43?(r="+",t++):(r=null,u===0&&c('"+"')),r===null&&(s.charCodeAt(t)===96?(r="`",t++):(r=null,u===0&&c('"`"')),r===null&&(s.charCodeAt(t)===39?(r="'",t++):(r=null,u===0&&c('"\'"')),r===null&&(s.charCodeAt(t)===126?(r="~",t++):(r=null,u===0&&c('"~"')),r===null&&(s.charCodeAt(t)===40?(r="(",t++):(r=null,u===0&&c('"("')),r===null&&(s.charCodeAt(t)===41?(r=")",t++):(r=null,u===0&&c('")"')),r===null&&(s.charCodeAt(t)===60?(r="<",t++):(r=null,u===0&&c('"<"')),r===null&&(s.charCodeAt(t)===62?(r=">",t++):(r=null,u===0&&c('">"')),r===null&&(s.charCodeAt(t)===58?(r=":",t++):(r=null,u===0&&c('":"')),r===null&&(s.charCodeAt(t)===92?(r="\\",t++):(r=null,u===0&&c('"\\\\"')),r===null&&(r=se(),r===null&&(s.charCodeAt(t)===47?(r="/",t++):(r=null,u===0&&c('"/"')),r===null&&(s.charCodeAt(t)===91?(r="[",t++):(r=null,u===0&&c('"["')),r===null&&(s.charCodeAt(t)===93?(r="]",t++):(r=null,u===0&&c('"]"')),r===null&&(s.charCodeAt(t)===63?(r="?",t++):(r=null,u===0&&c('"?"')),r===null&&(s.charCodeAt(t)===123?(r="{",t++):(r=null,u===0&&c('"{"')),r===null&&(s.charCodeAt(t)===125?(r="}",t++):(r=null,u===0&&c('"}"')))))))))))))))))))))))));else e=null;return e!==null&&(e=(function(i){return s.substring(t,i)})(n)),e===null&&(t=n),e}function Ke(){var e,r,n,i,o;return i=t,o=t,e=K(),e!==null?(s.charCodeAt(t)===42?(r="*",t++):(r=null,u===0&&c('"*"')),r!==null?(n=K(),n!==null?e=[e,r,n]:(e=null,t=o)):(e=null,t=o)):(e=null,t=o),e!==null&&(e=(function(d){return"*"})(i)),e===null&&(t=i),e}function Me(){var e,r,n,i,o;return i=t,o=t,e=K(),e!==null?(s.charCodeAt(t)===47?(r="/",t++):(r=null,u===0&&c('"/"')),r!==null?(n=K(),n!==null?e=[e,r,n]:(e=null,t=o)):(e=null,t=o)):(e=null,t=o),e!==null&&(e=(function(d){return"/"})(i)),e===null&&(t=i),e}function Y(){var e,r,n,i,o;return i=t,o=t,e=K(),e!==null?(s.charCodeAt(t)===61?(r="=",t++):(r=null,u===0&&c('"="')),r!==null?(n=K(),n!==null?e=[e,r,n]:(e=null,t=o)):(e=null,t=o)):(e=null,t=o),e!==null&&(e=(function(d){return"="})(i)),e===null&&(t=i),e}function G(){var e,r,n,i,o;return i=t,o=t,e=K(),e!==null?(s.charCodeAt(t)===40?(r="(",t++):(r=null,u===0&&c('"("')),r!==null?(n=K(),n!==null?e=[e,r,n]:(e=null,t=o)):(e=null,t=o)):(e=null,t=o),e!==null&&(e=(function(d){return"("})(i)),e===null&&(t=i),e}function q(){var e,r,n,i,o;return i=t,o=t,e=K(),e!==null?(s.charCodeAt(t)===41?(r=")",t++):(r=null,u===0&&c('")"')),r!==null?(n=K(),n!==null?e=[e,r,n]:(e=null,t=o)):(e=null,t=o)):(e=null,t=o),e!==null&&(e=(function(d){return")"})(i)),e===null&&(t=i),e}function V(){var e,r,n,i;return n=t,i=t,s.charCodeAt(t)===62?(e=">",t++):(e=null,u===0&&c('">"')),e!==null?(r=K(),r!==null?e=[e,r]:(e=null,t=i)):(e=null,t=i),e!==null&&(e=(function(o){return">"})(n)),e===null&&(t=n),e}function j(){var e,r,n,i;return n=t,i=t,e=K(),e!==null?(s.charCodeAt(t)===60?(r="<",t++):(r=null,u===0&&c('"<"')),r!==null?e=[e,r]:(e=null,t=i)):(e=null,t=i),e!==null&&(e=(function(o){return"<"})(n)),e===null&&(t=n),e}function B(){var e,r,n,i,o;return i=t,o=t,e=K(),e!==null?(s.charCodeAt(t)===44?(r=",",t++):(r=null,u===0&&c('","')),r!==null?(n=K(),n!==null?e=[e,r,n]:(e=null,t=o)):(e=null,t=o)):(e=null,t=o),e!==null&&(e=(function(d){return","})(i)),e===null&&(t=i),e}function k(){var e,r,n,i,o;return i=t,o=t,e=K(),e!==null?(s.charCodeAt(t)===59?(r=";",t++):(r=null,u===0&&c('";"')),r!==null?(n=K(),n!==null?e=[e,r,n]:(e=null,t=o)):(e=null,t=o)):(e=null,t=o),e!==null&&(e=(function(d){return";"})(i)),e===null&&(t=i),e}function ee(){var e,r,n,i,o;return i=t,o=t,e=K(),e!==null?(s.charCodeAt(t)===58?(r=":",t++):(r=null,u===0&&c('":"')),r!==null?(n=K(),n!==null?e=[e,r,n]:(e=null,t=o)):(e=null,t=o)):(e=null,t=o),e!==null&&(e=(function(d){return":"})(i)),e===null&&(t=i),e}function Be(){var e,r,n,i;return n=t,i=t,e=K(),e!==null?(r=se(),r!==null?e=[e,r]:(e=null,t=i)):(e=null,t=i),e!==null&&(e=(function(o){return'"'})(n)),e===null&&(t=n),e}function Te(){var e,r,n,i;return n=t,i=t,e=se(),e!==null?(r=K(),r!==null?e=[e,r]:(e=null,t=i)):(e=null,t=i),e!==null&&(e=(function(o){return'"'})(n)),e===null&&(t=n),e}function ys(){var e,r,n,i;if(i=t,e=G(),e!==null){for(r=[],n=Is(),n===null&&(n=Ye(),n===null&&(n=ys()));n!==null;)r.push(n),n=Is(),n===null&&(n=Ye(),n===null&&(n=ys()));r!==null?(n=q(),n!==null?e=[e,r,n]:(e=null,t=i)):(e=null,t=i)}else e=null,t=i;return e}function Is(){var e;return/^[!-']/.test(s.charAt(t))?(e=s.charAt(t),t++):(e=null,u===0&&c("[!-']")),e===null&&(/^[*-[]/.test(s.charAt(t))?(e=s.charAt(t),t++):(e=null,u===0&&c("[*-[]")),e===null&&(/^[\]-~]/.test(s.charAt(t))?(e=s.charAt(t),t++):(e=null,u===0&&c("[\\]-~]")),e===null&&(e=ve(),e===null&&(e=re())))),e}function Bt(){var e,r,n,i,o,d;if(o=t,d=t,e=K(),e!==null)if(r=se(),r!==null){for(n=[],i=Ct(),i===null&&(i=Ye());i!==null;)n.push(i),i=Ct(),i===null&&(i=Ye());n!==null?(i=se(),i!==null?e=[e,r,n,i]:(e=null,t=d)):(e=null,t=d)}else e=null,t=d;else e=null,t=d;return e!==null&&(e=(function(_){return s.substring(t,_)})(o)),e===null&&(t=o),e}function Tt(){var e,r,n,i,o,d;if(o=t,d=t,e=K(),e!==null)if(r=se(),r!==null){for(n=[],i=Ct(),i===null&&(i=Ye());i!==null;)n.push(i),i=Ct(),i===null&&(i=Ye());n!==null?(i=se(),i!==null?e=[e,r,n,i]:(e=null,t=d)):(e=null,t=d)}else e=null,t=d;else e=null,t=d;return e!==null&&(e=(function(_){var T=s.substring(t,_).trim();return T.substring(1,T.length-1).replace(/\\([\x00-\x09\x0b-\x0c\x0e-\x7f])/g,"$1")})(o)),e===null&&(t=o),e}function Ct(){var e;return e=re(),e===null&&(s.charCodeAt(t)===33?(e="!",t++):(e=null,u===0&&c('"!"')),e===null&&(/^[#-[]/.test(s.charAt(t))?(e=s.charAt(t),t++):(e=null,u===0&&c("[#-[]")),e===null&&(/^[\]-~]/.test(s.charAt(t))?(e=s.charAt(t),t++):(e=null,u===0&&c("[\\]-~]")),e===null&&(e=ve())))),e}function Ye(){var e,r,n;return n=t,s.charCodeAt(t)===92?(e="\\",t++):(e=null,u===0&&c('"\\\\"')),e!==null?(/^[\0-\t]/.test(s.charAt(t))?(r=s.charAt(t),t++):(r=null,u===0&&c("[\\0-\\t]")),r===null&&(/^[\x0B-\f]/.test(s.charAt(t))?(r=s.charAt(t),t++):(r=null,u===0&&c("[\\x0B-\\f]")),r===null&&(/^[\x0E-]/.test(s.charAt(t))?(r=s.charAt(t),t++):(r=null,u===0&&c("[\\x0E-\x7F]")))),r!==null?e=[e,r]:(e=null,t=n)):(e=null,t=n),e}function Et(){var e,r,n,i,o,d;return o=t,d=t,e=Ns(),e!==null?(s.charCodeAt(t)===58?(r=":",t++):(r=null,u===0&&c('":"')),r!==null?(n=Vt(),n=n!==null?n:"",n!==null?(i=jt(),i!==null?e=[e,r,n,i]:(e=null,t=d)):(e=null,t=d)):(e=null,t=d)):(e=null,t=d),e!==null&&(e=(function(_){try{m.uri=new xn(m.scheme,m.user,m.host,m.port),delete m.scheme,delete m.user,delete m.host,delete m.host_type,delete m.port}catch(T){m=-1}})(o)),e===null&&(t=o),e}function Wt(){var e,r,n,i,o,d,_,T;return _=t,T=t,e=Ns(),e!==null?(s.charCodeAt(t)===58?(r=":",t++):(r=null,u===0&&c('":"')),r!==null?(n=Vt(),n=n!==null?n:"",n!==null?(i=jt(),i!==null?(o=Jr(),o!==null?(d=ul(),d=d!==null?d:"",d!==null?e=[e,r,n,i,o,d]:(e=null,t=T)):(e=null,t=T)):(e=null,t=T)):(e=null,t=T)):(e=null,t=T)):(e=null,t=T),e!==null&&(e=(function(A){var M;try{m.uri=new xn(m.scheme,m.user,m.host,m.port,m.uri_params,m.uri_headers),delete m.scheme,delete m.user,delete m.host,delete m.host_type,delete m.port,delete m.uri_params,a==="SIP_URI"&&(m=m.uri)}catch(J){m=-1}})(_)),e===null&&(t=_),e}function Ns(){var e;return e=Wr(),e===null&&(e=Vr()),e}function Wr(){var e,r;return r=t,s.substr(t,4).toLowerCase()==="sips"?(e=s.substr(t,4),t+=4):(e=null,u===0&&c('"sips"')),e!==null&&(e=(function(n,i){m.scheme=i.toLowerCase()})(r,e)),e===null&&(t=r),e}function Vr(){var e,r;return r=t,s.substr(t,3).toLowerCase()==="sip"?(e=s.substr(t,3),t+=3):(e=null,u===0&&c('"sip"')),e!==null&&(e=(function(n,i){m.scheme=i.toLowerCase()})(r,e)),e===null&&(t=r),e}function Vt(){var e,r,n,i,o,d;return i=t,o=t,e=jr(),e!==null?(d=t,s.charCodeAt(t)===58?(r=":",t++):(r=null,u===0&&c('":"')),r!==null?(n=Kr(),n!==null?r=[r,n]:(r=null,t=d)):(r=null,t=d),r=r!==null?r:"",r!==null?(s.charCodeAt(t)===64?(n="@",t++):(n=null,u===0&&c('"@"')),n!==null?e=[e,r,n]:(e=null,t=o)):(e=null,t=o)):(e=null,t=o),e!==null&&(e=(function(_){m.user=decodeURIComponent(s.substring(t-1,_))})(i)),e===null&&(t=i),e}function jr(){var e,r;if(r=R(),r===null&&(r=Z(),r===null&&(r=Os())),r!==null)for(e=[];r!==null;)e.push(r),r=R(),r===null&&(r=Z(),r===null&&(r=Os()));else e=null;return e}function Os(){var e;return s.charCodeAt(t)===38?(e="&",t++):(e=null,u===0&&c('"&"')),e===null&&(s.charCodeAt(t)===61?(e="=",t++):(e=null,u===0&&c('"="')),e===null&&(s.charCodeAt(t)===43?(e="+",t++):(e=null,u===0&&c('"+"')),e===null&&(s.charCodeAt(t)===36?(e="$",t++):(e=null,u===0&&c('"$"')),e===null&&(s.charCodeAt(t)===44?(e=",",t++):(e=null,u===0&&c('","')),e===null&&(s.charCodeAt(t)===59?(e=";",t++):(e=null,u===0&&c('";"')),e===null&&(s.charCodeAt(t)===63?(e="?",t++):(e=null,u===0&&c('"?"')),e===null&&(s.charCodeAt(t)===47?(e="/",t++):(e=null,u===0&&c('"/"'))))))))),e}function Kr(){var e,r,n;for(n=t,e=[],r=R(),r===null&&(r=Z(),r===null&&(s.charCodeAt(t)===38?(r="&",t++):(r=null,u===0&&c('"&"')),r===null&&(s.charCodeAt(t)===61?(r="=",t++):(r=null,u===0&&c('"="')),r===null&&(s.charCodeAt(t)===43?(r="+",t++):(r=null,u===0&&c('"+"')),r===null&&(s.charCodeAt(t)===36?(r="$",t++):(r=null,u===0&&c('"$"')),r===null&&(s.charCodeAt(t)===44?(r=",",t++):(r=null,u===0&&c('","'))))))));r!==null;)e.push(r),r=R(),r===null&&(r=Z(),r===null&&(s.charCodeAt(t)===38?(r="&",t++):(r=null,u===0&&c('"&"')),r===null&&(s.charCodeAt(t)===61?(r="=",t++):(r=null,u===0&&c('"="')),r===null&&(s.charCodeAt(t)===43?(r="+",t++):(r=null,u===0&&c('"+"')),r===null&&(s.charCodeAt(t)===36?(r="$",t++):(r=null,u===0&&c('"$"')),r===null&&(s.charCodeAt(t)===44?(r=",",t++):(r=null,u===0&&c('","'))))))));return e!==null&&(e=(function(i){m.password=s.substring(t,i)})(n)),e===null&&(t=n),e}function jt(){var e,r,n,i,o;return i=t,e=At(),e!==null?(o=t,s.charCodeAt(t)===58?(r=":",t++):(r=null,u===0&&c('":"')),r!==null?(n=zr(),n!==null?r=[r,n]:(r=null,t=o)):(r=null,t=o),r=r!==null?r:"",r!==null?e=[e,r]:(e=null,t=i)):(e=null,t=i),e}function At(){var e,r;return r=t,e=xs(),e===null&&(e=St(),e===null&&(e=Us())),e!==null&&(e=(function(n){return m.host=s.substring(t,n).toLowerCase(),m.host})(r)),e===null&&(t=r),e}function xs(){var e,r,n,i,o,d;for(i=t,o=t,e=[],d=t,r=Ds(),r!==null?(s.charCodeAt(t)===46?(n=".",t++):(n=null,u===0&&c('"."')),n!==null?r=[r,n]:(r=null,t=d)):(r=null,t=d);r!==null;)e.push(r),d=t,r=Ds(),r!==null?(s.charCodeAt(t)===46?(n=".",t++):(n=null,u===0&&c('"."')),n!==null?r=[r,n]:(r=null,t=d)):(r=null,t=d);return e!==null?(r=Yr(),r!==null?(s.charCodeAt(t)===46?(n=".",t++):(n=null,u===0&&c('"."')),n=n!==null?n:"",n!==null?e=[e,r,n]:(e=null,t=o)):(e=null,t=o)):(e=null,t=o),e!==null&&(e=(function(_){return m.host_type="domain",s.substring(t,_)})(i)),e===null&&(t=i),e}function Ds(){var e,r,n,i;if(i=t,e=b(),e!==null){for(r=[],n=b(),n===null&&(s.charCodeAt(t)===45?(n="-",t++):(n=null,u===0&&c('"-"')),n===null&&(s.charCodeAt(t)===95?(n="_",t++):(n=null,u===0&&c('"_"'))));n!==null;)r.push(n),n=b(),n===null&&(s.charCodeAt(t)===45?(n="-",t++):(n=null,u===0&&c('"-"')),n===null&&(s.charCodeAt(t)===95?(n="_",t++):(n=null,u===0&&c('"_"'))));r!==null?e=[e,r]:(e=null,t=i)}else e=null,t=i;return e}function Yr(){var e,r,n,i;if(i=t,e=O(),e!==null){for(r=[],n=b(),n===null&&(s.charCodeAt(t)===45?(n="-",t++):(n=null,u===0&&c('"-"')),n===null&&(s.charCodeAt(t)===95?(n="_",t++):(n=null,u===0&&c('"_"'))));n!==null;)r.push(n),n=b(),n===null&&(s.charCodeAt(t)===45?(n="-",t++):(n=null,u===0&&c('"-"')),n===null&&(s.charCodeAt(t)===95?(n="_",t++):(n=null,u===0&&c('"_"'))));r!==null?e=[e,r]:(e=null,t=i)}else e=null,t=i;return e}function Us(){var e,r,n,i,o;return i=t,o=t,s.charCodeAt(t)===91?(e="[",t++):(e=null,u===0&&c('"["')),e!==null?(r=Ps(),r!==null?(s.charCodeAt(t)===93?(n="]",t++):(n=null,u===0&&c('"]"')),n!==null?e=[e,r,n]:(e=null,t=o)):(e=null,t=o)):(e=null,t=o),e!==null&&(e=(function(d){return m.host_type="IPv6",s.substring(t,d)})(i)),e===null&&(t=i),e}function Ps(){var e,r,n,i,o,d,_,T,A,M,J,Ne,is,Zs,C,L;return Zs=t,C=t,e=P(),e!==null?(s.charCodeAt(t)===58?(r=":",t++):(r=null,u===0&&c('":"')),r!==null?(n=P(),n!==null?(s.charCodeAt(t)===58?(i=":",t++):(i=null,u===0&&c('":"')),i!==null?(o=P(),o!==null?(s.charCodeAt(t)===58?(d=":",t++):(d=null,u===0&&c('":"')),d!==null?(_=P(),_!==null?(s.charCodeAt(t)===58?(T=":",t++):(T=null,u===0&&c('":"')),T!==null?(A=P(),A!==null?(s.charCodeAt(t)===58?(M=":",t++):(M=null,u===0&&c('":"')),M!==null?(J=P(),J!==null?(s.charCodeAt(t)===58?(Ne=":",t++):(Ne=null,u===0&&c('":"')),Ne!==null?(is=Ce(),is!==null?e=[e,r,n,i,o,d,_,T,A,M,J,Ne,is]:(e=null,t=C)):(e=null,t=C)):(e=null,t=C)):(e=null,t=C)):(e=null,t=C)):(e=null,t=C)):(e=null,t=C)):(e=null,t=C)):(e=null,t=C)):(e=null,t=C)):(e=null,t=C)):(e=null,t=C)):(e=null,t=C),e===null&&(C=t,s.substr(t,2)==="::"?(e="::",t+=2):(e=null,u===0&&c('"::"')),e!==null?(r=P(),r!==null?(s.charCodeAt(t)===58?(n=":",t++):(n=null,u===0&&c('":"')),n!==null?(i=P(),i!==null?(s.charCodeAt(t)===58?(o=":",t++):(o=null,u===0&&c('":"')),o!==null?(d=P(),d!==null?(s.charCodeAt(t)===58?(_=":",t++):(_=null,u===0&&c('":"')),_!==null?(T=P(),T!==null?(s.charCodeAt(t)===58?(A=":",t++):(A=null,u===0&&c('":"')),A!==null?(M=P(),M!==null?(s.charCodeAt(t)===58?(J=":",t++):(J=null,u===0&&c('":"')),J!==null?(Ne=Ce(),Ne!==null?e=[e,r,n,i,o,d,_,T,A,M,J,Ne]:(e=null,t=C)):(e=null,t=C)):(e=null,t=C)):(e=null,t=C)):(e=null,t=C)):(e=null,t=C)):(e=null,t=C)):(e=null,t=C)):(e=null,t=C)):(e=null,t=C)):(e=null,t=C)):(e=null,t=C),e===null&&(C=t,s.substr(t,2)==="::"?(e="::",t+=2):(e=null,u===0&&c('"::"')),e!==null?(r=P(),r!==null?(s.charCodeAt(t)===58?(n=":",t++):(n=null,u===0&&c('":"')),n!==null?(i=P(),i!==null?(s.charCodeAt(t)===58?(o=":",t++):(o=null,u===0&&c('":"')),o!==null?(d=P(),d!==null?(s.charCodeAt(t)===58?(_=":",t++):(_=null,u===0&&c('":"')),_!==null?(T=P(),T!==null?(s.charCodeAt(t)===58?(A=":",t++):(A=null,u===0&&c('":"')),A!==null?(M=Ce(),M!==null?e=[e,r,n,i,o,d,_,T,A,M]:(e=null,t=C)):(e=null,t=C)):(e=null,t=C)):(e=null,t=C)):(e=null,t=C)):(e=null,t=C)):(e=null,t=C)):(e=null,t=C)):(e=null,t=C)):(e=null,t=C),e===null&&(C=t,s.substr(t,2)==="::"?(e="::",t+=2):(e=null,u===0&&c('"::"')),e!==null?(r=P(),r!==null?(s.charCodeAt(t)===58?(n=":",t++):(n=null,u===0&&c('":"')),n!==null?(i=P(),i!==null?(s.charCodeAt(t)===58?(o=":",t++):(o=null,u===0&&c('":"')),o!==null?(d=P(),d!==null?(s.charCodeAt(t)===58?(_=":",t++):(_=null,u===0&&c('":"')),_!==null?(T=Ce(),T!==null?e=[e,r,n,i,o,d,_,T]:(e=null,t=C)):(e=null,t=C)):(e=null,t=C)):(e=null,t=C)):(e=null,t=C)):(e=null,t=C)):(e=null,t=C)):(e=null,t=C),e===null&&(C=t,s.substr(t,2)==="::"?(e="::",t+=2):(e=null,u===0&&c('"::"')),e!==null?(r=P(),r!==null?(s.charCodeAt(t)===58?(n=":",t++):(n=null,u===0&&c('":"')),n!==null?(i=P(),i!==null?(s.charCodeAt(t)===58?(o=":",t++):(o=null,u===0&&c('":"')),o!==null?(d=Ce(),d!==null?e=[e,r,n,i,o,d]:(e=null,t=C)):(e=null,t=C)):(e=null,t=C)):(e=null,t=C)):(e=null,t=C)):(e=null,t=C),e===null&&(C=t,s.substr(t,2)==="::"?(e="::",t+=2):(e=null,u===0&&c('"::"')),e!==null?(r=P(),r!==null?(s.charCodeAt(t)===58?(n=":",t++):(n=null,u===0&&c('":"')),n!==null?(i=Ce(),i!==null?e=[e,r,n,i]:(e=null,t=C)):(e=null,t=C)):(e=null,t=C)):(e=null,t=C),e===null&&(C=t,s.substr(t,2)==="::"?(e="::",t+=2):(e=null,u===0&&c('"::"')),e!==null?(r=Ce(),r!==null?e=[e,r]:(e=null,t=C)):(e=null,t=C),e===null&&(C=t,s.substr(t,2)==="::"?(e="::",t+=2):(e=null,u===0&&c('"::"')),e!==null?(r=P(),r!==null?e=[e,r]:(e=null,t=C)):(e=null,t=C),e===null&&(C=t,e=P(),e!==null?(s.substr(t,2)==="::"?(r="::",t+=2):(r=null,u===0&&c('"::"')),r!==null?(n=P(),n!==null?(s.charCodeAt(t)===58?(i=":",t++):(i=null,u===0&&c('":"')),i!==null?(o=P(),o!==null?(s.charCodeAt(t)===58?(d=":",t++):(d=null,u===0&&c('":"')),d!==null?(_=P(),_!==null?(s.charCodeAt(t)===58?(T=":",t++):(T=null,u===0&&c('":"')),T!==null?(A=P(),A!==null?(s.charCodeAt(t)===58?(M=":",t++):(M=null,u===0&&c('":"')),M!==null?(J=Ce(),J!==null?e=[e,r,n,i,o,d,_,T,A,M,J]:(e=null,t=C)):(e=null,t=C)):(e=null,t=C)):(e=null,t=C)):(e=null,t=C)):(e=null,t=C)):(e=null,t=C)):(e=null,t=C)):(e=null,t=C)):(e=null,t=C)):(e=null,t=C),e===null&&(C=t,e=P(),e!==null?(L=t,s.charCodeAt(t)===58?(r=":",t++):(r=null,u===0&&c('":"')),r!==null?(n=P(),n!==null?r=[r,n]:(r=null,t=L)):(r=null,t=L),r=r!==null?r:"",r!==null?(s.substr(t,2)==="::"?(n="::",t+=2):(n=null,u===0&&c('"::"')),n!==null?(i=P(),i!==null?(s.charCodeAt(t)===58?(o=":",t++):(o=null,u===0&&c('":"')),o!==null?(d=P(),d!==null?(s.charCodeAt(t)===58?(_=":",t++):(_=null,u===0&&c('":"')),_!==null?(T=P(),T!==null?(s.charCodeAt(t)===58?(A=":",t++):(A=null,u===0&&c('":"')),A!==null?(M=Ce(),M!==null?e=[e,r,n,i,o,d,_,T,A,M]:(e=null,t=C)):(e=null,t=C)):(e=null,t=C)):(e=null,t=C)):(e=null,t=C)):(e=null,t=C)):(e=null,t=C)):(e=null,t=C)):(e=null,t=C)):(e=null,t=C),e===null&&(C=t,e=P(),e!==null?(L=t,s.charCodeAt(t)===58?(r=":",t++):(r=null,u===0&&c('":"')),r!==null?(n=P(),n!==null?r=[r,n]:(r=null,t=L)):(r=null,t=L),r=r!==null?r:"",r!==null?(L=t,s.charCodeAt(t)===58?(n=":",t++):(n=null,u===0&&c('":"')),n!==null?(i=P(),i!==null?n=[n,i]:(n=null,t=L)):(n=null,t=L),n=n!==null?n:"",n!==null?(s.substr(t,2)==="::"?(i="::",t+=2):(i=null,u===0&&c('"::"')),i!==null?(o=P(),o!==null?(s.charCodeAt(t)===58?(d=":",t++):(d=null,u===0&&c('":"')),d!==null?(_=P(),_!==null?(s.charCodeAt(t)===58?(T=":",t++):(T=null,u===0&&c('":"')),T!==null?(A=Ce(),A!==null?e=[e,r,n,i,o,d,_,T,A]:(e=null,t=C)):(e=null,t=C)):(e=null,t=C)):(e=null,t=C)):(e=null,t=C)):(e=null,t=C)):(e=null,t=C)):(e=null,t=C)):(e=null,t=C),e===null&&(C=t,e=P(),e!==null?(L=t,s.charCodeAt(t)===58?(r=":",t++):(r=null,u===0&&c('":"')),r!==null?(n=P(),n!==null?r=[r,n]:(r=null,t=L)):(r=null,t=L),r=r!==null?r:"",r!==null?(L=t,s.charCodeAt(t)===58?(n=":",t++):(n=null,u===0&&c('":"')),n!==null?(i=P(),i!==null?n=[n,i]:(n=null,t=L)):(n=null,t=L),n=n!==null?n:"",n!==null?(L=t,s.charCodeAt(t)===58?(i=":",t++):(i=null,u===0&&c('":"')),i!==null?(o=P(),o!==null?i=[i,o]:(i=null,t=L)):(i=null,t=L),i=i!==null?i:"",i!==null?(s.substr(t,2)==="::"?(o="::",t+=2):(o=null,u===0&&c('"::"')),o!==null?(d=P(),d!==null?(s.charCodeAt(t)===58?(_=":",t++):(_=null,u===0&&c('":"')),_!==null?(T=Ce(),T!==null?e=[e,r,n,i,o,d,_,T]:(e=null,t=C)):(e=null,t=C)):(e=null,t=C)):(e=null,t=C)):(e=null,t=C)):(e=null,t=C)):(e=null,t=C)):(e=null,t=C),e===null&&(C=t,e=P(),e!==null?(L=t,s.charCodeAt(t)===58?(r=":",t++):(r=null,u===0&&c('":"')),r!==null?(n=P(),n!==null?r=[r,n]:(r=null,t=L)):(r=null,t=L),r=r!==null?r:"",r!==null?(L=t,s.charCodeAt(t)===58?(n=":",t++):(n=null,u===0&&c('":"')),n!==null?(i=P(),i!==null?n=[n,i]:(n=null,t=L)):(n=null,t=L),n=n!==null?n:"",n!==null?(L=t,s.charCodeAt(t)===58?(i=":",t++):(i=null,u===0&&c('":"')),i!==null?(o=P(),o!==null?i=[i,o]:(i=null,t=L)):(i=null,t=L),i=i!==null?i:"",i!==null?(L=t,s.charCodeAt(t)===58?(o=":",t++):(o=null,u===0&&c('":"')),o!==null?(d=P(),d!==null?o=[o,d]:(o=null,t=L)):(o=null,t=L),o=o!==null?o:"",o!==null?(s.substr(t,2)==="::"?(d="::",t+=2):(d=null,u===0&&c('"::"')),d!==null?(_=Ce(),_!==null?e=[e,r,n,i,o,d,_]:(e=null,t=C)):(e=null,t=C)):(e=null,t=C)):(e=null,t=C)):(e=null,t=C)):(e=null,t=C)):(e=null,t=C),e===null&&(C=t,e=P(),e!==null?(L=t,s.charCodeAt(t)===58?(r=":",t++):(r=null,u===0&&c('":"')),r!==null?(n=P(),n!==null?r=[r,n]:(r=null,t=L)):(r=null,t=L),r=r!==null?r:"",r!==null?(L=t,s.charCodeAt(t)===58?(n=":",t++):(n=null,u===0&&c('":"')),n!==null?(i=P(),i!==null?n=[n,i]:(n=null,t=L)):(n=null,t=L),n=n!==null?n:"",n!==null?(L=t,s.charCodeAt(t)===58?(i=":",t++):(i=null,u===0&&c('":"')),i!==null?(o=P(),o!==null?i=[i,o]:(i=null,t=L)):(i=null,t=L),i=i!==null?i:"",i!==null?(L=t,s.charCodeAt(t)===58?(o=":",t++):(o=null,u===0&&c('":"')),o!==null?(d=P(),d!==null?o=[o,d]:(o=null,t=L)):(o=null,t=L),o=o!==null?o:"",o!==null?(L=t,s.charCodeAt(t)===58?(d=":",t++):(d=null,u===0&&c('":"')),d!==null?(_=P(),_!==null?d=[d,_]:(d=null,t=L)):(d=null,t=L),d=d!==null?d:"",d!==null?(s.substr(t,2)==="::"?(_="::",t+=2):(_=null,u===0&&c('"::"')),_!==null?(T=P(),T!==null?e=[e,r,n,i,o,d,_,T]:(e=null,t=C)):(e=null,t=C)):(e=null,t=C)):(e=null,t=C)):(e=null,t=C)):(e=null,t=C)):(e=null,t=C)):(e=null,t=C),e===null&&(C=t,e=P(),e!==null?(L=t,s.charCodeAt(t)===58?(r=":",t++):(r=null,u===0&&c('":"')),r!==null?(n=P(),n!==null?r=[r,n]:(r=null,t=L)):(r=null,t=L),r=r!==null?r:"",r!==null?(L=t,s.charCodeAt(t)===58?(n=":",t++):(n=null,u===0&&c('":"')),n!==null?(i=P(),i!==null?n=[n,i]:(n=null,t=L)):(n=null,t=L),n=n!==null?n:"",n!==null?(L=t,s.charCodeAt(t)===58?(i=":",t++):(i=null,u===0&&c('":"')),i!==null?(o=P(),o!==null?i=[i,o]:(i=null,t=L)):(i=null,t=L),i=i!==null?i:"",i!==null?(L=t,s.charCodeAt(t)===58?(o=":",t++):(o=null,u===0&&c('":"')),o!==null?(d=P(),d!==null?o=[o,d]:(o=null,t=L)):(o=null,t=L),o=o!==null?o:"",o!==null?(L=t,s.charCodeAt(t)===58?(d=":",t++):(d=null,u===0&&c('":"')),d!==null?(_=P(),_!==null?d=[d,_]:(d=null,t=L)):(d=null,t=L),d=d!==null?d:"",d!==null?(L=t,s.charCodeAt(t)===58?(_=":",t++):(_=null,u===0&&c('":"')),_!==null?(T=P(),T!==null?_=[_,T]:(_=null,t=L)):(_=null,t=L),_=_!==null?_:"",_!==null?(s.substr(t,2)==="::"?(T="::",t+=2):(T=null,u===0&&c('"::"')),T!==null?e=[e,r,n,i,o,d,_,T]:(e=null,t=C)):(e=null,t=C)):(e=null,t=C)):(e=null,t=C)):(e=null,t=C)):(e=null,t=C)):(e=null,t=C)):(e=null,t=C))))))))))))))),e!==null&&(e=(function(ro){return m.host_type="IPv6",s.substring(t,ro)})(Zs)),e===null&&(t=Zs),e}function P(){var e,r,n,i,o;return o=t,e=w(),e!==null?(r=w(),r=r!==null?r:"",r!==null?(n=w(),n=n!==null?n:"",n!==null?(i=w(),i=i!==null?i:"",i!==null?e=[e,r,n,i]:(e=null,t=o)):(e=null,t=o)):(e=null,t=o)):(e=null,t=o),e}function Ce(){var e,r,n,i;return i=t,e=P(),e!==null?(s.charCodeAt(t)===58?(r=":",t++):(r=null,u===0&&c('":"')),r!==null?(n=P(),n!==null?e=[e,r,n]:(e=null,t=i)):(e=null,t=i)):(e=null,t=i),e===null&&(e=St()),e}function St(){var e,r,n,i,o,d,_,T,A;return T=t,A=t,e=vt(),e!==null?(s.charCodeAt(t)===46?(r=".",t++):(r=null,u===0&&c('"."')),r!==null?(n=vt(),n!==null?(s.charCodeAt(t)===46?(i=".",t++):(i=null,u===0&&c('"."')),i!==null?(o=vt(),o!==null?(s.charCodeAt(t)===46?(d=".",t++):(d=null,u===0&&c('"."')),d!==null?(_=vt(),_!==null?e=[e,r,n,i,o,d,_]:(e=null,t=A)):(e=null,t=A)):(e=null,t=A)):(e=null,t=A)):(e=null,t=A)):(e=null,t=A)):(e=null,t=A),e!==null&&(e=(function(M){return m.host_type="IPv4",s.substring(t,M)})(T)),e===null&&(t=T),e}function vt(){var e,r,n,i;return i=t,s.substr(t,2)==="25"?(e="25",t+=2):(e=null,u===0&&c('"25"')),e!==null?(/^[0-5]/.test(s.charAt(t))?(r=s.charAt(t),t++):(r=null,u===0&&c("[0-5]")),r!==null?e=[e,r]:(e=null,t=i)):(e=null,t=i),e===null&&(i=t,s.charCodeAt(t)===50?(e="2",t++):(e=null,u===0&&c('"2"')),e!==null?(/^[0-4]/.test(s.charAt(t))?(r=s.charAt(t),t++):(r=null,u===0&&c("[0-4]")),r!==null?(n=x(),n!==null?e=[e,r,n]:(e=null,t=i)):(e=null,t=i)):(e=null,t=i),e===null&&(i=t,s.charCodeAt(t)===49?(e="1",t++):(e=null,u===0&&c('"1"')),e!==null?(r=x(),r!==null?(n=x(),n!==null?e=[e,r,n]:(e=null,t=i)):(e=null,t=i)):(e=null,t=i),e===null&&(i=t,/^[1-9]/.test(s.charAt(t))?(e=s.charAt(t),t++):(e=null,u===0&&c("[1-9]")),e!==null?(r=x(),r!==null?e=[e,r]:(e=null,t=i)):(e=null,t=i),e===null&&(e=x())))),e}function zr(){var e,r,n,i,o,d,_;return d=t,_=t,e=x(),e=e!==null?e:"",e!==null?(r=x(),r=r!==null?r:"",r!==null?(n=x(),n=n!==null?n:"",n!==null?(i=x(),i=i!==null?i:"",i!==null?(o=x(),o=o!==null?o:"",o!==null?e=[e,r,n,i,o]:(e=null,t=_)):(e=null,t=_)):(e=null,t=_)):(e=null,t=_)):(e=null,t=_),e!==null&&(e=(function(T,A){return A=parseInt(A.join("")),m.port=A,A})(d,e)),e===null&&(t=d),e}function Jr(){var e,r,n,i;for(e=[],i=t,s.charCodeAt(t)===59?(r=";",t++):(r=null,u===0&&c('";"')),r!==null?(n=Ls(),n!==null?r=[r,n]:(r=null,t=i)):(r=null,t=i);r!==null;)e.push(r),i=t,s.charCodeAt(t)===59?(r=";",t++):(r=null,u===0&&c('";"')),r!==null?(n=Ls(),n!==null?r=[r,n]:(r=null,t=i)):(r=null,t=i);return e}function Ls(){var e;return e=Xr(),e===null&&(e=Qr(),e===null&&(e=Zr(),e===null&&(e=el(),e===null&&(e=tl(),e===null&&(e=sl(),e===null&&(e=rl())))))),e}function Xr(){var e,r,n,i;return n=t,i=t,s.substr(t,10).toLowerCase()==="transport="?(e=s.substr(t,10),t+=10):(e=null,u===0&&c('"transport="')),e!==null?(s.substr(t,3).toLowerCase()==="udp"?(r=s.substr(t,3),t+=3):(r=null,u===0&&c('"udp"')),r===null&&(s.substr(t,3).toLowerCase()==="tcp"?(r=s.substr(t,3),t+=3):(r=null,u===0&&c('"tcp"')),r===null&&(s.substr(t,4).toLowerCase()==="sctp"?(r=s.substr(t,4),t+=4):(r=null,u===0&&c('"sctp"')),r===null&&(s.substr(t,3).toLowerCase()==="tls"?(r=s.substr(t,3),t+=3):(r=null,u===0&&c('"tls"')),r===null&&(r=F())))),r!==null?e=[e,r]:(e=null,t=i)):(e=null,t=i),e!==null&&(e=(function(o,d){m.uri_params||(m.uri_params={}),m.uri_params.transport=d.toLowerCase()})(n,e[1])),e===null&&(t=n),e}function Qr(){var e,r,n,i;return n=t,i=t,s.substr(t,5).toLowerCase()==="user="?(e=s.substr(t,5),t+=5):(e=null,u===0&&c('"user="')),e!==null?(s.substr(t,5).toLowerCase()==="phone"?(r=s.substr(t,5),t+=5):(r=null,u===0&&c('"phone"')),r===null&&(s.substr(t,2).toLowerCase()==="ip"?(r=s.substr(t,2),t+=2):(r=null,u===0&&c('"ip"')),r===null&&(r=F())),r!==null?e=[e,r]:(e=null,t=i)):(e=null,t=i),e!==null&&(e=(function(o,d){m.uri_params||(m.uri_params={}),m.uri_params.user=d.toLowerCase()})(n,e[1])),e===null&&(t=n),e}function Zr(){var e,r,n,i;return n=t,i=t,s.substr(t,7).toLowerCase()==="method="?(e=s.substr(t,7),t+=7):(e=null,u===0&&c('"method="')),e!==null?(r=Jt(),r!==null?e=[e,r]:(e=null,t=i)):(e=null,t=i),e!==null&&(e=(function(o,d){m.uri_params||(m.uri_params={}),m.uri_params.method=d})(n,e[1])),e===null&&(t=n),e}function el(){var e,r,n,i;return n=t,i=t,s.substr(t,4).toLowerCase()==="ttl="?(e=s.substr(t,4),t+=4):(e=null,u===0&&c('"ttl="')),e!==null?(r=zs(),r!==null?e=[e,r]:(e=null,t=i)):(e=null,t=i),e!==null&&(e=(function(o,d){m.params||(m.params={}),m.params.ttl=d})(n,e[1])),e===null&&(t=n),e}function tl(){var e,r,n,i;return n=t,i=t,s.substr(t,6).toLowerCase()==="maddr="?(e=s.substr(t,6),t+=6):(e=null,u===0&&c('"maddr="')),e!==null?(r=At(),r!==null?e=[e,r]:(e=null,t=i)):(e=null,t=i),e!==null&&(e=(function(o,d){m.uri_params||(m.uri_params={}),m.uri_params.maddr=d})(n,e[1])),e===null&&(t=n),e}function sl(){var e,r,n,i,o,d;return i=t,o=t,s.substr(t,2).toLowerCase()==="lr"?(e=s.substr(t,2),t+=2):(e=null,u===0&&c('"lr"')),e!==null?(d=t,s.charCodeAt(t)===61?(r="=",t++):(r=null,u===0&&c('"="')),r!==null?(n=F(),n!==null?r=[r,n]:(r=null,t=d)):(r=null,t=d),r=r!==null?r:"",r!==null?e=[e,r]:(e=null,t=o)):(e=null,t=o),e!==null&&(e=(function(_){m.uri_params||(m.uri_params={}),m.uri_params.lr=void 0})(i)),e===null&&(t=i),e}function rl(){var e,r,n,i,o,d;return i=t,o=t,e=ll(),e!==null?(d=t,s.charCodeAt(t)===61?(r="=",t++):(r=null,u===0&&c('"="')),r!==null?(n=nl(),n!==null?r=[r,n]:(r=null,t=d)):(r=null,t=d),r=r!==null?r:"",r!==null?e=[e,r]:(e=null,t=o)):(e=null,t=o),e!==null&&(e=(function(_,T,A){m.uri_params||(m.uri_params={}),typeof A=="undefined"?A=void 0:A=A[1],m.uri_params[T.toLowerCase()]=A})(i,e[0],e[1])),e===null&&(t=i),e}function ll(){var e,r,n;if(n=t,r=Rt(),r!==null)for(e=[];r!==null;)e.push(r),r=Rt();else e=null;return e!==null&&(e=(function(i,o){return o.join("")})(n,e)),e===null&&(t=n),e}function nl(){var e,r,n;if(n=t,r=Rt(),r!==null)for(e=[];r!==null;)e.push(r),r=Rt();else e=null;return e!==null&&(e=(function(i,o){return o.join("")})(n,e)),e===null&&(t=n),e}function Rt(){var e;return e=il(),e===null&&(e=R(),e===null&&(e=Z())),e}function il(){var e;return s.charCodeAt(t)===91?(e="[",t++):(e=null,u===0&&c('"["')),e===null&&(s.charCodeAt(t)===93?(e="]",t++):(e=null,u===0&&c('"]"')),e===null&&(s.charCodeAt(t)===47?(e="/",t++):(e=null,u===0&&c('"/"')),e===null&&(s.charCodeAt(t)===58?(e=":",t++):(e=null,u===0&&c('":"')),e===null&&(s.charCodeAt(t)===38?(e="&",t++):(e=null,u===0&&c('"&"')),e===null&&(s.charCodeAt(t)===43?(e="+",t++):(e=null,u===0&&c('"+"')),e===null&&(s.charCodeAt(t)===36?(e="$",t++):(e=null,u===0&&c('"$"')))))))),e}function ul(){var e,r,n,i,o,d,_;if(d=t,s.charCodeAt(t)===63?(e="?",t++):(e=null,u===0&&c('"?"')),e!==null)if(r=Kt(),r!==null){for(n=[],_=t,s.charCodeAt(t)===38?(i="&",t++):(i=null,u===0&&c('"&"')),i!==null?(o=Kt(),o!==null?i=[i,o]:(i=null,t=_)):(i=null,t=_);i!==null;)n.push(i),_=t,s.charCodeAt(t)===38?(i="&",t++):(i=null,u===0&&c('"&"')),i!==null?(o=Kt(),o!==null?i=[i,o]:(i=null,t=_)):(i=null,t=_);n!==null?e=[e,r,n]:(e=null,t=d)}else e=null,t=d;else e=null,t=d;return e}function Kt(){var e,r,n,i,o;return i=t,o=t,e=ol(),e!==null?(s.charCodeAt(t)===61?(r="=",t++):(r=null,u===0&&c('"="')),r!==null?(n=al(),n!==null?e=[e,r,n]:(e=null,t=o)):(e=null,t=o)):(e=null,t=o),e!==null&&(e=(function(d,_,T){_=_.join("").toLowerCase(),T=T.join(""),m.uri_headers||(m.uri_headers={}),m.uri_headers[_]?m.uri_headers[_].push(T):m.uri_headers[_]=[T]})(i,e[0],e[2])),e===null&&(t=i),e}function ol(){var e,r;if(r=bt(),r===null&&(r=R(),r===null&&(r=Z())),r!==null)for(e=[];r!==null;)e.push(r),r=bt(),r===null&&(r=R(),r===null&&(r=Z()));else e=null;return e}function al(){var e,r;for(e=[],r=bt(),r===null&&(r=R(),r===null&&(r=Z()));r!==null;)e.push(r),r=bt(),r===null&&(r=R(),r===null&&(r=Z()));return e}function bt(){var e;return s.charCodeAt(t)===91?(e="[",t++):(e=null,u===0&&c('"["')),e===null&&(s.charCodeAt(t)===93?(e="]",t++):(e=null,u===0&&c('"]"')),e===null&&(s.charCodeAt(t)===47?(e="/",t++):(e=null,u===0&&c('"/"')),e===null&&(s.charCodeAt(t)===63?(e="?",t++):(e=null,u===0&&c('"?"')),e===null&&(s.charCodeAt(t)===58?(e=":",t++):(e=null,u===0&&c('":"')),e===null&&(s.charCodeAt(t)===43?(e="+",t++):(e=null,u===0&&c('"+"')),e===null&&(s.charCodeAt(t)===36?(e="$",t++):(e=null,u===0&&c('"$"')))))))),e}function Eu(){var e;return e=xl(),e===null&&(e=fl()),e}function fl(){var e,r,n,i,o,d;return d=t,e=Jt(),e!==null?(r=ne(),r!==null?(n=cl(),n!==null?(i=ne(),i!==null?(o=Hs(),o!==null?e=[e,r,n,i,o]:(e=null,t=d)):(e=null,t=d)):(e=null,t=d)):(e=null,t=d)):(e=null,t=d),e}function cl(){var e;return e=Wt(),e===null&&(e=Ms()),e}function Ms(){var e,r,n,i;return i=t,e=gl(),e!==null?(s.charCodeAt(t)===58?(r=":",t++):(r=null,u===0&&c('":"')),r!==null?(n=hl(),n===null&&(n=_l()),n!==null?e=[e,r,n]:(e=null,t=i)):(e=null,t=i)):(e=null,t=i),e}function hl(){var e,r,n,i,o;return i=t,e=dl(),e===null&&(e=Yt()),e!==null?(o=t,s.charCodeAt(t)===63?(r="?",t++):(r=null,u===0&&c('"?"')),r!==null?(n=Al(),n!==null?r=[r,n]:(r=null,t=o)):(r=null,t=o),r=r!==null?r:"",r!==null?e=[e,r]:(e=null,t=i)):(e=null,t=i),e}function dl(){var e,r,n,i;return i=t,s.substr(t,2)==="//"?(e="//",t+=2):(e=null,u===0&&c('"//"')),e!==null?(r=Tl(),r!==null?(n=Yt(),n=n!==null?n:"",n!==null?e=[e,r,n]:(e=null,t=i)):(e=null,t=i)):(e=null,t=i),e}function Yt(){var e,r,n;return n=t,s.charCodeAt(t)===47?(e="/",t++):(e=null,u===0&&c('"/"')),e!==null?(r=ml(),r!==null?e=[e,r]:(e=null,t=n)):(e=null,t=n),e}function _l(){var e,r,n,i;if(i=t,e=pl(),e!==null){for(r=[],n=wt();n!==null;)r.push(n),n=wt();r!==null?e=[e,r]:(e=null,t=i)}else e=null,t=i;return e}function wt(){var e;return e=I(),e===null&&(e=R(),e===null&&(e=Z())),e}function pl(){var e;return e=R(),e===null&&(e=Z(),e===null&&(s.charCodeAt(t)===59?(e=";",t++):(e=null,u===0&&c('";"')),e===null&&(s.charCodeAt(t)===63?(e="?",t++):(e=null,u===0&&c('"?"')),e===null&&(s.charCodeAt(t)===58?(e=":",t++):(e=null,u===0&&c('":"')),e===null&&(s.charCodeAt(t)===64?(e="@",t++):(e=null,u===0&&c('"@"')),e===null&&(s.charCodeAt(t)===38?(e="&",t++):(e=null,u===0&&c('"&"')),e===null&&(s.charCodeAt(t)===61?(e="=",t++):(e=null,u===0&&c('"="')),e===null&&(s.charCodeAt(t)===43?(e="+",t++):(e=null,u===0&&c('"+"')),e===null&&(s.charCodeAt(t)===36?(e="$",t++):(e=null,u===0&&c('"$"')),e===null&&(s.charCodeAt(t)===44?(e=",",t++):(e=null,u===0&&c('","')))))))))))),e}function ml(){var e,r,n,i,o,d;if(o=t,e=zt(),e!==null){for(r=[],d=t,s.charCodeAt(t)===47?(n="/",t++):(n=null,u===0&&c('"/"')),n!==null?(i=zt(),i!==null?n=[n,i]:(n=null,t=d)):(n=null,t=d);n!==null;)r.push(n),d=t,s.charCodeAt(t)===47?(n="/",t++):(n=null,u===0&&c('"/"')),n!==null?(i=zt(),i!==null?n=[n,i]:(n=null,t=d)):(n=null,t=d);r!==null?e=[e,r]:(e=null,t=o)}else e=null,t=o;return e}function zt(){var e,r,n,i,o,d;for(o=t,e=[],r=yt();r!==null;)e.push(r),r=yt();if(e!==null){for(r=[],d=t,s.charCodeAt(t)===59?(n=";",t++):(n=null,u===0&&c('";"')),n!==null?(i=Fs(),i!==null?n=[n,i]:(n=null,t=d)):(n=null,t=d);n!==null;)r.push(n),d=t,s.charCodeAt(t)===59?(n=";",t++):(n=null,u===0&&c('";"')),n!==null?(i=Fs(),i!==null?n=[n,i]:(n=null,t=d)):(n=null,t=d);r!==null?e=[e,r]:(e=null,t=o)}else e=null,t=o;return e}function Fs(){var e,r;for(e=[],r=yt();r!==null;)e.push(r),r=yt();return e}function yt(){var e;return e=R(),e===null&&(e=Z(),e===null&&(s.charCodeAt(t)===58?(e=":",t++):(e=null,u===0&&c('":"')),e===null&&(s.charCodeAt(t)===64?(e="@",t++):(e=null,u===0&&c('"@"')),e===null&&(s.charCodeAt(t)===38?(e="&",t++):(e=null,u===0&&c('"&"')),e===null&&(s.charCodeAt(t)===61?(e="=",t++):(e=null,u===0&&c('"="')),e===null&&(s.charCodeAt(t)===43?(e="+",t++):(e=null,u===0&&c('"+"')),e===null&&(s.charCodeAt(t)===36?(e="$",t++):(e=null,u===0&&c('"$"')),e===null&&(s.charCodeAt(t)===44?(e=",",t++):(e=null,u===0&&c('","')))))))))),e}function gl(){var e,r,n,i,o;if(i=t,o=t,e=O(),e!==null){for(r=[],n=O(),n===null&&(n=x(),n===null&&(s.charCodeAt(t)===43?(n="+",t++):(n=null,u===0&&c('"+"')),n===null&&(s.charCodeAt(t)===45?(n="-",t++):(n=null,u===0&&c('"-"')),n===null&&(s.charCodeAt(t)===46?(n=".",t++):(n=null,u===0&&c('"."'))))));n!==null;)r.push(n),n=O(),n===null&&(n=x(),n===null&&(s.charCodeAt(t)===43?(n="+",t++):(n=null,u===0&&c('"+"')),n===null&&(s.charCodeAt(t)===45?(n="-",t++):(n=null,u===0&&c('"-"')),n===null&&(s.charCodeAt(t)===46?(n=".",t++):(n=null,u===0&&c('"."'))))));r!==null?e=[e,r]:(e=null,t=o)}else e=null,t=o;return e!==null&&(e=(function(d){m.scheme=s.substring(t,d)})(i)),e===null&&(t=i),e}function Tl(){var e;return e=Cl(),e===null&&(e=El()),e}function Cl(){var e,r,n,i;return n=t,i=t,e=Vt(),e!==null?(s.charCodeAt(t)===64?(r="@",t++):(r=null,u===0&&c('"@"')),r!==null?e=[e,r]:(e=null,t=i)):(e=null,t=i),e=e!==null?e:"",e!==null?(r=jt(),r!==null?e=[e,r]:(e=null,t=n)):(e=null,t=n),e=e!==null?e:"",e}function El(){var e,r;if(r=R(),r===null&&(r=Z(),r===null&&(s.charCodeAt(t)===36?(r="$",t++):(r=null,u===0&&c('"$"')),r===null&&(s.charCodeAt(t)===44?(r=",",t++):(r=null,u===0&&c('","')),r===null&&(s.charCodeAt(t)===59?(r=";",t++):(r=null,u===0&&c('";"')),r===null&&(s.charCodeAt(t)===58?(r=":",t++):(r=null,u===0&&c('":"')),r===null&&(s.charCodeAt(t)===64?(r="@",t++):(r=null,u===0&&c('"@"')),r===null&&(s.charCodeAt(t)===38?(r="&",t++):(r=null,u===0&&c('"&"')),r===null&&(s.charCodeAt(t)===61?(r="=",t++):(r=null,u===0&&c('"="')),r===null&&(s.charCodeAt(t)===43?(r="+",t++):(r=null,u===0&&c('"+"'))))))))))),r!==null)for(e=[];r!==null;)e.push(r),r=R(),r===null&&(r=Z(),r===null&&(s.charCodeAt(t)===36?(r="$",t++):(r=null,u===0&&c('"$"')),r===null&&(s.charCodeAt(t)===44?(r=",",t++):(r=null,u===0&&c('","')),r===null&&(s.charCodeAt(t)===59?(r=";",t++):(r=null,u===0&&c('";"')),r===null&&(s.charCodeAt(t)===58?(r=":",t++):(r=null,u===0&&c('":"')),r===null&&(s.charCodeAt(t)===64?(r="@",t++):(r=null,u===0&&c('"@"')),r===null&&(s.charCodeAt(t)===38?(r="&",t++):(r=null,u===0&&c('"&"')),r===null&&(s.charCodeAt(t)===61?(r="=",t++):(r=null,u===0&&c('"="')),r===null&&(s.charCodeAt(t)===43?(r="+",t++):(r=null,u===0&&c('"+"')))))))))));else e=null;return e}function Al(){var e,r;for(e=[],r=wt();r!==null;)e.push(r),r=wt();return e}function Hs(){var e,r,n,i,o,d,_,T;if(_=t,T=t,s.substr(t,3).toLowerCase()==="sip"?(e=s.substr(t,3),t+=3):(e=null,u===0&&c('"SIP"')),e!==null)if(s.charCodeAt(t)===47?(r="/",t++):(r=null,u===0&&c('"/"')),r!==null){if(i=x(),i!==null)for(n=[];i!==null;)n.push(i),i=x();else n=null;if(n!==null)if(s.charCodeAt(t)===46?(i=".",t++):(i=null,u===0&&c('"."')),i!==null){if(d=x(),d!==null)for(o=[];d!==null;)o.push(d),d=x();else o=null;o!==null?e=[e,r,n,i,o]:(e=null,t=T)}else e=null,t=T;else e=null,t=T}else e=null,t=T;else e=null,t=T;return e!==null&&(e=(function(A){m.sip_version=s.substring(t,A)})(_)),e===null&&(t=_),e}function Sl(){var e;return s.substr(t,6)==="INVITE"?(e="INVITE",t+=6):(e=null,u===0&&c('"INVITE"')),e}function vl(){var e;return s.substr(t,3)==="ACK"?(e="ACK",t+=3):(e=null,u===0&&c('"ACK"')),e}function Rl(){var e;return s.substr(t,7)==="OPTIONS"?(e="OPTIONS",t+=7):(e=null,u===0&&c('"OPTIONS"')),e}function bl(){var e;return s.substr(t,3)==="BYE"?(e="BYE",t+=3):(e=null,u===0&&c('"BYE"')),e}function wl(){var e;return s.substr(t,6)==="CANCEL"?(e="CANCEL",t+=6):(e=null,u===0&&c('"CANCEL"')),e}function yl(){var e;return s.substr(t,8)==="REGISTER"?(e="REGISTER",t+=8):(e=null,u===0&&c('"REGISTER"')),e}function Il(){var e;return s.substr(t,9)==="SUBSCRIBE"?(e="SUBSCRIBE",t+=9):(e=null,u===0&&c('"SUBSCRIBE"')),e}function Nl(){var e;return s.substr(t,6)==="NOTIFY"?(e="NOTIFY",t+=6):(e=null,u===0&&c('"NOTIFY"')),e}function Ol(){var e;return s.substr(t,5)==="REFER"?(e="REFER",t+=5):(e=null,u===0&&c('"REFER"')),e}function Jt(){var e,r;return r=t,e=Sl(),e===null&&(e=vl(),e===null&&(e=Rl(),e===null&&(e=bl(),e===null&&(e=wl(),e===null&&(e=yl(),e===null&&(e=Il(),e===null&&(e=Nl(),e===null&&(e=Ol(),e===null&&(e=F()))))))))),e!==null&&(e=(function(n){return m.method=s.substring(t,n),m.method})(r)),e===null&&(t=r),e}function xl(){var e,r,n,i,o,d;return d=t,e=Hs(),e!==null?(r=ne(),r!==null?(n=Dl(),n!==null?(i=ne(),i!==null?(o=Pl(),o!==null?e=[e,r,n,i,o]:(e=null,t=d)):(e=null,t=d)):(e=null,t=d)):(e=null,t=d)):(e=null,t=d),e}function Dl(){var e,r;return r=t,e=Ul(),e!==null&&(e=(function(n,i){m.status_code=parseInt(i.join(""))})(r,e)),e===null&&(t=r),e}function Ul(){var e,r,n,i;return i=t,e=x(),e!==null?(r=x(),r!==null?(n=x(),n!==null?e=[e,r,n]:(e=null,t=i)):(e=null,t=i)):(e=null,t=i),e}function Pl(){var e,r,n;for(n=t,e=[],r=I(),r===null&&(r=R(),r===null&&(r=Z(),r===null&&(r=ve(),r===null&&(r=ye(),r===null&&(r=ne(),r===null&&(r=y()))))));r!==null;)e.push(r),r=I(),r===null&&(r=R(),r===null&&(r=Z(),r===null&&(r=ve(),r===null&&(r=ye(),r===null&&(r=ne(),r===null&&(r=y()))))));return e!==null&&(e=(function(i){m.reason_phrase=s.substring(t,i)})(n)),e===null&&(t=n),e}function Au(){var e,r,n,i,o,d;if(o=t,e=It(),e!==null){for(r=[],d=t,n=B(),n!==null?(i=It(),i!==null?n=[n,i]:(n=null,t=d)):(n=null,t=d);n!==null;)r.push(n),d=t,n=B(),n!==null?(i=It(),i!==null?n=[n,i]:(n=null,t=d)):(n=null,t=d);r!==null?e=[e,r]:(e=null,t=o)}else e=null,t=o;return e}function Su(){var e,r,n,i,o,d;return i=t,o=t,e=Ie(),e!==null?(d=t,s.charCodeAt(t)===64?(r="@",t++):(r=null,u===0&&c('"@"')),r!==null?(n=Ie(),n!==null?r=[r,n]:(r=null,t=d)):(r=null,t=d),r=r!==null?r:"",r!==null?e=[e,r]:(e=null,t=o)):(e=null,t=o),e!==null&&(e=(function(_){m=s.substring(t,_)})(i)),e===null&&(t=i),e}function vu(){var e,r,n,i,o,d,_;if(o=t,e=Ke(),e===null)if(d=t,e=Xt(),e!==null){for(r=[],_=t,n=B(),n!==null?(i=Xt(),i!==null?n=[n,i]:(n=null,t=_)):(n=null,t=_);n!==null;)r.push(n),_=t,n=B(),n!==null?(i=Xt(),i!==null?n=[n,i]:(n=null,t=_)):(n=null,t=_);r!==null?e=[e,r]:(e=null,t=d)}else e=null,t=d;return e!==null&&(e=(function(T){var A,M;for(M=m.multi_header.length,A=0;A<M;A++)if(m.multi_header[A].parsed===null){m=null;break}m!==null?m=m.multi_header:m=-1})(o)),e===null&&(t=o),e}function Xt(){var e,r,n,i,o,d,_;if(o=t,d=t,e=Et(),e===null&&(e=ze()),e!==null){for(r=[],_=t,n=k(),n!==null?(i=qs(),i!==null?n=[n,i]:(n=null,t=_)):(n=null,t=_);n!==null;)r.push(n),_=t,n=k(),n!==null?(i=qs(),i!==null?n=[n,i]:(n=null,t=_)):(n=null,t=_);r!==null?e=[e,r]:(e=null,t=d)}else e=null,t=d;return e!==null&&(e=(function(T){var A;m.multi_header||(m.multi_header=[]);try{A=new nt(m.uri,m.display_name,m.params),delete m.uri,delete m.display_name,delete m.params}catch(M){A=null}m.multi_header.push({possition:t,offset:T,parsed:A})})(o)),e===null&&(t=o),e}function ze(){var e,r,n,i,o;return o=t,e=Qt(),e=e!==null?e:"",e!==null?(r=j(),r!==null?(n=Wt(),n!==null?(i=V(),i!==null?e=[e,r,n,i]:(e=null,t=o)):(e=null,t=o)):(e=null,t=o)):(e=null,t=o),e}function Qt(){var e,r,n,i,o,d,_;if(o=t,d=t,e=F(),e!==null){for(r=[],_=t,n=re(),n!==null?(i=F(),i!==null?n=[n,i]:(n=null,t=_)):(n=null,t=_);n!==null;)r.push(n),_=t,n=re(),n!==null?(i=F(),i!==null?n=[n,i]:(n=null,t=_)):(n=null,t=_);r!==null?e=[e,r]:(e=null,t=d)}else e=null,t=d;return e===null&&(e=Tt()),e!==null&&(e=(function(T,A){typeof A=="string"?m.display_name=A:m.display_name=A[1].reduce(function(M,J){return M+J[0]+J[1]},A[0])})(o,e)),e===null&&(t=o),e}function qs(){var e;return e=Ll(),e===null&&(e=Ml(),e===null&&(e=ie())),e}function Ll(){var e,r,n,i,o;return i=t,o=t,s.substr(t,1).toLowerCase()==="q"?(e=s.substr(t,1),t++):(e=null,u===0&&c('"q"')),e!==null?(r=Y(),r!==null?(n=Fl(),n!==null?e=[e,r,n]:(e=null,t=o)):(e=null,t=o)):(e=null,t=o),e!==null&&(e=(function(d,_){m.params||(m.params={}),m.params.q=_})(i,e[2])),e===null&&(t=i),e}function Ml(){var e,r,n,i,o;return i=t,o=t,s.substr(t,7).toLowerCase()==="expires"?(e=s.substr(t,7),t+=7):(e=null,u===0&&c('"expires"')),e!==null?(r=Y(),r!==null?(n=Je(),n!==null?e=[e,r,n]:(e=null,t=o)):(e=null,t=o)):(e=null,t=o),e!==null&&(e=(function(d,_){m.params||(m.params={}),m.params.expires=_})(i,e[2])),e===null&&(t=i),e}function Je(){var e,r,n;if(n=t,r=x(),r!==null)for(e=[];r!==null;)e.push(r),r=x();else e=null;return e!==null&&(e=(function(i,o){return parseInt(o.join(""))})(n,e)),e===null&&(t=n),e}function Fl(){var e,r,n,i,o,d,_,T;return d=t,_=t,s.charCodeAt(t)===48?(e="0",t++):(e=null,u===0&&c('"0"')),e!==null?(T=t,s.charCodeAt(t)===46?(r=".",t++):(r=null,u===0&&c('"."')),r!==null?(n=x(),n=n!==null?n:"",n!==null?(i=x(),i=i!==null?i:"",i!==null?(o=x(),o=o!==null?o:"",o!==null?r=[r,n,i,o]:(r=null,t=T)):(r=null,t=T)):(r=null,t=T)):(r=null,t=T),r=r!==null?r:"",r!==null?e=[e,r]:(e=null,t=_)):(e=null,t=_),e!==null&&(e=(function(A){return parseFloat(s.substring(t,A))})(d)),e===null&&(t=d),e}function ie(){var e,r,n,i,o,d;return i=t,o=t,e=F(),e!==null?(d=t,r=Y(),r!==null?(n=Hl(),n!==null?r=[r,n]:(r=null,t=d)):(r=null,t=d),r=r!==null?r:"",r!==null?e=[e,r]:(e=null,t=o)):(e=null,t=o),e!==null&&(e=(function(_,T,A){m.params||(m.params={}),typeof A=="undefined"?A=void 0:A=A[1],m.params[T.toLowerCase()]=A})(i,e[0],e[1])),e===null&&(t=i),e}function Hl(){var e;return e=F(),e===null&&(e=At(),e===null&&(e=Bt())),e}function Ru(){var e,r,n,i,o,d;if(o=t,e=ql(),e!==null){for(r=[],d=t,n=k(),n!==null?(i=$s(),i!==null?n=[n,i]:(n=null,t=d)):(n=null,t=d);n!==null;)r.push(n),d=t,n=k(),n!==null?(i=$s(),i!==null?n=[n,i]:(n=null,t=d)):(n=null,t=d);r!==null?e=[e,r]:(e=null,t=o)}else e=null,t=o;return e}function ql(){var e;return s.substr(t,6).toLowerCase()==="render"?(e=s.substr(t,6),t+=6):(e=null,u===0&&c('"render"')),e===null&&(s.substr(t,7).toLowerCase()==="session"?(e=s.substr(t,7),t+=7):(e=null,u===0&&c('"session"')),e===null&&(s.substr(t,4).toLowerCase()==="icon"?(e=s.substr(t,4),t+=4):(e=null,u===0&&c('"icon"')),e===null&&(s.substr(t,5).toLowerCase()==="alert"?(e=s.substr(t,5),t+=5):(e=null,u===0&&c('"alert"')),e===null&&(e=F())))),e}function $s(){var e;return e=$l(),e===null&&(e=ie()),e}function $l(){var e,r,n,i;return i=t,s.substr(t,8).toLowerCase()==="handling"?(e=s.substr(t,8),t+=8):(e=null,u===0&&c('"handling"')),e!==null?(r=Y(),r!==null?(s.substr(t,8).toLowerCase()==="optional"?(n=s.substr(t,8),t+=8):(n=null,u===0&&c('"optional"')),n===null&&(s.substr(t,8).toLowerCase()==="required"?(n=s.substr(t,8),t+=8):(n=null,u===0&&c('"required"')),n===null&&(n=F())),n!==null?e=[e,r,n]:(e=null,t=i)):(e=null,t=i)):(e=null,t=i),e}function bu(){var e,r,n,i,o,d;if(o=t,e=F(),e!==null){for(r=[],d=t,n=B(),n!==null?(i=F(),i!==null?n=[n,i]:(n=null,t=d)):(n=null,t=d);n!==null;)r.push(n),d=t,n=B(),n!==null?(i=F(),i!==null?n=[n,i]:(n=null,t=d)):(n=null,t=d);r!==null?e=[e,r]:(e=null,t=o)}else e=null,t=o;return e}function wu(){var e,r,n;if(n=t,r=x(),r!==null)for(e=[];r!==null;)e.push(r),r=x();else e=null;return e!==null&&(e=(function(i,o){m=parseInt(o.join(""))})(n,e)),e===null&&(t=n),e}function yu(){var e,r;return r=t,e=kl(),e!==null&&(e=(function(n){m=s.substring(t,n)})(r)),e===null&&(t=r),e}function kl(){var e,r,n,i,o,d,_,T;if(_=t,e=Gl(),e!==null)if(r=Me(),r!==null)if(n=jl(),n!==null){for(i=[],T=t,o=k(),o!==null?(d=ks(),d!==null?o=[o,d]:(o=null,t=T)):(o=null,t=T);o!==null;)i.push(o),T=t,o=k(),o!==null?(d=ks(),d!==null?o=[o,d]:(o=null,t=T)):(o=null,t=T);i!==null?e=[e,r,n,i]:(e=null,t=_)}else e=null,t=_;else e=null,t=_;else e=null,t=_;return e}function Gl(){var e;return e=Bl(),e===null&&(e=Wl()),e}function Bl(){var e;return s.substr(t,4).toLowerCase()==="text"?(e=s.substr(t,4),t+=4):(e=null,u===0&&c('"text"')),e===null&&(s.substr(t,5).toLowerCase()==="image"?(e=s.substr(t,5),t+=5):(e=null,u===0&&c('"image"')),e===null&&(s.substr(t,5).toLowerCase()==="audio"?(e=s.substr(t,5),t+=5):(e=null,u===0&&c('"audio"')),e===null&&(s.substr(t,5).toLowerCase()==="video"?(e=s.substr(t,5),t+=5):(e=null,u===0&&c('"video"')),e===null&&(s.substr(t,11).toLowerCase()==="application"?(e=s.substr(t,11),t+=11):(e=null,u===0&&c('"application"')),e===null&&(e=Zt()))))),e}function Wl(){var e;return s.substr(t,7).toLowerCase()==="message"?(e=s.substr(t,7),t+=7):(e=null,u===0&&c('"message"')),e===null&&(s.substr(t,9).toLowerCase()==="multipart"?(e=s.substr(t,9),t+=9):(e=null,u===0&&c('"multipart"')),e===null&&(e=Zt())),e}function Zt(){var e;return e=F(),e===null&&(e=Vl()),e}function Vl(){var e,r,n;return n=t,s.substr(t,2).toLowerCase()==="x-"?(e=s.substr(t,2),t+=2):(e=null,u===0&&c('"x-"')),e!==null?(r=F(),r!==null?e=[e,r]:(e=null,t=n)):(e=null,t=n),e}function jl(){var e;return e=Zt(),e===null&&(e=F()),e}function ks(){var e,r,n,i;return i=t,e=F(),e!==null?(r=Y(),r!==null?(n=Kl(),n!==null?e=[e,r,n]:(e=null,t=i)):(e=null,t=i)):(e=null,t=i),e}function Kl(){var e;return e=F(),e===null&&(e=Bt()),e}function Iu(){var e,r,n,i;return i=t,e=Yl(),e!==null?(r=re(),r!==null?(n=Jt(),n!==null?e=[e,r,n]:(e=null,t=i)):(e=null,t=i)):(e=null,t=i),e}function Yl(){var e,r,n;if(n=t,r=x(),r!==null)for(e=[];r!==null;)e.push(r),r=x();else e=null;return e!==null&&(e=(function(i,o){m.value=parseInt(o.join(""))})(n,e)),e===null&&(t=n),e}function Nu(){var e,r;return r=t,e=Je(),e!==null&&(e=(function(n,i){m=i})(r,e)),e===null&&(t=r),e}function Ou(){var e,r,n,i,o,d,_;if(o=t,d=t,e=It(),e!==null){for(r=[],_=t,n=k(),n!==null?(i=ie(),i!==null?n=[n,i]:(n=null,t=_)):(n=null,t=_);n!==null;)r.push(n),_=t,n=k(),n!==null?(i=ie(),i!==null?n=[n,i]:(n=null,t=_)):(n=null,t=_);r!==null?e=[e,r]:(e=null,t=d)}else e=null,t=d;return e!==null&&(e=(function(T,A){m.event=A.join("").toLowerCase()})(o,e[0])),e===null&&(t=o),e}function It(){var e,r,n,i,o,d;if(o=t,e=Le(),e!==null){for(r=[],d=t,s.charCodeAt(t)===46?(n=".",t++):(n=null,u===0&&c('"."')),n!==null?(i=Le(),i!==null?n=[n,i]:(n=null,t=d)):(n=null,t=d);n!==null;)r.push(n),d=t,s.charCodeAt(t)===46?(n=".",t++):(n=null,u===0&&c('"."')),n!==null?(i=Le(),i!==null?n=[n,i]:(n=null,t=d)):(n=null,t=d);r!==null?e=[e,r]:(e=null,t=o)}else e=null,t=o;return e}function xu(){var e,r,n,i,o,d,_;if(o=t,d=t,e=Et(),e===null&&(e=ze()),e!==null){for(r=[],_=t,n=k(),n!==null?(i=Gs(),i!==null?n=[n,i]:(n=null,t=_)):(n=null,t=_);n!==null;)r.push(n),_=t,n=k(),n!==null?(i=Gs(),i!==null?n=[n,i]:(n=null,t=_)):(n=null,t=_);r!==null?e=[e,r]:(e=null,t=d)}else e=null,t=d;return e!==null&&(e=(function(T){var A=m.tag;try{m=new nt(m.uri,m.display_name,m.params),A&&m.setParam("tag",A)}catch(M){m=-1}})(o)),e===null&&(t=o),e}function Gs(){var e;return e=Bs(),e===null&&(e=ie()),e}function Bs(){var e,r,n,i,o;return i=t,o=t,s.substr(t,3).toLowerCase()==="tag"?(e=s.substr(t,3),t+=3):(e=null,u===0&&c('"tag"')),e!==null?(r=Y(),r!==null?(n=F(),n!==null?e=[e,r,n]:(e=null,t=o)):(e=null,t=o)):(e=null,t=o),e!==null&&(e=(function(d,_){m.tag=_})(i,e[2])),e===null&&(t=i),e}function Du(){var e,r,n;if(n=t,r=x(),r!==null)for(e=[];r!==null;)e.push(r),r=x();else e=null;return e!==null&&(e=(function(i,o){m=parseInt(o.join(""))})(n,e)),e===null&&(t=n),e}function Uu(){var e,r;return r=t,e=Je(),e!==null&&(e=(function(n,i){m=i})(r,e)),e===null&&(t=r),e}function Pu(){var e,r,n,i,o,d,_,T,A,M;for(T=t,A=t,e=[],r=Qt();r!==null;)e.push(r),r=Qt();if(e!==null)if(r=j(),r!==null)if(n=Wt(),n!==null)if(i=V(),i!==null){for(o=[],M=t,d=k(),d!==null?(_=ie(),_!==null?d=[d,_]:(d=null,t=M)):(d=null,t=M);d!==null;)o.push(d),M=t,d=k(),d!==null?(_=ie(),_!==null?d=[d,_]:(d=null,t=M)):(d=null,t=M);o!==null?e=[e,r,n,i,o]:(e=null,t=A)}else e=null,t=A;else e=null,t=A;else e=null,t=A;else e=null,t=A;return e!==null&&(e=(function(J){try{m=new nt(m.uri,m.display_name,m.params)}catch(Ne){m=-1}})(T)),e===null&&(t=T),e}function Lu(){var e;return e=Ws(),e}function Ws(){var e,r,n,i,o,d,_,T;if(_=t,s.substr(t,6).toLowerCase()==="digest"?(e=s.substr(t,6),t+=6):(e=null,u===0&&c('"Digest"')),e!==null)if(r=re(),r!==null)if(n=es(),n!==null){for(i=[],T=t,o=B(),o!==null?(d=es(),d!==null?o=[o,d]:(o=null,t=T)):(o=null,t=T);o!==null;)i.push(o),T=t,o=B(),o!==null?(d=es(),d!==null?o=[o,d]:(o=null,t=T)):(o=null,t=T);i!==null?e=[e,r,n,i]:(e=null,t=_)}else e=null,t=_;else e=null,t=_;else e=null,t=_;return e===null&&(e=zl()),e}function zl(){var e,r,n,i,o,d,_,T;if(_=t,e=F(),e!==null)if(r=re(),r!==null)if(n=Nt(),n!==null){for(i=[],T=t,o=B(),o!==null?(d=Nt(),d!==null?o=[o,d]:(o=null,t=T)):(o=null,t=T);o!==null;)i.push(o),T=t,o=B(),o!==null?(d=Nt(),d!==null?o=[o,d]:(o=null,t=T)):(o=null,t=T);i!==null?e=[e,r,n,i]:(e=null,t=_)}else e=null,t=_;else e=null,t=_;else e=null,t=_;return e}function Nt(){var e,r,n,i;return i=t,e=F(),e!==null?(r=Y(),r!==null?(n=F(),n===null&&(n=Bt()),n!==null?e=[e,r,n]:(e=null,t=i)):(e=null,t=i)):(e=null,t=i),e}function es(){var e;return e=Jl(),e===null&&(e=Ql(),e===null&&(e=Zl(),e===null&&(e=tn(),e===null&&(e=sn(),e===null&&(e=rn(),e===null&&(e=ln(),e===null&&(e=Nt()))))))),e}function Jl(){var e,r,n,i;return i=t,s.substr(t,5).toLowerCase()==="realm"?(e=s.substr(t,5),t+=5):(e=null,u===0&&c('"realm"')),e!==null?(r=Y(),r!==null?(n=Xl(),n!==null?e=[e,r,n]:(e=null,t=i)):(e=null,t=i)):(e=null,t=i),e}function Xl(){var e,r;return r=t,e=Tt(),e!==null&&(e=(function(n,i){m.realm=i})(r,e)),e===null&&(t=r),e}function Ql(){var e,r,n,i,o,d,_,T,A;if(T=t,s.substr(t,6).toLowerCase()==="domain"?(e=s.substr(t,6),t+=6):(e=null,u===0&&c('"domain"')),e!==null)if(r=Y(),r!==null)if(n=Be(),n!==null)if(i=ts(),i!==null){if(o=[],A=t,_=ne(),_!==null)for(d=[];_!==null;)d.push(_),_=ne();else d=null;for(d!==null?(_=ts(),_!==null?d=[d,_]:(d=null,t=A)):(d=null,t=A);d!==null;){if(o.push(d),A=t,_=ne(),_!==null)for(d=[];_!==null;)d.push(_),_=ne();else d=null;d!==null?(_=ts(),_!==null?d=[d,_]:(d=null,t=A)):(d=null,t=A)}o!==null?(d=Te(),d!==null?e=[e,r,n,i,o,d]:(e=null,t=T)):(e=null,t=T)}else e=null,t=T;else e=null,t=T;else e=null,t=T;else e=null,t=T;return e}function ts(){var e;return e=Ms(),e===null&&(e=Yt()),e}function Zl(){var e,r,n,i;return i=t,s.substr(t,5).toLowerCase()==="nonce"?(e=s.substr(t,5),t+=5):(e=null,u===0&&c('"nonce"')),e!==null?(r=Y(),r!==null?(n=en(),n!==null?e=[e,r,n]:(e=null,t=i)):(e=null,t=i)):(e=null,t=i),e}function en(){var e,r;return r=t,e=Tt(),e!==null&&(e=(function(n,i){m.nonce=i})(r,e)),e===null&&(t=r),e}function tn(){var e,r,n,i,o;return i=t,o=t,s.substr(t,6).toLowerCase()==="opaque"?(e=s.substr(t,6),t+=6):(e=null,u===0&&c('"opaque"')),e!==null?(r=Y(),r!==null?(n=Tt(),n!==null?e=[e,r,n]:(e=null,t=o)):(e=null,t=o)):(e=null,t=o),e!==null&&(e=(function(d,_){m.opaque=_})(i,e[2])),e===null&&(t=i),e}function sn(){var e,r,n,i,o;return i=t,s.substr(t,5).toLowerCase()==="stale"?(e=s.substr(t,5),t+=5):(e=null,u===0&&c('"stale"')),e!==null?(r=Y(),r!==null?(o=t,s.substr(t,4).toLowerCase()==="true"?(n=s.substr(t,4),t+=4):(n=null,u===0&&c('"true"')),n!==null&&(n=(function(d){m.stale=!0})(o)),n===null&&(t=o),n===null&&(o=t,s.substr(t,5).toLowerCase()==="false"?(n=s.substr(t,5),t+=5):(n=null,u===0&&c('"false"')),n!==null&&(n=(function(d){m.stale=!1})(o)),n===null&&(t=o)),n!==null?e=[e,r,n]:(e=null,t=i)):(e=null,t=i)):(e=null,t=i),e}function rn(){var e,r,n,i,o;return i=t,o=t,s.substr(t,9).toLowerCase()==="algorithm"?(e=s.substr(t,9),t+=9):(e=null,u===0&&c('"algorithm"')),e!==null?(r=Y(),r!==null?(s.substr(t,3).toLowerCase()==="md5"?(n=s.substr(t,3),t+=3):(n=null,u===0&&c('"MD5"')),n===null&&(s.substr(t,8).toLowerCase()==="md5-sess"?(n=s.substr(t,8),t+=8):(n=null,u===0&&c('"MD5-sess"')),n===null&&(n=F())),n!==null?e=[e,r,n]:(e=null,t=o)):(e=null,t=o)):(e=null,t=o),e!==null&&(e=(function(d,_){m.algorithm=_.toUpperCase()})(i,e[2])),e===null&&(t=i),e}function ln(){var e,r,n,i,o,d,_,T,A,M;if(T=t,s.substr(t,3).toLowerCase()==="qop"?(e=s.substr(t,3),t+=3):(e=null,u===0&&c('"qop"')),e!==null)if(r=Y(),r!==null)if(n=Be(),n!==null){if(A=t,i=ss(),i!==null){for(o=[],M=t,s.charCodeAt(t)===44?(d=",",t++):(d=null,u===0&&c('","')),d!==null?(_=ss(),_!==null?d=[d,_]:(d=null,t=M)):(d=null,t=M);d!==null;)o.push(d),M=t,s.charCodeAt(t)===44?(d=",",t++):(d=null,u===0&&c('","')),d!==null?(_=ss(),_!==null?d=[d,_]:(d=null,t=M)):(d=null,t=M);o!==null?i=[i,o]:(i=null,t=A)}else i=null,t=A;i!==null?(o=Te(),o!==null?e=[e,r,n,i,o]:(e=null,t=T)):(e=null,t=T)}else e=null,t=T;else e=null,t=T;else e=null,t=T;return e}function ss(){var e,r;return r=t,s.substr(t,8).toLowerCase()==="auth-int"?(e=s.substr(t,8),t+=8):(e=null,u===0&&c('"auth-int"')),e===null&&(s.substr(t,4).toLowerCase()==="auth"?(e=s.substr(t,4),t+=4):(e=null,u===0&&c('"auth"')),e===null&&(e=F())),e!==null&&(e=(function(n,i){m.qop||(m.qop=[]),m.qop.push(i.toLowerCase())})(r,e)),e===null&&(t=r),e}function Mu(){var e,r,n,i,o,d;if(o=t,e=F(),e!==null){for(r=[],d=t,n=B(),n!==null?(i=F(),i!==null?n=[n,i]:(n=null,t=d)):(n=null,t=d);n!==null;)r.push(n),d=t,n=B(),n!==null?(i=F(),i!==null?n=[n,i]:(n=null,t=d)):(n=null,t=d);r!==null?e=[e,r]:(e=null,t=o)}else e=null,t=o;return e}function Fu(){var e,r,n,i,o,d,_;if(o=t,d=t,e=rs(),e!==null){for(r=[],_=t,n=B(),n!==null?(i=rs(),i!==null?n=[n,i]:(n=null,t=_)):(n=null,t=_);n!==null;)r.push(n),_=t,n=B(),n!==null?(i=rs(),i!==null?n=[n,i]:(n=null,t=_)):(n=null,t=_);r!==null?e=[e,r]:(e=null,t=d)}else e=null,t=d;return e!==null&&(e=(function(T){var A,M;for(M=m.multi_header.length,A=0;A<M;A++)if(m.multi_header[A].parsed===null){m=null;break}m!==null?m=m.multi_header:m=-1})(o)),e===null&&(t=o),e}function rs(){var e,r,n,i,o,d,_;if(o=t,d=t,e=ze(),e!==null){for(r=[],_=t,n=k(),n!==null?(i=ie(),i!==null?n=[n,i]:(n=null,t=_)):(n=null,t=_);n!==null;)r.push(n),_=t,n=k(),n!==null?(i=ie(),i!==null?n=[n,i]:(n=null,t=_)):(n=null,t=_);r!==null?e=[e,r]:(e=null,t=d)}else e=null,t=d;return e!==null&&(e=(function(T){var A;m.multi_header||(m.multi_header=[]);try{A=new nt(m.uri,m.display_name,m.params),delete m.uri,delete m.display_name,delete m.params}catch(M){A=null}m.multi_header.push({possition:t,offset:T,parsed:A})})(o)),e===null&&(t=o),e}function Hu(){var e,r,n,i,o,d,_;if(o=t,d=t,s.substr(t,3).toLowerCase()==="sip"?(e=s.substr(t,3),t+=3):(e=null,u===0&&c('"SIP"')),e===null&&(e=F()),e!==null){for(r=[],_=t,n=k(),n!==null?(i=Vs(),i!==null?n=[n,i]:(n=null,t=_)):(n=null,t=_);n!==null;)r.push(n),_=t,n=k(),n!==null?(i=Vs(),i!==null?n=[n,i]:(n=null,t=_)):(n=null,t=_);r!==null?e=[e,r]:(e=null,t=d)}else e=null,t=d;return e!==null&&(e=(function(T,A){if(m.protocol=A.toLowerCase(),m.params||(m.params={}),m.params.text&&m.params.text[0]==='"'){var M=m.params.text;m.text=M.substring(1,M.length-1),delete m.params.text}})(o,e[0])),e===null&&(t=o),e}function Vs(){var e;return e=nn(),e===null&&(e=ie()),e}function nn(){var e,r,n,i,o,d;if(o=t,d=t,s.substr(t,5).toLowerCase()==="cause"?(e=s.substr(t,5),t+=5):(e=null,u===0&&c('"cause"')),e!==null)if(r=Y(),r!==null){if(i=x(),i!==null)for(n=[];i!==null;)n.push(i),i=x();else n=null;n!==null?e=[e,r,n]:(e=null,t=d)}else e=null,t=d;else e=null,t=d;return e!==null&&(e=(function(_,T){m.cause=parseInt(T.join(""))})(o,e[2])),e===null&&(t=o),e}function qu(){var e,r,n,i,o,d;if(o=t,e=F(),e!==null){for(r=[],d=t,n=B(),n!==null?(i=F(),i!==null?n=[n,i]:(n=null,t=d)):(n=null,t=d);n!==null;)r.push(n),d=t,n=B(),n!==null?(i=F(),i!==null?n=[n,i]:(n=null,t=d)):(n=null,t=d);r!==null?e=[e,r]:(e=null,t=o)}else e=null,t=o;return e}function $u(){var e,r,n,i,o,d;if(o=t,e=ls(),e!==null){for(r=[],d=t,n=B(),n!==null?(i=ls(),i!==null?n=[n,i]:(n=null,t=d)):(n=null,t=d);n!==null;)r.push(n),d=t,n=B(),n!==null?(i=ls(),i!==null?n=[n,i]:(n=null,t=d)):(n=null,t=d);r!==null?e=[e,r]:(e=null,t=o)}else e=null,t=o;return e}function ls(){var e,r,n,i,o,d;if(o=t,e=ze(),e!==null){for(r=[],d=t,n=k(),n!==null?(i=ie(),i!==null?n=[n,i]:(n=null,t=d)):(n=null,t=d);n!==null;)r.push(n),d=t,n=k(),n!==null?(i=ie(),i!==null?n=[n,i]:(n=null,t=d)):(n=null,t=d);r!==null?e=[e,r]:(e=null,t=o)}else e=null,t=o;return e}function ku(){var e,r,n,i,o,d;if(o=t,e=un(),e!==null){for(r=[],d=t,n=k(),n!==null?(i=js(),i!==null?n=[n,i]:(n=null,t=d)):(n=null,t=d);n!==null;)r.push(n),d=t,n=k(),n!==null?(i=js(),i!==null?n=[n,i]:(n=null,t=d)):(n=null,t=d);r!==null?e=[e,r]:(e=null,t=o)}else e=null,t=o;return e}function un(){var e,r;return r=t,s.substr(t,6).toLowerCase()==="active"?(e=s.substr(t,6),t+=6):(e=null,u===0&&c('"active"')),e===null&&(s.substr(t,7).toLowerCase()==="pending"?(e=s.substr(t,7),t+=7):(e=null,u===0&&c('"pending"')),e===null&&(s.substr(t,10).toLowerCase()==="terminated"?(e=s.substr(t,10),t+=10):(e=null,u===0&&c('"terminated"')),e===null&&(e=F()))),e!==null&&(e=(function(n){m.state=s.substring(t,n)})(r)),e===null&&(t=r),e}function js(){var e,r,n,i,o;return i=t,o=t,s.substr(t,6).toLowerCase()==="reason"?(e=s.substr(t,6),t+=6):(e=null,u===0&&c('"reason"')),e!==null?(r=Y(),r!==null?(n=on(),n!==null?e=[e,r,n]:(e=null,t=o)):(e=null,t=o)):(e=null,t=o),e!==null&&(e=(function(d,_){typeof _!="undefined"&&(m.reason=_)})(i,e[2])),e===null&&(t=i),e===null&&(i=t,o=t,s.substr(t,7).toLowerCase()==="expires"?(e=s.substr(t,7),t+=7):(e=null,u===0&&c('"expires"')),e!==null?(r=Y(),r!==null?(n=Je(),n!==null?e=[e,r,n]:(e=null,t=o)):(e=null,t=o)):(e=null,t=o),e!==null&&(e=(function(d,_){typeof _!="undefined"&&(m.expires=_)})(i,e[2])),e===null&&(t=i),e===null&&(i=t,o=t,s.substr(t,11).toLowerCase()==="retry_after"?(e=s.substr(t,11),t+=11):(e=null,u===0&&c('"retry_after"')),e!==null?(r=Y(),r!==null?(n=Je(),n!==null?e=[e,r,n]:(e=null,t=o)):(e=null,t=o)):(e=null,t=o),e!==null&&(e=(function(d,_){typeof _!="undefined"&&(m.retry_after=_)})(i,e[2])),e===null&&(t=i),e===null&&(e=ie()))),e}function on(){var e;return s.substr(t,11).toLowerCase()==="deactivated"?(e=s.substr(t,11),t+=11):(e=null,u===0&&c('"deactivated"')),e===null&&(s.substr(t,9).toLowerCase()==="probation"?(e=s.substr(t,9),t+=9):(e=null,u===0&&c('"probation"')),e===null&&(s.substr(t,8).toLowerCase()==="rejected"?(e=s.substr(t,8),t+=8):(e=null,u===0&&c('"rejected"')),e===null&&(s.substr(t,7).toLowerCase()==="timeout"?(e=s.substr(t,7),t+=7):(e=null,u===0&&c('"timeout"')),e===null&&(s.substr(t,6).toLowerCase()==="giveup"?(e=s.substr(t,6),t+=6):(e=null,u===0&&c('"giveup"')),e===null&&(s.substr(t,10).toLowerCase()==="noresource"?(e=s.substr(t,10),t+=10):(e=null,u===0&&c('"noresource"')),e===null&&(s.substr(t,9).toLowerCase()==="invariant"?(e=s.substr(t,9),t+=9):(e=null,u===0&&c('"invariant"')),e===null&&(e=F()))))))),e}function Gu(){var e;return e=je(),e=e!==null?e:"",e}function Bu(){var e,r,n,i,o,d;if(o=t,e=F(),e!==null){for(r=[],d=t,n=B(),n!==null?(i=F(),i!==null?n=[n,i]:(n=null,t=d)):(n=null,t=d);n!==null;)r.push(n),d=t,n=B(),n!==null?(i=F(),i!==null?n=[n,i]:(n=null,t=d)):(n=null,t=d);r!==null?e=[e,r]:(e=null,t=o)}else e=null,t=o;return e=e!==null?e:"",e}function Wu(){var e,r,n,i,o,d,_;if(o=t,d=t,e=Et(),e===null&&(e=ze()),e!==null){for(r=[],_=t,n=k(),n!==null?(i=Ks(),i!==null?n=[n,i]:(n=null,t=_)):(n=null,t=_);n!==null;)r.push(n),_=t,n=k(),n!==null?(i=Ks(),i!==null?n=[n,i]:(n=null,t=_)):(n=null,t=_);r!==null?e=[e,r]:(e=null,t=d)}else e=null,t=d;return e!==null&&(e=(function(T){var A=m.tag;try{m=new nt(m.uri,m.display_name,m.params),A&&m.setParam("tag",A)}catch(M){m=-1}})(o)),e===null&&(t=o),e}function Ks(){var e;return e=Bs(),e===null&&(e=ie()),e}function Vu(){var e,r,n,i,o,d;if(o=t,e=ns(),e!==null){for(r=[],d=t,n=B(),n!==null?(i=ns(),i!==null?n=[n,i]:(n=null,t=d)):(n=null,t=d);n!==null;)r.push(n),d=t,n=B(),n!==null?(i=ns(),i!==null?n=[n,i]:(n=null,t=d)):(n=null,t=d);r!==null?e=[e,r]:(e=null,t=o)}else e=null,t=o;return e}function ns(){var e,r,n,i,o,d,_,T;if(_=t,e=pn(),e!==null)if(r=re(),r!==null)if(n=Tn(),n!==null){for(i=[],T=t,o=k(),o!==null?(d=Ys(),d!==null?o=[o,d]:(o=null,t=T)):(o=null,t=T);o!==null;)i.push(o),T=t,o=k(),o!==null?(d=Ys(),d!==null?o=[o,d]:(o=null,t=T)):(o=null,t=T);i!==null?e=[e,r,n,i]:(e=null,t=_)}else e=null,t=_;else e=null,t=_;else e=null,t=_;return e}function Ys(){var e;return e=an(),e===null&&(e=fn(),e===null&&(e=cn(),e===null&&(e=hn(),e===null&&(e=dn(),e===null&&(e=ie()))))),e}function an(){var e,r,n,i,o;return i=t,o=t,s.substr(t,3).toLowerCase()==="ttl"?(e=s.substr(t,3),t+=3):(e=null,u===0&&c('"ttl"')),e!==null?(r=Y(),r!==null?(n=zs(),n!==null?e=[e,r,n]:(e=null,t=o)):(e=null,t=o)):(e=null,t=o),e!==null&&(e=(function(d,_){m.ttl=_})(i,e[2])),e===null&&(t=i),e}function fn(){var e,r,n,i,o;return i=t,o=t,s.substr(t,5).toLowerCase()==="maddr"?(e=s.substr(t,5),t+=5):(e=null,u===0&&c('"maddr"')),e!==null?(r=Y(),r!==null?(n=At(),n!==null?e=[e,r,n]:(e=null,t=o)):(e=null,t=o)):(e=null,t=o),e!==null&&(e=(function(d,_){m.maddr=_})(i,e[2])),e===null&&(t=i),e}function cn(){var e,r,n,i,o;return i=t,o=t,s.substr(t,8).toLowerCase()==="received"?(e=s.substr(t,8),t+=8):(e=null,u===0&&c('"received"')),e!==null?(r=Y(),r!==null?(n=St(),n===null&&(n=Ps()),n!==null?e=[e,r,n]:(e=null,t=o)):(e=null,t=o)):(e=null,t=o),e!==null&&(e=(function(d,_){m.received=_})(i,e[2])),e===null&&(t=i),e}function hn(){var e,r,n,i,o;return i=t,o=t,s.substr(t,6).toLowerCase()==="branch"?(e=s.substr(t,6),t+=6):(e=null,u===0&&c('"branch"')),e!==null?(r=Y(),r!==null?(n=F(),n!==null?e=[e,r,n]:(e=null,t=o)):(e=null,t=o)):(e=null,t=o),e!==null&&(e=(function(d,_){m.branch=_})(i,e[2])),e===null&&(t=i),e}function dn(){var e,r,n,i,o;return i=t,s.substr(t,5).toLowerCase()==="rport"?(e=s.substr(t,5),t+=5):(e=null,u===0&&c('"rport"')),e!==null?(o=t,r=Y(),r!==null?(n=_n(),n!==null?r=[r,n]:(r=null,t=o)):(r=null,t=o),r=r!==null?r:"",r!==null?e=[e,r]:(e=null,t=i)):(e=null,t=i),e}function _n(){var e,r,n,i,o,d,_;return d=t,_=t,e=x(),e=e!==null?e:"",e!==null?(r=x(),r=r!==null?r:"",r!==null?(n=x(),n=n!==null?n:"",n!==null?(i=x(),i=i!==null?i:"",i!==null?(o=x(),o=o!==null?o:"",o!==null?e=[e,r,n,i,o]:(e=null,t=_)):(e=null,t=_)):(e=null,t=_)):(e=null,t=_)):(e=null,t=_),e!==null&&(e=(function(T,A){m.rport=parseInt(A.join(""))})(d,e)),e===null&&(t=d),e}function pn(){var e,r,n,i,o,d;return d=t,e=mn(),e!==null?(r=Me(),r!==null?(n=F(),n!==null?(i=Me(),i!==null?(o=gn(),o!==null?e=[e,r,n,i,o]:(e=null,t=d)):(e=null,t=d)):(e=null,t=d)):(e=null,t=d)):(e=null,t=d),e}function mn(){var e,r;return r=t,s.substr(t,3).toLowerCase()==="sip"?(e=s.substr(t,3),t+=3):(e=null,u===0&&c('"SIP"')),e===null&&(e=F()),e!==null&&(e=(function(n,i){m.protocol=i})(r,e)),e===null&&(t=r),e}function gn(){var e,r;return r=t,s.substr(t,3).toLowerCase()==="udp"?(e=s.substr(t,3),t+=3):(e=null,u===0&&c('"UDP"')),e===null&&(s.substr(t,3).toLowerCase()==="tcp"?(e=s.substr(t,3),t+=3):(e=null,u===0&&c('"TCP"')),e===null&&(s.substr(t,3).toLowerCase()==="tls"?(e=s.substr(t,3),t+=3):(e=null,u===0&&c('"TLS"')),e===null&&(s.substr(t,4).toLowerCase()==="sctp"?(e=s.substr(t,4),t+=4):(e=null,u===0&&c('"SCTP"')),e===null&&(e=F())))),e!==null&&(e=(function(n,i){m.transport=i})(r,e)),e===null&&(t=r),e}function Tn(){var e,r,n,i,o;return i=t,e=Cn(),e!==null?(o=t,r=ee(),r!==null?(n=En(),n!==null?r=[r,n]:(r=null,t=o)):(r=null,t=o),r=r!==null?r:"",r!==null?e=[e,r]:(e=null,t=i)):(e=null,t=i),e}function Cn(){var e,r;return r=t,e=St(),e===null&&(e=Us(),e===null&&(e=xs())),e!==null&&(e=(function(n){m.host=s.substring(t,n)})(r)),e===null&&(t=r),e}function En(){var e,r,n,i,o,d,_;return d=t,_=t,e=x(),e=e!==null?e:"",e!==null?(r=x(),r=r!==null?r:"",r!==null?(n=x(),n=n!==null?n:"",n!==null?(i=x(),i=i!==null?i:"",i!==null?(o=x(),o=o!==null?o:"",o!==null?e=[e,r,n,i,o]:(e=null,t=_)):(e=null,t=_)):(e=null,t=_)):(e=null,t=_)):(e=null,t=_),e!==null&&(e=(function(T,A){m.port=parseInt(A.join(""))})(d,e)),e===null&&(t=d),e}function zs(){var e,r,n,i,o;return i=t,o=t,e=x(),e!==null?(r=x(),r=r!==null?r:"",r!==null?(n=x(),n=n!==null?n:"",n!==null?e=[e,r,n]:(e=null,t=o)):(e=null,t=o)):(e=null,t=o),e!==null&&(e=(function(d,_){return parseInt(_.join(""))})(i,e)),e===null&&(t=i),e}function ju(){var e;return e=Ws(),e}function Ku(){var e,r,n,i,o,d;if(o=t,e=An(),e!==null){for(r=[],d=t,n=k(),n!==null?(i=Js(),i!==null?n=[n,i]:(n=null,t=d)):(n=null,t=d);n!==null;)r.push(n),d=t,n=k(),n!==null?(i=Js(),i!==null?n=[n,i]:(n=null,t=d)):(n=null,t=d);r!==null?e=[e,r]:(e=null,t=o)}else e=null,t=o;return e}function An(){var e,r;return r=t,e=Je(),e!==null&&(e=(function(n,i){m.expires=i})(r,e)),e===null&&(t=r),e}function Js(){var e;return e=Sn(),e===null&&(e=ie()),e}function Sn(){var e,r,n,i,o;return i=t,o=t,s.substr(t,9).toLowerCase()==="refresher"?(e=s.substr(t,9),t+=9):(e=null,u===0&&c('"refresher"')),e!==null?(r=Y(),r!==null?(s.substr(t,3).toLowerCase()==="uac"?(n=s.substr(t,3),t+=3):(n=null,u===0&&c('"uac"')),n===null&&(s.substr(t,3).toLowerCase()==="uas"?(n=s.substr(t,3),t+=3):(n=null,u===0&&c('"uas"'))),n!==null?e=[e,r,n]:(e=null,t=o)):(e=null,t=o)):(e=null,t=o),e!==null&&(e=(function(d,_){m.refresher=_.toLowerCase()})(i,e[2])),e===null&&(t=i),e}function Yu(){var e,r,n,i;return i=t,e=F(),e!==null?(r=Ve(),r!==null?(n=vn(),n!==null?e=[e,r,n]:(e=null,t=i)):(e=null,t=i)):(e=null,t=i),e}function vn(){var e,r;for(e=[],r=Ae(),r===null&&(r=ye(),r===null&&(r=re()));r!==null;)e.push(r),r=Ae(),r===null&&(r=ye(),r===null&&(r=re()));return e}function zu(){var e,r;for(e=[],r=fe();r!==null;)e.push(r),r=fe();return e}function Ju(){var e,r,n;return n=t,s.substr(t,5)==="uuid:"?(e="uuid:",t+=5):(e=null,u===0&&c('"uuid:"')),e!==null?(r=Rn(),r!==null?e=[e,r]:(e=null,t=n)):(e=null,t=n),e}function Rn(){var e,r,n,i,o,d,_,T,A,M,J;return M=t,J=t,e=bn(),e!==null?(s.charCodeAt(t)===45?(r="-",t++):(r=null,u===0&&c('"-"')),r!==null?(n=Fe(),n!==null?(s.charCodeAt(t)===45?(i="-",t++):(i=null,u===0&&c('"-"')),i!==null?(o=Fe(),o!==null?(s.charCodeAt(t)===45?(d="-",t++):(d=null,u===0&&c('"-"')),d!==null?(_=Fe(),_!==null?(s.charCodeAt(t)===45?(T="-",t++):(T=null,u===0&&c('"-"')),T!==null?(A=wn(),A!==null?e=[e,r,n,i,o,d,_,T,A]:(e=null,t=J)):(e=null,t=J)):(e=null,t=J)):(e=null,t=J)):(e=null,t=J)):(e=null,t=J)):(e=null,t=J)):(e=null,t=J)):(e=null,t=J),e!==null&&(e=(function(Ne,is){m=s.substring(t+5,Ne)})(M,e[0])),e===null&&(t=M),e}function Fe(){var e,r,n,i,o;return o=t,e=w(),e!==null?(r=w(),r!==null?(n=w(),n!==null?(i=w(),i!==null?e=[e,r,n,i]:(e=null,t=o)):(e=null,t=o)):(e=null,t=o)):(e=null,t=o),e}function bn(){var e,r,n;return n=t,e=Fe(),e!==null?(r=Fe(),r!==null?e=[e,r]:(e=null,t=n)):(e=null,t=n),e}function wn(){var e,r,n,i;return i=t,e=Fe(),e!==null?(r=Fe(),r!==null?(n=Fe(),n!==null?e=[e,r,n]:(e=null,t=i)):(e=null,t=i)):(e=null,t=i),e}function Xu(){var e,r,n,i,o,d,_;if(o=t,d=t,e=Et(),e===null&&(e=ze()),e!==null){for(r=[],_=t,n=k(),n!==null?(i=ie(),i!==null?n=[n,i]:(n=null,t=_)):(n=null,t=_);n!==null;)r.push(n),_=t,n=k(),n!==null?(i=ie(),i!==null?n=[n,i]:(n=null,t=_)):(n=null,t=_);r!==null?e=[e,r]:(e=null,t=d)}else e=null,t=d;return e!==null&&(e=(function(T){try{m=new nt(m.uri,m.display_name,m.params)}catch(A){m=-1}})(o)),e===null&&(t=o),e}function Qu(){var e,r,n,i,o,d;if(o=t,e=yn(),e!==null){for(r=[],d=t,n=k(),n!==null?(i=Xs(),i!==null?n=[n,i]:(n=null,t=d)):(n=null,t=d);n!==null;)r.push(n),d=t,n=k(),n!==null?(i=Xs(),i!==null?n=[n,i]:(n=null,t=d)):(n=null,t=d);r!==null?e=[e,r]:(e=null,t=o)}else e=null,t=o;return e}function yn(){var e,r,n,i,o,d;return i=t,o=t,e=Ie(),e!==null?(d=t,s.charCodeAt(t)===64?(r="@",t++):(r=null,u===0&&c('"@"')),r!==null?(n=Ie(),n!==null?r=[r,n]:(r=null,t=d)):(r=null,t=d),r=r!==null?r:"",r!==null?e=[e,r]:(e=null,t=o)):(e=null,t=o),e!==null&&(e=(function(_){m.call_id=s.substring(t,_)})(i)),e===null&&(t=i),e}function Xs(){var e;return e=In(),e===null&&(e=Nn(),e===null&&(e=On(),e===null&&(e=ie()))),e}function In(){var e,r,n,i,o;return i=t,o=t,s.substr(t,6)==="to-tag"?(e="to-tag",t+=6):(e=null,u===0&&c('"to-tag"')),e!==null?(r=Y(),r!==null?(n=F(),n!==null?e=[e,r,n]:(e=null,t=o)):(e=null,t=o)):(e=null,t=o),e!==null&&(e=(function(d,_){m.to_tag=_})(i,e[2])),e===null&&(t=i),e}function Nn(){var e,r,n,i,o;return i=t,o=t,s.substr(t,8)==="from-tag"?(e="from-tag",t+=8):(e=null,u===0&&c('"from-tag"')),e!==null?(r=Y(),r!==null?(n=F(),n!==null?e=[e,r,n]:(e=null,t=o)):(e=null,t=o)):(e=null,t=o),e!==null&&(e=(function(d,_){m.from_tag=_})(i,e[2])),e===null&&(t=i),e}function On(){var e,r;return r=t,s.substr(t,10)==="early-only"?(e="early-only",t+=10):(e=null,u===0&&c('"early-only"')),e!==null&&(e=(function(n){m.early_only=!0})(r)),e===null&&(t=r),e}function Zu(e){e.sort();for(var r=null,n=[],i=0;i<e.length;i++)e[i]!==r&&(n.push(e[i]),r=e[i]);return n}function eo(){for(var e=1,r=1,n=!1,i=0;i<Math.max(t,p);i++){var o=s.charAt(i);o==="\n"?(n||e++,r=1,n=!1):o==="\r"||o==="\u2028"||o==="\u2029"?(e++,r=1,n=!0):(r++,n=!1)}return{line:e,column:r}}var xn=qe(),nt=us(),m={},to=h[a]();if(to===null||t!==s.length){var Qs=Math.max(t,p),so=Qs<s.length?s.charAt(Qs):null,Dn=eo();return new this.SyntaxError(Zu(g),so,Qs,Dn.line,Dn.column),-1}return m},toSource:function(){return this._source}};return l.SyntaxError=function(s,a,h,t,u){function p(g,S){var N,c;switch(g.length){case 0:N="end of input";break;case 1:N=g[0];break;default:N=g.slice(0,g.length-1).join(", ")+" or "+g[g.length-1]}return c=S?f(S):"end of input","Expected "+N+" but "+c+" found."}this.name="SyntaxError",this.expected=s,this.found=a,this.message=p(s,a),this.offset=h,this.line=t,this.column=u},l.SyntaxError.prototype=Error.prototype,l})()});var qe=W((Rf,$n)=>{var uo=le(),it=ce(),oo=Re();$n.exports=class qn{static parse(l){if(l=oo.parse(l,"SIP_URI"),l!==-1)return l}constructor(l,s,a,h,t={},u={}){if(!a)throw new TypeError('missing or invalid "host" parameter');this._parameters={},this._headers={},this._scheme=l||uo.SIP,this._user=s,this._host=a,this._port=h;for(let p in t)Object.prototype.hasOwnProperty.call(t,p)&&this.setParam(p,t[p]);for(let p in u)Object.prototype.hasOwnProperty.call(u,p)&&this.setHeader(p,u[p])}get scheme(){return this._scheme}set scheme(l){this._scheme=l.toLowerCase()}get user(){return this._user}set user(l){this._user=l}get host(){return this._host}set host(l){this._host=l.toLowerCase()}get port(){return this._port}set port(l){this._port=l===0?l:parseInt(l,10)||null}setParam(l,s){l&&(this._parameters[l.toLowerCase()]=typeof s=="undefined"||s===null?null:s.toString())}getParam(l){if(l)return this._parameters[l.toLowerCase()]}hasParam(l){if(l)return this._parameters.hasOwnProperty(l.toLowerCase())&&!0||!1}deleteParam(l){if(l=l.toLowerCase(),this._parameters.hasOwnProperty(l)){let s=this._parameters[l];return delete this._parameters[l],s}}clearParams(){this._parameters={}}setHeader(l,s){this._headers[it.headerize(l)]=Array.isArray(s)?s:[s]}getHeader(l){if(l)return this._headers[it.headerize(l)]}hasHeader(l){if(l)return this._headers.hasOwnProperty(it.headerize(l))&&!0||!1}deleteHeader(l){if(l=it.headerize(l),this._headers.hasOwnProperty(l)){let s=this._headers[l];return delete this._headers[l],s}}clearHeaders(){this._headers={}}clone(){return new qn(this._scheme,this._user,this._host,this._port,JSON.parse(JSON.stringify(this._parameters)),JSON.parse(JSON.stringify(this._headers)))}toString(){let l=[],s="".concat(this._scheme,":");this._user&&(s+="".concat(it.escapeUser(this._user),"@")),s+=this._host,(this._port||this._port===0)&&(s+=":".concat(this._port));for(let a in this._parameters)Object.prototype.hasOwnProperty.call(this._parameters,a)&&(s+=";".concat(a),this._parameters[a]!==null&&(s+="=".concat(this._parameters[a])));for(let a in this._headers)if(Object.prototype.hasOwnProperty.call(this._headers,a))for(let h of this._headers[a])l.push("".concat(a,"=").concat(h));return l.length>0&&(s+="?".concat(l.join("&"))),s}toAor(l){let s="".concat(this._scheme,":");return this._user&&(s+="".concat(it.escapeUser(this._user),"@")),s+=this._host,l&&(this._port||this._port===0)&&(s+=":".concat(this._port)),s}}});var ce=W(ue=>{var Ot=le(),kn=qe(),ao=Re();ue.str_utf8_length=f=>unescape(encodeURIComponent(f)).length;var fo=ue.isFunction=f=>f!==void 0?Object.prototype.toString.call(f)==="[object Function]":!1;ue.isString=f=>f!==void 0?Object.prototype.toString.call(f)==="[object String]":!1;ue.isDecimal=f=>!isNaN(f)&&parseFloat(f)===parseInt(f,10);ue.isEmpty=f=>f===null||f===""||f===void 0||Array.isArray(f)&&f.length===0||typeof f=="number"&&isNaN(f);ue.hasMethods=function(f,...l){for(let s of l)if(fo(f[s]))return!1;return!0};var co=ue.createRandomToken=(f,l=32)=>{let s,a,h="";for(s=0;s<f;s++)a=Math.random()*l|0,h+=a.toString(l);return h};ue.newTag=()=>co(10);ue.newUUID=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,l=>{let s=Math.random()*16|0;return(l==="x"?s:s&3|8).toString(16)});ue.hostType=f=>{if(f){if(f=ao.parse(f,"host"),f!==-1)return f.host_type}else return};var ho=ue.escapeUser=f=>encodeURIComponent(decodeURIComponent(f)).replace(/%3A/ig,":").replace(/%2B/ig,"+").replace(/%3F/ig,"?").replace(/%2F/ig,"/");ue.normalizeTarget=(f,l)=>{if(f){if(f instanceof kn)return f;if(typeof f=="string"){let s=f.split("@"),a,h;switch(s.length){case 1:if(!l)return;a=f,h=l;break;case 2:a=s[0],h=s[1];break;default:a=s.slice(0,s.length-1).join("@"),h=s[s.length-1]}a=a.replace(/^(sips?|tel):/i,""),/^[-.()]*\+?[0-9\-.()]+$/.test(a)&&(a=a.replace(/[-.()]/g,"")),f="".concat(Ot.SIP,":").concat(ho(a),"@").concat(h);let t;return(t=kn.parse(f))?t:void 0}else return}else return};ue.headerize=f=>{let l={"Call-Id":"Call-ID",Cseq:"CSeq","Www-Authenticate":"WWW-Authenticate"},s=f.toLowerCase().replace(/_/g,"-").split("-"),a="",h=s.length,t;for(t=0;t<h;t++)t!==0&&(a+="-"),a+=s[t].charAt(0).toUpperCase()+s[t].substring(1);return l[a]&&(a=l[a]),a};ue.sipErrorCause=f=>{for(let l in Ot.SIP_ERROR_CAUSES)if(Ot.SIP_ERROR_CAUSES[l].indexOf(f)!==-1)return Ot.causes[l];return Ot.causes.SIP_FAILURE_CODE};ue.getRandomTestNetIP=()=>{function f(l,s){return Math.floor(Math.random()*(s-l+1)+l)}return"192.0.2.".concat(f(1,254))};ue.calculateMD5=f=>{function l(G,q){return G<<q|G>>>32-q}function s(G,q){let V=G&2147483648,j=q&2147483648,B=G&1073741824,k=q&1073741824,ee=(G&1073741823)+(q&1073741823);return B&k?ee^2147483648^V^j:B|k?ee&1073741824?ee^3221225472^V^j:ee^1073741824^V^j:ee^V^j}function a(G,q,V){return G&q|~G&V}function h(G,q,V){return G&V|q&~V}function t(G,q,V){return G^q^V}function u(G,q,V){return q^(G|~V)}function p(G,q,V,j,B,k,ee){return G=s(G,s(s(a(q,V,j),B),ee)),s(l(G,k),q)}function g(G,q,V,j,B,k,ee){return G=s(G,s(s(h(q,V,j),B),ee)),s(l(G,k),q)}function S(G,q,V,j,B,k,ee){return G=s(G,s(s(t(q,V,j),B),ee)),s(l(G,k),q)}function N(G,q,V,j,B,k,ee){return G=s(G,s(s(u(q,V,j),B),ee)),s(l(G,k),q)}function c(G){let q,V=G.length,j=V+8,k=((j-j%64)/64+1)*16,ee=new Array(k-1),Be=0,Te=0;for(;Te<V;)q=(Te-Te%4)/4,Be=Te%4*8,ee[q]=ee[q]|G.charCodeAt(Te)<<Be,Te++;return q=(Te-Te%4)/4,Be=Te%4*8,ee[q]=ee[q]|128<<Be,ee[k-2]=V<<3,ee[k-1]=V>>>29,ee}function $(G){let q="",V="",j,B;for(B=0;B<=3;B++)j=G>>>B*8&255,V="0".concat(j.toString(16)),q=q+V.substr(V.length-2,2);return q}function x(G){let q="";for(let V=0;V<G.length;V++){let j=G.charCodeAt(V);j<128?q+=String.fromCharCode(j):j>127&&j<2048?(q+=String.fromCharCode(j>>6|192),q+=String.fromCharCode(j&63|128)):(q+=String.fromCharCode(j>>12|224),q+=String.fromCharCode(j>>6&63|128),q+=String.fromCharCode(j&63|128))}return q}let O=[],w,H,fe,se,ne,y,b,I,R,we=7,Z=12,re=17,K=22,Ve=5,je=9,Ae=14,ve=20,ye=4,rt=11,F=16,Le=23,lt=6,Ie=10,Ke=15,Me=21;for(f=x(f),O=c(f),y=1732584193,b=4023233417,I=2562383102,R=271733878,w=0;w<O.length;w+=16)H=y,fe=b,se=I,ne=R,y=p(y,b,I,R,O[w+0],we,3614090360),R=p(R,y,b,I,O[w+1],Z,3905402710),I=p(I,R,y,b,O[w+2],re,606105819),b=p(b,I,R,y,O[w+3],K,3250441966),y=p(y,b,I,R,O[w+4],we,4118548399),R=p(R,y,b,I,O[w+5],Z,1200080426),I=p(I,R,y,b,O[w+6],re,2821735955),b=p(b,I,R,y,O[w+7],K,4249261313),y=p(y,b,I,R,O[w+8],we,1770035416),R=p(R,y,b,I,O[w+9],Z,2336552879),I=p(I,R,y,b,O[w+10],re,4294925233),b=p(b,I,R,y,O[w+11],K,2304563134),y=p(y,b,I,R,O[w+12],we,1804603682),R=p(R,y,b,I,O[w+13],Z,4254626195),I=p(I,R,y,b,O[w+14],re,2792965006),b=p(b,I,R,y,O[w+15],K,1236535329),y=g(y,b,I,R,O[w+1],Ve,4129170786),R=g(R,y,b,I,O[w+6],je,3225465664),I=g(I,R,y,b,O[w+11],Ae,643717713),b=g(b,I,R,y,O[w+0],ve,3921069994),y=g(y,b,I,R,O[w+5],Ve,3593408605),R=g(R,y,b,I,O[w+10],je,38016083),I=g(I,R,y,b,O[w+15],Ae,3634488961),b=g(b,I,R,y,O[w+4],ve,3889429448),y=g(y,b,I,R,O[w+9],Ve,568446438),R=g(R,y,b,I,O[w+14],je,3275163606),I=g(I,R,y,b,O[w+3],Ae,4107603335),b=g(b,I,R,y,O[w+8],ve,1163531501),y=g(y,b,I,R,O[w+13],Ve,2850285829),R=g(R,y,b,I,O[w+2],je,4243563512),I=g(I,R,y,b,O[w+7],Ae,1735328473),b=g(b,I,R,y,O[w+12],ve,2368359562),y=S(y,b,I,R,O[w+5],ye,4294588738),R=S(R,y,b,I,O[w+8],rt,2272392833),I=S(I,R,y,b,O[w+11],F,1839030562),b=S(b,I,R,y,O[w+14],Le,4259657740),y=S(y,b,I,R,O[w+1],ye,2763975236),R=S(R,y,b,I,O[w+4],rt,1272893353),I=S(I,R,y,b,O[w+7],F,4139469664),b=S(b,I,R,y,O[w+10],Le,3200236656),y=S(y,b,I,R,O[w+13],ye,681279174),R=S(R,y,b,I,O[w+0],rt,3936430074),I=S(I,R,y,b,O[w+3],F,3572445317),b=S(b,I,R,y,O[w+6],Le,76029189),y=S(y,b,I,R,O[w+9],ye,3654602809),R=S(R,y,b,I,O[w+12],rt,3873151461),I=S(I,R,y,b,O[w+15],F,530742520),b=S(b,I,R,y,O[w+2],Le,3299628645),y=N(y,b,I,R,O[w+0],lt,4096336452),R=N(R,y,b,I,O[w+7],Ie,1126891415),I=N(I,R,y,b,O[w+14],Ke,2878612391),b=N(b,I,R,y,O[w+5],Me,4237533241),y=N(y,b,I,R,O[w+12],lt,1700485571),R=N(R,y,b,I,O[w+3],Ie,2399980690),I=N(I,R,y,b,O[w+10],Ke,4293915773),b=N(b,I,R,y,O[w+1],Me,2240044497),y=N(y,b,I,R,O[w+8],lt,1873313359),R=N(R,y,b,I,O[w+15],Ie,4264355552),I=N(I,R,y,b,O[w+6],Ke,2734768916),b=N(b,I,R,y,O[w+13],Me,1309151649),y=N(y,b,I,R,O[w+4],lt,4149444226),R=N(R,y,b,I,O[w+11],Ie,3174756917),I=N(I,R,y,b,O[w+2],Ke,718787259),b=N(b,I,R,y,O[w+9],Me,3951481745),y=s(y,H),b=s(b,fe),I=s(I,se),R=s(R,ne);return($(y)+$(b)+$(I)+$(R)).toLowerCase()};ue.closeMediaStream=f=>{if(f)try{let l;if(f.getTracks){l=f.getTracks();for(let s of l)s.stop()}else{l=f.getAudioTracks();for(let s of l)s.stop();l=f.getVideoTracks();for(let s of l)s.stop()}}catch(l){(typeof f.stop=="function"||typeof f.stop=="object")&&f.stop()}};ue.cloneArray=f=>f&&f.slice()||[];ue.cloneObject=(f,l={})=>f&&Object.assign({},f)||l});var $e=W((wf,nr)=>{"use strict";var ut=typeof Reflect=="object"?Reflect:null,Gn=ut&&typeof ut.apply=="function"?ut.apply:function(l,s,a){return Function.prototype.apply.call(l,s,a)},os;ut&&typeof ut.ownKeys=="function"?os=ut.ownKeys:Object.getOwnPropertySymbols?os=function(l){return Object.getOwnPropertyNames(l).concat(Object.getOwnPropertySymbols(l))}:os=function(l){return Object.getOwnPropertyNames(l)};function _o(f){console&&console.warn&&console.warn(f)}var Wn=Number.isNaN||function(l){return l!==l};function z(){z.init.call(this)}nr.exports=z;nr.exports.once=To;z.EventEmitter=z;z.prototype._events=void 0;z.prototype._eventsCount=0;z.prototype._maxListeners=void 0;var Bn=10;function as(f){if(typeof f!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof f)}Object.defineProperty(z,"defaultMaxListeners",{enumerable:!0,get:function(){return Bn},set:function(f){if(typeof f!="number"||f<0||Wn(f))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+f+".");Bn=f}});z.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};z.prototype.setMaxListeners=function(l){if(typeof l!="number"||l<0||Wn(l))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+l+".");return this._maxListeners=l,this};function Vn(f){return f._maxListeners===void 0?z.defaultMaxListeners:f._maxListeners}z.prototype.getMaxListeners=function(){return Vn(this)};z.prototype.emit=function(l){for(var s=[],a=1;a<arguments.length;a++)s.push(arguments[a]);var h=l==="error",t=this._events;if(t!==void 0)h=h&&t.error===void 0;else if(!h)return!1;if(h){var u;if(s.length>0&&(u=s[0]),u instanceof Error)throw u;var p=new Error("Unhandled error."+(u?" ("+u.message+")":""));throw p.context=u,p}var g=t[l];if(g===void 0)return!1;if(typeof g=="function")Gn(g,this,s);else for(var S=g.length,N=Jn(g,S),a=0;a<S;++a)Gn(N[a],this,s);return!0};function jn(f,l,s,a){var h,t,u;if(as(s),t=f._events,t===void 0?(t=f._events=Object.create(null),f._eventsCount=0):(t.newListener!==void 0&&(f.emit("newListener",l,s.listener?s.listener:s),t=f._events),u=t[l]),u===void 0)u=t[l]=s,++f._eventsCount;else if(typeof u=="function"?u=t[l]=a?[s,u]:[u,s]:a?u.unshift(s):u.push(s),h=Vn(f),h>0&&u.length>h&&!u.warned){u.warned=!0;var p=new Error("Possible EventEmitter memory leak detected. "+u.length+" "+String(l)+" listeners added. Use emitter.setMaxListeners() to increase limit");p.name="MaxListenersExceededWarning",p.emitter=f,p.type=l,p.count=u.length,_o(p)}return f}z.prototype.addListener=function(l,s){return jn(this,l,s,!1)};z.prototype.on=z.prototype.addListener;z.prototype.prependListener=function(l,s){return jn(this,l,s,!0)};function po(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Kn(f,l,s){var a={fired:!1,wrapFn:void 0,target:f,type:l,listener:s},h=po.bind(a);return h.listener=s,a.wrapFn=h,h}z.prototype.once=function(l,s){return as(s),this.on(l,Kn(this,l,s)),this};z.prototype.prependOnceListener=function(l,s){return as(s),this.prependListener(l,Kn(this,l,s)),this};z.prototype.removeListener=function(l,s){var a,h,t,u,p;if(as(s),h=this._events,h===void 0)return this;if(a=h[l],a===void 0)return this;if(a===s||a.listener===s)--this._eventsCount===0?this._events=Object.create(null):(delete h[l],h.removeListener&&this.emit("removeListener",l,a.listener||s));else if(typeof a!="function"){for(t=-1,u=a.length-1;u>=0;u--)if(a[u]===s||a[u].listener===s){p=a[u].listener,t=u;break}if(t<0)return this;t===0?a.shift():mo(a,t),a.length===1&&(h[l]=a[0]),h.removeListener!==void 0&&this.emit("removeListener",l,p||s)}return this};z.prototype.off=z.prototype.removeListener;z.prototype.removeAllListeners=function(l){var s,a,h;if(a=this._events,a===void 0)return this;if(a.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):a[l]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete a[l]),this;if(arguments.length===0){var t=Object.keys(a),u;for(h=0;h<t.length;++h)u=t[h],u!=="removeListener"&&this.removeAllListeners(u);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(s=a[l],typeof s=="function")this.removeListener(l,s);else if(s!==void 0)for(h=s.length-1;h>=0;h--)this.removeListener(l,s[h]);return this};function Yn(f,l,s){var a=f._events;if(a===void 0)return[];var h=a[l];return h===void 0?[]:typeof h=="function"?s?[h.listener||h]:[h]:s?go(h):Jn(h,h.length)}z.prototype.listeners=function(l){return Yn(this,l,!0)};z.prototype.rawListeners=function(l){return Yn(this,l,!1)};z.listenerCount=function(f,l){return typeof f.listenerCount=="function"?f.listenerCount(l):zn.call(f,l)};z.prototype.listenerCount=zn;function zn(f){var l=this._events;if(l!==void 0){var s=l[f];if(typeof s=="function")return 1;if(s!==void 0)return s.length}return 0}z.prototype.eventNames=function(){return this._eventsCount>0?os(this._events):[]};function Jn(f,l){for(var s=new Array(l),a=0;a<l;++a)s[a]=f[a];return s}function mo(f,l){for(;l+1<f.length;l++)f[l]=f[l+1];f.pop()}function go(f){for(var l=new Array(f.length),s=0;s<l.length;++s)l[s]=f[s].listener||f[s];return l}function To(f,l){return new Promise(function(s,a){function h(u){f.removeListener(l,t),a(u)}function t(){typeof f.removeListener=="function"&&f.removeListener("error",h),s([].slice.call(arguments))}Xn(f,l,t,{once:!0}),l!=="error"&&Co(f,h,{once:!0})})}function Co(f,l,s){typeof f.on=="function"&&Xn(f,"error",l,s)}function Xn(f,l,s,a){if(typeof f.on=="function")a.once?f.once(l,s):f.on(l,s);else if(typeof f.addEventListener=="function")f.addEventListener(l,function h(t){a.once&&f.removeEventListener(l,h),s(t)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof f)}});var Zn=W((yf,Qn)=>{var ot=1e3,at=ot*60,ft=at*60,Xe=ft*24,Eo=Xe*7,Ao=Xe*365.25;Qn.exports=function(f,l){l=l||{};var s=typeof f;if(s==="string"&&f.length>0)return So(f);if(s==="number"&&isFinite(f))return l.long?Ro(f):vo(f);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(f))};function So(f){if(f=String(f),!(f.length>100)){var l=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(f);if(l){var s=parseFloat(l[1]),a=(l[2]||"ms").toLowerCase();switch(a){case"years":case"year":case"yrs":case"yr":case"y":return s*Ao;case"weeks":case"week":case"w":return s*Eo;case"days":case"day":case"d":return s*Xe;case"hours":case"hour":case"hrs":case"hr":case"h":return s*ft;case"minutes":case"minute":case"mins":case"min":case"m":return s*at;case"seconds":case"second":case"secs":case"sec":case"s":return s*ot;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return s;default:return}}}}function vo(f){var l=Math.abs(f);return l>=Xe?Math.round(f/Xe)+"d":l>=ft?Math.round(f/ft)+"h":l>=at?Math.round(f/at)+"m":l>=ot?Math.round(f/ot)+"s":f+"ms"}function Ro(f){var l=Math.abs(f);return l>=Xe?fs(f,l,Xe,"day"):l>=ft?fs(f,l,ft,"hour"):l>=at?fs(f,l,at,"minute"):l>=ot?fs(f,l,ot,"second"):f+" ms"}function fs(f,l,s,a){var h=l>=s*1.5;return Math.round(f/s)+" "+a+(h?"s":"")}});var ti=W((If,ei)=>{function bo(f){s.debug=s,s.default=s,s.coerce=g,s.disable=u,s.enable=h,s.enabled=p,s.humanize=Zn(),s.destroy=S,Object.keys(f).forEach(N=>{s[N]=f[N]}),s.names=[],s.skips=[],s.formatters={};function l(N){let c=0;for(let $=0;$<N.length;$++)c=(c<<5)-c+N.charCodeAt($),c|=0;return s.colors[Math.abs(c)%s.colors.length]}s.selectColor=l;function s(N){let c,$=null,x,O;function w(...H){if(!w.enabled)return;let fe=w,se=Number(new Date),ne=se-(c||se);fe.diff=ne,fe.prev=c,fe.curr=se,c=se,H[0]=s.coerce(H[0]),typeof H[0]!="string"&&H.unshift("%O");let y=0;H[0]=H[0].replace(/%([a-zA-Z%])/g,(I,R)=>{if(I==="%%")return"%";y++;let we=s.formatters[R];if(typeof we=="function"){let Z=H[y];I=we.call(fe,Z),H.splice(y,1),y--}return I}),s.formatArgs.call(fe,H),(fe.log||s.log).apply(fe,H)}return w.namespace=N,w.useColors=s.useColors(),w.color=s.selectColor(N),w.extend=a,w.destroy=s.destroy,Object.defineProperty(w,"enabled",{enumerable:!0,configurable:!1,get:()=>$!==null?$:(x!==s.namespaces&&(x=s.namespaces,O=s.enabled(N)),O),set:H=>{$=H}}),typeof s.init=="function"&&s.init(w),w}function a(N,c){let $=s(this.namespace+(typeof c=="undefined"?":":c)+N);return $.log=this.log,$}function h(N){s.save(N),s.namespaces=N,s.names=[],s.skips=[];let c=(typeof N=="string"?N:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(let $ of c)$[0]==="-"?s.skips.push($.slice(1)):s.names.push($)}function t(N,c){let $=0,x=0,O=-1,w=0;for(;$<N.length;)if(x<c.length&&(c[x]===N[$]||c[x]==="*"))c[x]==="*"?(O=x,w=$,x++):($++,x++);else if(O!==-1)x=O+1,w++,$=w;else return!1;for(;x<c.length&&c[x]==="*";)x++;return x===c.length}function u(){let N=[...s.names,...s.skips.map(c=>"-"+c)].join(",");return s.enable(""),N}function p(N){for(let c of s.skips)if(t(N,c))return!1;for(let c of s.names)if(t(N,c))return!0;return!1}function g(N){return N instanceof Error?N.stack||N.message:N}function S(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return s.enable(s.load()),s}ei.exports=bo});var hs=W((ge,cs)=>{ge.formatArgs=yo;ge.save=Io;ge.load=No;ge.useColors=wo;ge.storage=Oo();ge.destroy=(()=>{let f=!1;return()=>{f||(f=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();ge.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function wo(){if(typeof window!="undefined"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let f;return typeof document!="undefined"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!="undefined"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!="undefined"&&navigator.userAgent&&(f=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(f[1],10)>=31||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function yo(f){if(f[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+f[0]+(this.useColors?"%c ":" ")+"+"+cs.exports.humanize(this.diff),!this.useColors)return;let l="color: "+this.color;f.splice(1,0,l,"color: inherit");let s=0,a=0;f[0].replace(/%[a-zA-Z%]/g,h=>{h!=="%%"&&(s++,h==="%c"&&(a=s))}),f.splice(a,0,l)}ge.log=console.debug||console.log||(()=>{});function Io(f){try{f?ge.storage.setItem("debug",f):ge.storage.removeItem("debug")}catch(l){}}function No(){let f;try{f=ge.storage.getItem("debug")||ge.storage.getItem("DEBUG")}catch(l){}return!f&&typeof process!="undefined"&&"env"in process&&(f=process.env.DEBUG),f}function Oo(){try{return localStorage}catch(f){}}cs.exports=ti()(ge);var{formatters:xo}=cs.exports;xo.j=function(f){try{return JSON.stringify(f)}catch(l){return"[UnexpectedJSONParseError]: "+l.message}}});var ae=W((Of,si)=>{var ct=hs(),ht="JsSIP";si.exports=class{constructor(l){l?(this._debug=ct.default("".concat(ht,":").concat(l)),this._warn=ct.default("".concat(ht,":WARN:").concat(l)),this._error=ct.default("".concat(ht,":ERROR:").concat(l))):(this._debug=ct.default(ht),this._warn=ct.default("".concat(ht,":WARN")),this._error=ct.default("".concat(ht,":ERROR"))),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}}});var ds=W((xf,li)=>{var ri=li.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(f){return f.encoding?"rtpmap:%d %s/%s/%s":f.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(f){return f.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(f){return f.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(f){return"extmap:%d"+(f.direction?"/%s":"%v")+(f["encrypt-uri"]?" %s":"%v")+" %s"+(f.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(f){return f.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(f){var l="candidate:%s %d %s %d %s %d typ %s";return l+=f.raddr!=null?" raddr %s rport %d":"%v%v",l+=f.tcptype!=null?" tcptype %s":"%v",f.generation!=null&&(l+=" generation %d"),l+=f["network-id"]!=null?" network-id %d":"%v",l+=f["network-cost"]!=null?" network-cost %d":"%v",l}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(f){var l="ssrc:%d";return f.attribute!=null&&(l+=" %s",f.value!=null&&(l+=":%s")),l}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(f){return f.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(f){return f.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(f){return"imageattr:%s %s %s"+(f.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(f){return"simulcast:%s %s"+(f.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(f){return"ts-refclk:%s"+(f.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(f){var l="mediaclk:";return l+=f.id!=null?"id=%s %s":"%v%s",l+=f.mediaClockValue!=null?"=%s":"",l+=f.rateNumerator!=null?" rate=%s":"",l+=f.rateDenominator!=null?"/%s":"",l}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(ri).forEach(function(f){var l=ri[f];l.forEach(function(s){s.reg||(s.reg=/(.*)/),s.format||(s.format="%s")})})});var ui=W(ke=>{var dt=function(f){return String(Number(f))===f?Number(f):f},Do=function(f,l,s,a){if(a&&!s)l[a]=dt(f[1]);else for(var h=0;h<s.length;h+=1)f[h+1]!=null&&(l[s[h]]=dt(f[h+1]))},Uo=function(f,l,s){var a=f.name&&f.names;f.push&&!l[f.push]?l[f.push]=[]:a&&!l[f.name]&&(l[f.name]={});var h=f.push?{}:a?l[f.name]:l;Do(s.match(f.reg),h,f.names,f.name),f.push&&l[f.push].push(h)},ni=ds(),Po=RegExp.prototype.test.bind(/^([a-z])=(.*)/);ke.parse=function(f){var l={},s=[],a=l;return f.split(/(\r\n|\r|\n)/).filter(Po).forEach(function(h){var t=h[0],u=h.slice(2);t==="m"&&(s.push({rtp:[],fmtp:[]}),a=s[s.length-1]);for(var p=0;p<(ni[t]||[]).length;p+=1){var g=ni[t][p];if(g.reg.test(u))return Uo(g,a,u)}}),l.media=s,l};var ii=function(f,l){var s=l.split(/=(.+)/,2);return s.length===2?f[s[0]]=dt(s[1]):s.length===1&&l.length>1&&(f[s[0]]=void 0),f};ke.parseParams=function(f){return f.split(/;\s?/).reduce(ii,{})};ke.parseFmtpConfig=ke.parseParams;ke.parsePayloads=function(f){return f.toString().split(" ").map(Number)};ke.parseRemoteCandidates=function(f){for(var l=[],s=f.split(" ").map(dt),a=0;a<s.length;a+=3)l.push({component:s[a],ip:s[a+1],port:s[a+2]});return l};ke.parseImageAttributes=function(f){return f.split(" ").map(function(l){return l.substring(1,l.length-1).split(",").reduce(ii,{})})};ke.parseSimulcastStreamList=function(f){return f.split(";").map(function(l){return l.split(",").map(function(s){var a,h=!1;return s[0]!=="~"?a=dt(s):(a=dt(s.substring(1,s.length)),h=!0),{scid:a,paused:h}})})}});var ai=W((Uf,oi)=>{var ir=ds(),Lo=/%[sdv%]/g,Mo=function(f){var l=1,s=arguments,a=s.length;return f.replace(Lo,function(h){if(l>=a)return h;var t=s[l];switch(l+=1,h){case"%%":return"%";case"%s":return String(t);case"%d":return Number(t);case"%v":return""}})},xt=function(f,l,s){var a=l.format instanceof Function?l.format(l.push?s:s[l.name]):l.format,h=[f+"="+a];if(l.names)for(var t=0;t<l.names.length;t+=1){var u=l.names[t];l.name?h.push(s[l.name][u]):h.push(s[l.names[t]])}else h.push(s[l.name]);return Mo.apply(null,h)},Fo=["v","o","s","i","u","e","p","c","b","t","r","z","a"],Ho=["i","c","b","a"];oi.exports=function(f,l){l=l||{},f.version==null&&(f.version=0),f.name==null&&(f.name=" "),f.media.forEach(function(t){t.payloads==null&&(t.payloads="")});var s=l.outerOrder||Fo,a=l.innerOrder||Ho,h=[];return s.forEach(function(t){ir[t].forEach(function(u){u.name in f&&f[u.name]!=null?h.push(xt(t,u,f)):u.push in f&&f[u.push]!=null&&f[u.push].forEach(function(p){h.push(xt(t,u,p))})})}),f.media.forEach(function(t){h.push(xt("m",ir.m[0],t)),a.forEach(function(u){ir[u].forEach(function(p){p.name in t&&t[p.name]!=null?h.push(xt(u,p,t)):p.push in t&&t[p.push]!=null&&t[p.push].forEach(function(g){h.push(xt(u,p,g))})})})}),h.join("\r\n")+"\r\n"}});var ur=W(Oe=>{var Qe=ui(),qo=ai(),$o=ds();Oe.grammar=$o;Oe.write=qo;Oe.parse=Qe.parse;Oe.parseParams=Qe.parseParams;Oe.parseFmtpConfig=Qe.parseFmtpConfig;Oe.parsePayloads=Qe.parsePayloads;Oe.parseRemoteCandidates=Qe.parseRemoteCandidates;Oe.parseImageAttributes=Qe.parseImageAttributes;Oe.parseSimulcastStreamList=Qe.parseSimulcastStreamList});var xe=W((Lf,hi)=>{var ci=ur(),ko=ae(),he=le(),oe=ce(),fi=us(),Go=Re(),or=new ko("SIPMessage"),_s=class f{constructor(l,s,a,h,t,u){if(!l||!s||!a)return null;h=h||{},this.ua=a,this.headers={},this.method=l,this.ruri=s,this.body=u,this.extraHeaders=oe.cloneArray(t),this.ua.configuration.extra_headers&&(this.extraHeaders=this.extraHeaders.concat(this.ua.configuration.extra_headers)),h.route_set?this.setHeader("route",h.route_set):a.configuration.use_preloaded_route&&this.setHeader("route","<".concat(a.transport.sip_uri,";lr>")),this.setHeader("via",""),this.setHeader("max-forwards",he.MAX_FORWARDS);let p=h.to_uri||s,g=h.to_tag?{tag:h.to_tag}:null,S=typeof h.to_display_name!="undefined"?h.to_display_name:null;this.to=new fi(p,S,g),this.setHeader("to",this.to.toString());let N=h.from_uri||a.configuration.uri,c={tag:h.from_tag||oe.newTag()},$;typeof h.from_display_name!="undefined"?$=h.from_display_name:a.configuration.display_name?$=a.configuration.display_name:$=null,this.from=new fi(N,$,c),this.setHeader("from",this.from.toString());let x=h.call_id||a.configuration.jssip_id+oe.createRandomToken(15);this.call_id=x,this.setHeader("call-id",x);let O=h.cseq||Math.floor(Math.random()*1e4);this.cseq=O,this.setHeader("cseq","".concat(O," ").concat(l))}setHeader(l,s){let a=new RegExp("^\\s*".concat(l,"\\s*:"),"i");for(let h=0;h<this.extraHeaders.length;h++)a.test(this.extraHeaders[h])&&this.extraHeaders.splice(h,1);this.headers[oe.headerize(l)]=Array.isArray(s)?s:[s]}getHeader(l){let s=this.headers[oe.headerize(l)];if(s){if(s[0])return s[0]}else{let a=new RegExp("^\\s*".concat(l,"\\s*:"),"i");for(let h of this.extraHeaders)if(a.test(h))return h.substring(h.indexOf(":")+1).trim()}}getHeaders(l){let s=this.headers[oe.headerize(l)],a=[];if(s){for(let h of s)a.push(h);return a}else{let h=new RegExp("^\\s*".concat(l,"\\s*:"),"i");for(let t of this.extraHeaders)h.test(t)&&a.push(t.substring(t.indexOf(":")+1).trim());return a}}hasHeader(l){if(this.headers[oe.headerize(l)])return!0;{let s=new RegExp("^\\s*".concat(l,"\\s*:"),"i");for(let a of this.extraHeaders)if(s.test(a))return!0}return!1}parseSDP(l){return!l&&this.sdp?this.sdp:(this.sdp=ci.parse(this.body||""),this.sdp)}toString(){let l="".concat(this.method," ").concat(this.ruri," SIP/2.0\r\n");for(let h in this.headers)if(Object.prototype.hasOwnProperty.call(this.headers,h))for(let t of this.headers[h])l+="".concat(h,": ").concat(t,"\r\n");for(let h of this.extraHeaders)l+="".concat(h.trim(),"\r\n");let s=[];switch(this.method){case he.REGISTER:s.push("path","gruu");break;case he.INVITE:this.ua.configuration.session_timers&&s.push("timer"),(this.ua.contact.pub_gruu||this.ua.contact.temp_gruu)&&s.push("gruu"),s.push("ice","replaces");break;case he.UPDATE:this.ua.configuration.session_timers&&s.push("timer"),s.push("ice");break}s.push("outbound");let a=this.ua.configuration.user_agent||he.USER_AGENT;if(l+="Allow: ".concat(he.ALLOWED_METHODS,"\r\n"),l+="Supported: ".concat(s,"\r\n"),l+="User-Agent: ".concat(a,"\r\n"),this.body){let h=oe.str_utf8_length(this.body);l+="Content-Length: ".concat(h,"\r\n\r\n"),l+=this.body}else l+="Content-Length: 0\r\n\r\n";return l}clone(){let l=new f(this.method,this.ruri,this.ua);return Object.keys(this.headers).forEach(function(s){l.headers[s]=this.headers[s].slice()},this),l.body=this.body,l.extraHeaders=oe.cloneArray(this.extraHeaders),l.to=this.to,l.from=this.from,l.call_id=this.call_id,l.cseq=this.cseq,l}},ar=class f extends _s{constructor(l,s,a,h,t){super(he.INVITE,l,s,a,h,t),this.transaction=null}cancel(l){this.transaction.cancel(l)}clone(){let l=new f(this.ruri,this.ua);return Object.keys(this.headers).forEach(function(s){l.headers[s]=this.headers[s].slice()},this),l.body=this.body,l.extraHeaders=oe.cloneArray(this.extraHeaders),l.to=this.to,l.from=this.from,l.call_id=this.call_id,l.cseq=this.cseq,l.transaction=this.transaction,l}},ps=class{constructor(){this.data=null,this.headers=null,this.method=null,this.via=null,this.via_branch=null,this.call_id=null,this.cseq=null,this.from=null,this.from_tag=null,this.to=null,this.to_tag=null,this.body=null,this.sdp=null}addHeader(l,s){let a={raw:s};l=oe.headerize(l),this.headers[l]?this.headers[l].push(a):this.headers[l]=[a]}getHeader(l){let s=this.headers[oe.headerize(l)];if(s){if(s[0])return s[0].raw}else return}getHeaders(l){let s=this.headers[oe.headerize(l)],a=[];if(!s)return[];for(let h of s)a.push(h.raw);return a}hasHeader(l){return!!this.headers[oe.headerize(l)]}parseHeader(l,s=0){if(l=oe.headerize(l),this.headers[l]){if(s>=this.headers[l].length){or.debug('not so many "'.concat(l,'" headers present'));return}}else{or.debug('header "'.concat(l,'" not present'));return}let a=this.headers[l][s],h=a.raw;if(a.parsed)return a.parsed;let t=Go.parse(h,l.replace(/-/g,"_"));if(t===-1){this.headers[l].splice(s,1),or.debug('error parsing "'.concat(l,'" header field with value "').concat(h,'"'));return}else return a.parsed=t,t}s(l,s){return this.parseHeader(l,s)}setHeader(l,s){let a={raw:s};this.headers[oe.headerize(l)]=[a]}parseSDP(l){return!l&&this.sdp?this.sdp:(this.sdp=ci.parse(this.body||""),this.sdp)}toString(){return this.data}},fr=class extends ps{constructor(l){super(),this.ua=l,this.headers={},this.ruri=null,this.transport=null,this.server_transaction=null}reply(l,s,a,h,t,u){let p=[],g=this.getHeader("To");if(l=l||null,s=s||null,!l||l<100||l>699)throw new TypeError("Invalid status_code: ".concat(l));if(s&&typeof s!="string"&&!(s instanceof String))throw new TypeError("Invalid reason_phrase: ".concat(s));s=s||he.REASON_PHRASE[l]||"",a=oe.cloneArray(a),this.ua.configuration.extra_headers&&(a=a.concat(this.ua.configuration.extra_headers));let S="SIP/2.0 ".concat(l," ").concat(s,"\r\n");if(this.method===he.INVITE&&l>100&&l<=200){let c=this.getHeaders("record-route");for(let $ of c)S+="Record-Route: ".concat($,"\r\n")}let N=this.getHeaders("via");for(let c of N)S+="Via: ".concat(c,"\r\n");!this.to_tag&&l>100?g+=";tag=".concat(oe.newTag()):this.to_tag&&!this.s("to").hasParam("tag")&&(g+=";tag=".concat(this.to_tag)),S+="To: ".concat(g,"\r\n"),S+="From: ".concat(this.getHeader("From"),"\r\n"),S+="Call-ID: ".concat(this.call_id,"\r\n"),S+="CSeq: ".concat(this.cseq," ").concat(this.method,"\r\n");for(let c of a)S+="".concat(c.trim(),"\r\n");switch(this.method){case he.INVITE:this.ua.configuration.session_timers&&p.push("timer"),(this.ua.contact.pub_gruu||this.ua.contact.temp_gruu)&&p.push("gruu"),p.push("ice","replaces");break;case he.UPDATE:this.ua.configuration.session_timers&&p.push("timer"),h&&p.push("ice"),p.push("replaces")}if(p.push("outbound"),this.method===he.OPTIONS?(S+="Allow: ".concat(he.ALLOWED_METHODS,"\r\n"),S+="Accept: ".concat(he.ACCEPTED_BODY_TYPES,"\r\n")):l===405?S+="Allow: ".concat(he.ALLOWED_METHODS,"\r\n"):l===415&&(S+="Accept: ".concat(he.ACCEPTED_BODY_TYPES,"\r\n")),S+="Supported: ".concat(p,"\r\n"),h){let c=oe.str_utf8_length(h);S+="Content-Type: application/sdp\r\n",S+="Content-Length: ".concat(c,"\r\n\r\n"),S+=h}else S+="Content-Length: 0\r\n\r\n";this.server_transaction.receiveResponse(l,S,t,u)}reply_sl(l=null,s=null){let a=this.getHeaders("via");if(!l||l<100||l>699)throw new TypeError("Invalid status_code: ".concat(l));if(s&&typeof s!="string"&&!(s instanceof String))throw new TypeError("Invalid reason_phrase: ".concat(s));s=s||he.REASON_PHRASE[l]||"";let h="SIP/2.0 ".concat(l," ").concat(s,"\r\n");for(let u of a)h+="Via: ".concat(u,"\r\n");let t=this.getHeader("To");if(!this.to_tag&&l>100?t+=";tag=".concat(oe.newTag()):this.to_tag&&!this.s("to").hasParam("tag")&&(t+=";tag=".concat(this.to_tag)),h+="To: ".concat(t,"\r\n"),h+="From: ".concat(this.getHeader("From"),"\r\n"),h+="Call-ID: ".concat(this.call_id,"\r\n"),h+="CSeq: ".concat(this.cseq," ").concat(this.method,"\r\n"),this.ua.configuration.extra_headers)for(let u of this.ua.configuration.extra_headers)h+="".concat(u.trim(),"\r\n");h+="Content-Length: 0\r\n\r\n",this.transport.send(h)}},cr=class extends ps{constructor(){super(),this.headers={},this.status_code=null,this.reason_phrase=null}};hi.exports={OutgoingRequest:_s,InitialOutgoingInviteRequest:ar,IncomingRequest:fr,IncomingResponse:cr}});var _i=W((Ff,di)=>{var Bo=ae(),Ge=ce(),be=new Bo("DigestAuthentication");di.exports=class{constructor(l){this._credentials=l,this._cnonce=null,this._nc=0,this._ncHex="00000000",this._algorithm=null,this._realm=null,this._nonce=null,this._opaque=null,this._stale=null,this._qop=null,this._method=null,this._uri=null,this._ha1=null,this._response=null}get(l){switch(l){case"realm":return this._realm;case"ha1":return this._ha1;default:be.warn('get() | cannot get "%s" parameter',l);return}}authenticate({method:l,ruri:s,body:a},h,t=null){if(this._algorithm=h.algorithm,this._realm=h.realm,this._nonce=h.nonce,this._opaque=h.opaque,this._stale=h.stale,this._algorithm){if(this._algorithm!=="MD5")return be.warn('authenticate() | challenge with Digest algorithm different than "MD5", authentication aborted'),!1}else this._algorithm="MD5";if(!this._nonce)return be.warn("authenticate() | challenge without Digest nonce, authentication aborted"),!1;if(!this._realm)return be.warn("authenticate() | challenge without Digest realm, authentication aborted"),!1;if(!this._credentials.password){if(!this._credentials.ha1)return be.warn("authenticate() | no plain SIP password nor ha1 provided, authentication aborted"),!1;if(this._credentials.realm!==this._realm)return be.warn('authenticate() | no plain SIP password, and stored `realm` does not match the given `realm`, cannot authenticate [stored:"%s", given:"%s"]',this._credentials.realm,this._realm),!1}if(h.qop)if(h.qop.indexOf("auth-int")>-1)this._qop="auth-int";else if(h.qop.indexOf("auth")>-1)this._qop="auth";else return be.warn('authenticate() | challenge without Digest qop different than "auth" or "auth-int", authentication aborted'),!1;else this._qop=null;this._method=l,this._uri=s,this._cnonce=t||Ge.createRandomToken(12),this._nc+=1;let u=Number(this._nc).toString(16);this._ncHex="00000000".substr(0,8-u.length)+u,this._nc===4294967296&&(this._nc=1,this._ncHex="00000001"),this._credentials.password?this._ha1=Ge.calculateMD5("".concat(this._credentials.username,":").concat(this._realm,":").concat(this._credentials.password)):this._ha1=this._credentials.ha1;let p,g;return this._qop==="auth"?(p="".concat(this._method,":").concat(this._uri),g=Ge.calculateMD5(p),be.debug('authenticate() | using qop=auth [a2:"%s"]',p),this._response=Ge.calculateMD5("".concat(this._ha1,":").concat(this._nonce,":").concat(this._ncHex,":").concat(this._cnonce,":auth:").concat(g))):this._qop==="auth-int"?(p="".concat(this._method,":").concat(this._uri,":").concat(Ge.calculateMD5(a||"")),g=Ge.calculateMD5(p),be.debug('authenticate() | using qop=auth-int [a2:"%s"]',p),this._response=Ge.calculateMD5("".concat(this._ha1,":").concat(this._nonce,":").concat(this._ncHex,":").concat(this._cnonce,":auth-int:").concat(g))):this._qop===null&&(p="".concat(this._method,":").concat(this._uri),g=Ge.calculateMD5(p),be.debug('authenticate() | using qop=null [a2:"%s"]',p),this._response=Ge.calculateMD5("".concat(this._ha1,":").concat(this._nonce,":").concat(g))),be.debug("authenticate() | response generated"),!0}toString(){let l=[];if(!this._response)throw new Error("response field does not exist, cannot generate Authorization header");return l.push("algorithm=".concat(this._algorithm)),l.push('username="'.concat(this._credentials.username,'"')),l.push('realm="'.concat(this._realm,'"')),l.push('nonce="'.concat(this._nonce,'"')),l.push('uri="'.concat(this._uri,'"')),l.push('response="'.concat(this._response,'"')),this._opaque&&l.push('opaque="'.concat(this._opaque,'"')),this._qop&&(l.push("qop=".concat(this._qop)),l.push('cnonce="'.concat(this._cnonce,'"')),l.push("nc=".concat(this._ncHex))),"Digest ".concat(l.join(", "))}}});var hr=W((Hf,pi)=>{pi.exports={T1:500,T2:4e3,T4:5e3,TIMER_B:64*500,TIMER_D:0*500,TIMER_F:64*500,TIMER_H:64*500,TIMER_I:0*500,TIMER_J:0*500,TIMER_K:0*5e3,TIMER_L:64*500,TIMER_M:64*500,PROVISIONAL_RESPONSE_INTERVAL:6e4}});var _t=W((qf,Ci)=>{var Ut=$e().EventEmitter,Pt=ae(),Dt=le(),mi=xe(),De=hr(),gi=new Pt("NonInviteClientTransaction"),ms=new Pt("InviteClientTransaction"),Wo=new Pt("AckClientTransaction"),Ti=new Pt("NonInviteServerTransaction"),gs=new Pt("InviteServerTransaction"),U={STATUS_TRYING:1,STATUS_PROCEEDING:2,STATUS_CALLING:3,STATUS_ACCEPTED:4,STATUS_COMPLETED:5,STATUS_TERMINATED:6,STATUS_CONFIRMED:7,NON_INVITE_CLIENT:"nict",NON_INVITE_SERVER:"nist",INVITE_CLIENT:"ict",INVITE_SERVER:"ist"},dr=class extends Ut{constructor(l,s,a,h){super(),this.type=U.NON_INVITE_CLIENT,this.id="z9hG4bK".concat(Math.floor(Math.random()*1e7)),this.ua=l,this.transport=s,this.request=a,this.eventHandlers=h;let t="SIP/2.0/".concat(s.via_transport);t+=" ".concat(l.configuration.via_host,";branch=").concat(this.id),this.request.setHeader("via",t),this.ua.newTransaction(this)}get C(){return U}stateChanged(l){this.state=l,this.emit("stateChanged")}send(){this.stateChanged(U.STATUS_TRYING),this.F=setTimeout(()=>{this.timer_F()},De.TIMER_F),this.transport.send(this.request)||this.onTransportError()}onTransportError(){gi.debug("transport error occurred, deleting transaction ".concat(this.id)),clearTimeout(this.F),clearTimeout(this.K),this.stateChanged(U.STATUS_TERMINATED),this.ua.destroyTransaction(this),this.eventHandlers.onTransportError()}timer_F(){gi.debug("Timer F expired for transaction ".concat(this.id)),this.stateChanged(U.STATUS_TERMINATED),this.ua.destroyTransaction(this),this.eventHandlers.onRequestTimeout()}timer_K(){this.stateChanged(U.STATUS_TERMINATED),this.ua.destroyTransaction(this)}receiveResponse(l){let s=l.status_code;if(s<200)switch(this.state){case U.STATUS_TRYING:case U.STATUS_PROCEEDING:this.stateChanged(U.STATUS_PROCEEDING),this.eventHandlers.onReceiveResponse(l);break}else switch(this.state){case U.STATUS_TRYING:case U.STATUS_PROCEEDING:this.stateChanged(U.STATUS_COMPLETED),clearTimeout(this.F),s===408?this.eventHandlers.onRequestTimeout():this.eventHandlers.onReceiveResponse(l),this.K=setTimeout(()=>{this.timer_K()},De.TIMER_K);break;case U.STATUS_COMPLETED:break}}},_r=class extends Ut{constructor(l,s,a,h){super(),this.type=U.INVITE_CLIENT,this.id="z9hG4bK".concat(Math.floor(Math.random()*1e7)),this.ua=l,this.transport=s,this.request=a,this.eventHandlers=h,a.transaction=this;let t="SIP/2.0/".concat(s.via_transport);t+=" ".concat(l.configuration.via_host,";branch=").concat(this.id),this.request.setHeader("via",t),this.ua.newTransaction(this)}get C(){return U}stateChanged(l){this.state=l,this.emit("stateChanged")}send(){this.stateChanged(U.STATUS_CALLING),this.B=setTimeout(()=>{this.timer_B()},De.TIMER_B),this.transport.send(this.request)||this.onTransportError()}onTransportError(){clearTimeout(this.B),clearTimeout(this.D),clearTimeout(this.M),this.state!==U.STATUS_ACCEPTED&&(ms.debug("transport error occurred, deleting transaction ".concat(this.id)),this.eventHandlers.onTransportError()),this.stateChanged(U.STATUS_TERMINATED),this.ua.destroyTransaction(this)}timer_M(){ms.debug("Timer M expired for transaction ".concat(this.id)),this.state===U.STATUS_ACCEPTED&&(clearTimeout(this.B),this.stateChanged(U.STATUS_TERMINATED),this.ua.destroyTransaction(this))}timer_B(){ms.debug("Timer B expired for transaction ".concat(this.id)),this.state===U.STATUS_CALLING&&(this.stateChanged(U.STATUS_TERMINATED),this.ua.destroyTransaction(this),this.eventHandlers.onRequestTimeout())}timer_D(){ms.debug("Timer D expired for transaction ".concat(this.id)),clearTimeout(this.B),this.stateChanged(U.STATUS_TERMINATED),this.ua.destroyTransaction(this)}sendACK(l){let s=new mi.OutgoingRequest(Dt.ACK,this.request.ruri,this.ua,{route_set:this.request.getHeaders("route"),call_id:this.request.getHeader("call-id"),cseq:this.request.cseq});s.setHeader("from",this.request.getHeader("from")),s.setHeader("via",this.request.getHeader("via")),s.setHeader("to",l.getHeader("to")),this.D=setTimeout(()=>{this.timer_D()},De.TIMER_D),this.transport.send(s)}cancel(l){if(this.state!==U.STATUS_PROCEEDING)return;let s=new mi.OutgoingRequest(Dt.CANCEL,this.request.ruri,this.ua,{route_set:this.request.getHeaders("route"),call_id:this.request.getHeader("call-id"),cseq:this.request.cseq});s.setHeader("from",this.request.getHeader("from")),s.setHeader("via",this.request.getHeader("via")),s.setHeader("to",this.request.getHeader("to")),l&&s.setHeader("reason",l),this.transport.send(s)}receiveResponse(l){let s=l.status_code;if(s>=100&&s<=199)switch(this.state){case U.STATUS_CALLING:this.stateChanged(U.STATUS_PROCEEDING),this.eventHandlers.onReceiveResponse(l);break;case U.STATUS_PROCEEDING:this.eventHandlers.onReceiveResponse(l);break}else if(s>=200&&s<=299)switch(this.state){case U.STATUS_CALLING:case U.STATUS_PROCEEDING:this.stateChanged(U.STATUS_ACCEPTED),this.M=setTimeout(()=>{this.timer_M()},De.TIMER_M),this.eventHandlers.onReceiveResponse(l);break;case U.STATUS_ACCEPTED:this.eventHandlers.onReceiveResponse(l);break}else if(s>=300&&s<=699)switch(this.state){case U.STATUS_CALLING:case U.STATUS_PROCEEDING:this.stateChanged(U.STATUS_COMPLETED),this.sendACK(l),this.eventHandlers.onReceiveResponse(l);break;case U.STATUS_COMPLETED:this.sendACK(l);break}}},pr=class extends Ut{constructor(l,s,a,h){super(),this.id="z9hG4bK".concat(Math.floor(Math.random()*1e7)),this.transport=s,this.request=a,this.eventHandlers=h;let t="SIP/2.0/".concat(s.via_transport);t+=" ".concat(l.configuration.via_host,";branch=").concat(this.id),this.request.setHeader("via",t)}get C(){return U}send(){this.transport.send(this.request)||this.onTransportError()}onTransportError(){Wo.debug("transport error occurred for transaction ".concat(this.id)),this.eventHandlers.onTransportError()}},mr=class extends Ut{constructor(l,s,a){super(),this.type=U.NON_INVITE_SERVER,this.id=a.via_branch,this.ua=l,this.transport=s,this.request=a,this.last_response="",a.server_transaction=this,this.state=U.STATUS_TRYING,l.newTransaction(this)}get C(){return U}stateChanged(l){this.state=l,this.emit("stateChanged")}timer_J(){Ti.debug("Timer J expired for transaction ".concat(this.id)),this.stateChanged(U.STATUS_TERMINATED),this.ua.destroyTransaction(this)}onTransportError(){this.transportError||(this.transportError=!0,Ti.debug("transport error occurred, deleting transaction ".concat(this.id)),clearTimeout(this.J),this.stateChanged(U.STATUS_TERMINATED),this.ua.destroyTransaction(this))}receiveResponse(l,s,a,h){if(l===100)switch(this.state){case U.STATUS_TRYING:this.stateChanged(U.STATUS_PROCEEDING),this.transport.send(s)||this.onTransportError();break;case U.STATUS_PROCEEDING:this.last_response=s,this.transport.send(s)?a&&a():(this.onTransportError(),h&&h());break}else if(l>=200&&l<=699)switch(this.state){case U.STATUS_TRYING:case U.STATUS_PROCEEDING:this.stateChanged(U.STATUS_COMPLETED),this.last_response=s,this.J=setTimeout(()=>{this.timer_J()},De.TIMER_J),this.transport.send(s)?a&&a():(this.onTransportError(),h&&h());break;case U.STATUS_COMPLETED:break}}},gr=class extends Ut{constructor(l,s,a){super(),this.type=U.INVITE_SERVER,this.id=a.via_branch,this.ua=l,this.transport=s,this.request=a,this.last_response="",a.server_transaction=this,this.state=U.STATUS_PROCEEDING,l.newTransaction(this),this.resendProvisionalTimer=null,a.reply(100)}get C(){return U}stateChanged(l){this.state=l,this.emit("stateChanged")}timer_H(){gs.debug("Timer H expired for transaction ".concat(this.id)),this.state===U.STATUS_COMPLETED&&gs.debug("ACK not received, dialog will be terminated"),this.stateChanged(U.STATUS_TERMINATED),this.ua.destroyTransaction(this)}timer_I(){this.stateChanged(U.STATUS_TERMINATED),this.ua.destroyTransaction(this)}timer_L(){gs.debug("Timer L expired for transaction ".concat(this.id)),this.state===U.STATUS_ACCEPTED&&(this.stateChanged(U.STATUS_TERMINATED),this.ua.destroyTransaction(this))}onTransportError(){this.transportError||(this.transportError=!0,gs.debug("transport error occurred, deleting transaction ".concat(this.id)),this.resendProvisionalTimer!==null&&(clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null),clearTimeout(this.L),clearTimeout(this.H),clearTimeout(this.I),this.stateChanged(U.STATUS_TERMINATED),this.ua.destroyTransaction(this))}resend_provisional(){this.transport.send(this.last_response)||this.onTransportError()}receiveResponse(l,s,a,h){if(l>=100&&l<=199&&this.state===U.STATUS_PROCEEDING&&(this.transport.send(s)||this.onTransportError(),this.last_response=s),l>100&&l<=199&&this.state===U.STATUS_PROCEEDING)this.resendProvisionalTimer===null&&(this.resendProvisionalTimer=setInterval(()=>{this.resend_provisional()},De.PROVISIONAL_RESPONSE_INTERVAL));else if(l>=200&&l<=299)switch(this.state){case U.STATUS_PROCEEDING:this.stateChanged(U.STATUS_ACCEPTED),this.last_response=s,this.L=setTimeout(()=>{this.timer_L()},De.TIMER_L),this.resendProvisionalTimer!==null&&(clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null);case U.STATUS_ACCEPTED:this.transport.send(s)?a&&a():(this.onTransportError(),h&&h());break}else l>=300&&l<=699&&this.state===U.STATUS_PROCEEDING&&(this.resendProvisionalTimer!==null&&(clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null),this.transport.send(s)?(this.stateChanged(U.STATUS_COMPLETED),this.H=setTimeout(()=>{this.timer_H()},De.TIMER_H),a&&a()):(this.onTransportError(),h&&h()))}};function Vo({_transactions:f},l){let s;switch(l.method){case Dt.INVITE:if(s=f.ist[l.via_branch],s){switch(s.state){case U.STATUS_PROCEEDING:s.transport.send(s.last_response);break;case U.STATUS_ACCEPTED:break}return!0}break;case Dt.ACK:if(s=f.ist[l.via_branch],s){if(s.state===U.STATUS_ACCEPTED)return!1;if(s.state===U.STATUS_COMPLETED)return s.state=U.STATUS_CONFIRMED,s.I=setTimeout(()=>{s.timer_I()},De.TIMER_I),!0}else return!1;break;case Dt.CANCEL:return s=f.ist[l.via_branch],s?(l.reply_sl(200),s.state!==U.STATUS_PROCEEDING):(l.reply_sl(481),!0);default:if(s=f.nist[l.via_branch],s){switch(s.state){case U.STATUS_TRYING:break;case U.STATUS_PROCEEDING:case U.STATUS_COMPLETED:s.transport.send(s.last_response);break}return!0}break}}Ci.exports={C:U,NonInviteClientTransaction:dr,InviteClientTransaction:_r,AckClientTransaction:pr,NonInviteServerTransaction:mr,InviteServerTransaction:gr,checkTransaction:Vo}});var pt=W((kf,Ai)=>{var jo=ae(),Ei=le(),Ko=_i(),Tr=_t(),Yo=new jo("RequestSender"),Cr={onRequestTimeout:()=>{},onTransportError:()=>{},onReceiveResponse:()=>{},onAuthenticated:()=>{}};Ai.exports=class{constructor(l,s,a){this._ua=l,this._eventHandlers=a,this._method=s.method,this._request=s,this._auth=null,this._challenged=!1,this._staled=!1;for(let h in Cr)Object.prototype.hasOwnProperty.call(Cr,h)&&(this._eventHandlers[h]||(this._eventHandlers[h]=Cr[h]));l.status===l.C.STATUS_USER_CLOSED&&(this._method!==Ei.BYE||this._method!==Ei.ACK)&&this._eventHandlers.onTransportError()}send(){let l={onRequestTimeout:()=>{this._eventHandlers.onRequestTimeout()},onTransportError:()=>{this._eventHandlers.onTransportError()},onReceiveResponse:s=>{this._receiveResponse(s)}};switch(this._method){case"INVITE":this.clientTransaction=new Tr.InviteClientTransaction(this._ua,this._ua.transport,this._request,l);break;case"ACK":this.clientTransaction=new Tr.AckClientTransaction(this._ua,this._ua.transport,this._request,l);break;default:this.clientTransaction=new Tr.NonInviteClientTransaction(this._ua,this._ua.transport,this._request,l)}this._ua._configuration.authorization_jwt&&this._request.setHeader("Authorization",this._ua._configuration.authorization_jwt),this.clientTransaction.send()}_receiveResponse(l){let s,a,h=l.status_code;if((h===401||h===407)&&(this._ua.configuration.password!==null||this._ua.configuration.ha1!==null)){if(l.status_code===401?(s=l.parseHeader("www-authenticate"),a="authorization"):(s=l.parseHeader("proxy-authenticate"),a="proxy-authorization"),!s){Yo.debug("".concat(l.status_code," with wrong or missing challenge, cannot authenticate")),this._eventHandlers.onReceiveResponse(l);return}if(!this._challenged||!this._staled&&s.stale===!0){if(this._auth||(this._auth=new Ko({username:this._ua.configuration.authorization_user,password:this._ua.configuration.password,realm:this._ua.configuration.realm,ha1:this._ua.configuration.ha1})),!this._auth.authenticate(this._request,s)){this._eventHandlers.onReceiveResponse(l);return}this._challenged=!0,this._ua.set("realm",this._auth.get("realm")),this._ua.set("ha1",this._auth.get("ha1")),s.stale&&(this._staled=!0),this._request=this._request.clone(),this._request.cseq+=1,this._request.setHeader("cseq","".concat(this._request.cseq," ").concat(this._method)),this._request.setHeader(a,this._auth.toString()),this._eventHandlers.onAuthenticated(this._request),this.send()}else this._eventHandlers.onReceiveResponse(l)}else this._eventHandlers.onReceiveResponse(l)}}});var bi=W((Bf,Ri)=>{var zo=ae(),mt=ce(),Ze=le(),Si=xe(),vi=pt(),Lt=new zo("Registrator"),Ts=10;Ri.exports=class{constructor(l,s){this._reg_id=1,this._ua=l,this._transport=s,this._registrar=l.configuration.registrar_server,this._expires=l.configuration.register_expires,this._call_id=mt.createRandomToken(22),this._cseq=0,this._to_uri=l.configuration.uri,this._registrationTimer=null,this._registering=!1,this._registered=!1,this._contact=this._ua.contact.toString(),this._contact+=";+sip.ice",this._extraHeaders=[],this._extraContactParams="",this._sipInstance='"<urn:uuid:'.concat(this._ua.configuration.instance_id,'>"'),this._contact+=";reg-id=".concat(this._reg_id),this._contact+=";+sip.instance=".concat(this._sipInstance)}get registered(){return this._registered}setExtraHeaders(l){Array.isArray(l)||(l=[]),this._extraHeaders=l.slice()}setExtraContactParams(l){l instanceof Object||(l={}),this._extraContactParams="";for(let s in l)if(Object.prototype.hasOwnProperty.call(l,s)){let a=l[s];this._extraContactParams+=";".concat(s),a&&(this._extraContactParams+="=".concat(a))}}register(){if(this._registering){Lt.debug("Register request in progress...");return}let l=mt.cloneArray(this._extraHeaders),s;this._expires?(s="".concat(this._contact,";expires=").concat(this._expires).concat(this._extraContactParams),l.push("Expires: ".concat(this._expires))):s="".concat(this._contact).concat(this._extraContactParams),l.push("Contact: ".concat(s));let a=mt.newTag();this._ua.configuration.register_from_tag_trail&&(typeof this._ua.configuration.register_from_tag_trail=="function"?a+=this._ua.configuration.register_from_tag_trail():a+=this._ua.configuration.register_from_tag_trail);let h=new Si.OutgoingRequest(Ze.REGISTER,this._registrar,this._ua,{to_uri:this._to_uri,call_id:this._call_id,cseq:this._cseq+=1,from_tag:a},l),t=new vi(this._ua,h,{onRequestTimeout:()=>{this._registrationFailure(null,Ze.causes.REQUEST_TIMEOUT)},onTransportError:()=>{this._registrationFailure(null,Ze.causes.CONNECTION_ERROR)},onAuthenticated:()=>{this._cseq+=1},onReceiveResponse:u=>{if(u.cseq===this._cseq)switch(this._registrationTimer!==null&&(clearTimeout(this._registrationTimer),this._registrationTimer=null),!0){case/^1[0-9]{2}$/.test(u.status_code):break;case/^2[0-9]{2}$/.test(u.status_code):{if(this._registering=!1,!u.hasHeader("Contact")){Lt.debug("no Contact header in response to REGISTER, response ignored");break}let p=u.headers.Contact.reduce((c,$)=>c.concat($.parsed),[]),g=p.find(c=>this._sipInstance===c.getParam("+sip.instance")&&this._reg_id===parseInt(c.getParam("reg-id")));if(g||(g=p.find(c=>c.uri.user===this._ua.contact.uri.user)),!g){Lt.debug("no Contact header pointing to us, response ignored");break}let S=g.getParam("expires");!S&&u.hasHeader("expires")&&(S=u.getHeader("expires")),S||(S=this._expires),S=Number(S),S<Ts&&(S=Ts);let N=S>64?S*1e3/2+Math.floor((S/2-32)*1e3*Math.random()):S*1e3-5e3;this._registrationTimer=setTimeout(()=>{this._registrationTimer=null,this._ua.listeners("registrationExpiring").length===0?this.register():this._ua.emit("registrationExpiring")},N),g.hasParam("temp-gruu")&&(this._ua.contact.temp_gruu=g.getParam("temp-gruu").replace(/"/g,"")),g.hasParam("pub-gruu")&&(this._ua.contact.pub_gruu=g.getParam("pub-gruu").replace(/"/g,"")),this._registered||(this._registered=!0,this._ua.registered({response:u}));break}case/^423$/.test(u.status_code):{u.hasHeader("min-expires")?(this._expires=Number(u.getHeader("min-expires")),this._expires<Ts&&(this._expires=Ts),this._registering=!1,this.register()):(Lt.debug("423 response received for REGISTER without Min-Expires"),this._registrationFailure(u,Ze.causes.SIP_FAILURE_CODE));break}default:{let p=mt.sipErrorCause(u.status_code);this._registrationFailure(u,p)}}}});this._registering=!0,t.send()}unregister(l={}){if(!this._registered){Lt.debug("already unregistered");return}this._registered=!1,this._registrationTimer!==null&&(clearTimeout(this._registrationTimer),this._registrationTimer=null);let s=mt.cloneArray(this._extraHeaders);l.all?s.push("Contact: *".concat(this._extraContactParams)):s.push("Contact: ".concat(this._contact,";expires=0").concat(this._extraContactParams)),s.push("Expires: 0");let a=new Si.OutgoingRequest(Ze.REGISTER,this._registrar,this._ua,{to_uri:this._to_uri,call_id:this._call_id,cseq:this._cseq+=1},s);new vi(this._ua,a,{onRequestTimeout:()=>{this._unregistered(null,Ze.causes.REQUEST_TIMEOUT)},onTransportError:()=>{this._unregistered(null,Ze.causes.CONNECTION_ERROR)},onAuthenticated:()=>{this._cseq+=1},onReceiveResponse:t=>{switch(!0){case/^1[0-9]{2}$/.test(t.status_code):break;case/^2[0-9]{2}$/.test(t.status_code):this._unregistered(t);break;default:{let u=mt.sipErrorCause(t.status_code);this._unregistered(t,u)}}}}).send()}close(){this._registered&&this.unregister()}onTransportClosed(){this._registering=!1,this._registrationTimer!==null&&(clearTimeout(this._registrationTimer),this._registrationTimer=null),this._registered&&(this._registered=!1,this._ua.unregistered({}))}_registrationFailure(l,s){this._registering=!1,this._ua.registrationFailed({response:l||null,cause:s}),this._registered&&(this._registered=!1,this._ua.unregistered({response:l||null,cause:s}))}_unregistered(l,s){this._registering=!1,this._registered=!1,this._ua.unregistered({response:l||null,cause:s||null})}}});var yi=W((Vf,wi)=>{var Er=le(),Cs=_t(),Jo=pt(),Ar={onRequestTimeout:()=>{},onTransportError:()=>{},onSuccessResponse:()=>{},onErrorResponse:()=>{},onAuthenticated:()=>{},onDialogError:()=>{}};wi.exports=class{constructor(l,s,a){this._dialog=l,this._ua=l._ua,this._request=s,this._eventHandlers=a,this._reattempt=!1,this._reattemptTimer=null;for(let h in Ar)Object.prototype.hasOwnProperty.call(Ar,h)&&(this._eventHandlers[h]||(this._eventHandlers[h]=Ar[h]))}get request(){return this._request}send(){let l=new Jo(this._ua,this._request,{onRequestTimeout:()=>{this._eventHandlers.onRequestTimeout()},onTransportError:()=>{this._eventHandlers.onTransportError()},onAuthenticated:s=>{this._eventHandlers.onAuthenticated(s)},onReceiveResponse:s=>{this._receiveResponse(s)}});if(l.send(),(this._request.method===Er.INVITE||this._request.method===Er.UPDATE&&this._request.body)&&l.clientTransaction.state!==Cs.C.STATUS_TERMINATED){this._dialog.uac_pending_reply=!0;let s=()=>{(l.clientTransaction.state===Cs.C.STATUS_ACCEPTED||l.clientTransaction.state===Cs.C.STATUS_COMPLETED||l.clientTransaction.state===Cs.C.STATUS_TERMINATED)&&(l.clientTransaction.removeListener("stateChanged",s),this._dialog.uac_pending_reply=!1)};l.clientTransaction.on("stateChanged",s)}}_receiveResponse(l){l.status_code===408||l.status_code===481?this._eventHandlers.onDialogError(l):l.method===Er.INVITE&&l.status_code===491?this._reattempt?this._eventHandlers.onErrorResponse(l):(this._request.cseq=this._dialog.local_seqnum+=1,this._reattemptTimer=setTimeout(()=>{this._dialog.isTerminated()||(this._reattempt=!0,this.send())},1e3)):l.status_code>=200&&l.status_code<300?this._eventHandlers.onSuccessResponse(l):l.status_code>=300&&this._eventHandlers.onErrorResponse(l)}}});var Oi=W((Kf,Ni)=>{var Xo=ae(),Ii=xe(),Ue=le(),Mt=_t(),Qo=yi(),Sr=ce(),vr=new Xo("Dialog"),We={STATUS_EARLY:1,STATUS_CONFIRMED:2,STATUS_TERMINATED:3};Ni.exports=class{static get C(){return We}constructor(l,s,a,h=We.STATUS_CONFIRMED){if(this._owner=l,this._ua=l._ua,this._uac_pending_reply=!1,this._uas_pending_reply=!1,!s.hasHeader("contact"))return{error:"unable to create a Dialog without Contact header field"};s instanceof Ii.IncomingResponse&&(h=s.status_code<200?We.STATUS_EARLY:We.STATUS_CONFIRMED);let t=s.parseHeader("contact");a==="UAS"?(this._id={call_id:s.call_id,local_tag:s.to_tag,remote_tag:s.from_tag,toString(){return this.call_id+this.local_tag+this.remote_tag}},this._state=h,this._remote_seqnum=s.cseq,this._local_uri=s.parseHeader("to").uri,this._remote_uri=s.parseHeader("from").uri,this._remote_target=t.uri,this._route_set=s.getHeaders("record-route"),this.incoming_ack_seqnum=s.cseq,this.outgoing_ack_seqnum=null):a==="UAC"&&(this._id={call_id:s.call_id,local_tag:s.from_tag,remote_tag:s.to_tag,toString(){return this.call_id+this.local_tag+this.remote_tag}},this._state=h,this._local_seqnum=s.cseq,this._local_uri=s.parseHeader("from").uri,this._remote_uri=s.parseHeader("to").uri,this._remote_target=t.uri,this._route_set=s.getHeaders("record-route").reverse(),this.incoming_ack_seqnum=null,this.outgoing_ack_seqnum=this._local_seqnum),this._ua.newDialog(this),vr.debug("new ".concat(a," dialog created with status ").concat(this._state===We.STATUS_EARLY?"EARLY":"CONFIRMED"))}get id(){return this._id}get local_seqnum(){return this._local_seqnum}set local_seqnum(l){this._local_seqnum=l}get owner(){return this._owner}get uac_pending_reply(){return this._uac_pending_reply}set uac_pending_reply(l){this._uac_pending_reply=l}get uas_pending_reply(){return this._uas_pending_reply}isTerminated(){return this._status===We.STATUS_TERMINATED}update(l,s){this._state=We.STATUS_CONFIRMED,vr.debug("dialog ".concat(this._id.toString(),"  changed to CONFIRMED state")),s==="UAC"&&(this._route_set=l.getHeaders("record-route").reverse())}terminate(){vr.debug("dialog ".concat(this._id.toString()," deleted")),this._ua.destroyDialog(this),this._state=We.STATUS_TERMINATED}sendRequest(l,s={}){let a=Sr.cloneArray(s.extraHeaders),h=Sr.cloneObject(s.eventHandlers),t=s.body||null,u=this._createRequest(l,a,t);return h.onAuthenticated=()=>{this._local_seqnum+=1,u.method===Ue.INVITE&&(this._outgoing_ack_seqnum=this._local_seqnum)},new Qo(this,u,h).send(),u}receiveRequest(l){this._checkInDialogRequest(l)&&(l.method===Ue.ACK&&this.incoming_ack_seqnum!==null?this.incoming_ack_seqnum=null:l.method===Ue.INVITE&&(this.incoming_ack_seqnum=l.cseq),this._owner.receiveRequest(l))}_createRequest(l,s,a){s=Sr.cloneArray(s),this._local_seqnum||(this._local_seqnum=Math.floor(Math.random()*1e4));let h=l===Ue.CANCEL||l===Ue.ACK?this.outgoing_ack_seqnum:this._local_seqnum+=1;return l===Ue.INVITE&&(this.outgoing_ack_seqnum=h),new Ii.OutgoingRequest(l,this._remote_target,this._ua,{cseq:h,call_id:this._id.call_id,from_uri:this._local_uri,from_tag:this._id.local_tag,to_uri:this._remote_uri,to_tag:this._id.remote_tag,route_set:this._route_set},s,a)}_checkInDialogRequest(l){if(!this._remote_seqnum)this._remote_seqnum=l.cseq;else if(l.cseq<this._remote_seqnum)if(l.method===Ue.ACK){if(this.incoming_ack_seqnum===null||l.cseq!==this.incoming_ack_seqnum)return!1}else return l.reply(500),!1;else l.cseq>this._remote_seqnum&&(this._remote_seqnum=l.cseq);if(l.method===Ue.INVITE||l.method===Ue.UPDATE&&l.body){if(this._uac_pending_reply===!0)l.reply(491);else if(this._uas_pending_reply===!0){let s=(Math.random()*10|0)+1;return l.reply(500,null,["Retry-After:".concat(s)]),!1}else{this._uas_pending_reply=!0;let s=()=>{(l.server_transaction.state===Mt.C.STATUS_ACCEPTED||l.server_transaction.state===Mt.C.STATUS_COMPLETED||l.server_transaction.state===Mt.C.STATUS_TERMINATED)&&(l.server_transaction.removeListener("stateChanged",s),this._uas_pending_reply=!1)};l.server_transaction.on("stateChanged",s)}l.hasHeader("contact")&&l.server_transaction.on("stateChanged",()=>{l.server_transaction.state===Mt.C.STATUS_ACCEPTED&&(this._remote_target=l.parseHeader("contact").uri)})}else l.method===Ue.NOTIFY&&l.hasHeader("contact")&&l.server_transaction.on("stateChanged",()=>{l.server_transaction.state===Mt.C.STATUS_COMPLETED&&(this._remote_target=l.parseHeader("contact").uri)});return!0}}});var Ui=W((zf,Rr)=>{var Zo=$e().EventEmitter,ea=ae(),ta=le(),sa=He(),xi=ce(),ra=new ea("RTCSession:DTMF"),Di={MIN_DURATION:70,MAX_DURATION:6e3,DEFAULT_DURATION:100,MIN_INTER_TONE_GAP:50,DEFAULT_INTER_TONE_GAP:500};Rr.exports=class extends Zo{constructor(l){super(),this._session=l,this._direction=null,this._tone=null,this._duration=null,this._request=null}get tone(){return this._tone}get duration(){return this._duration}send(l,s={}){if(l===void 0)throw new TypeError("Not enough arguments");if(this._direction="outgoing",this._session.status!==this._session.C.STATUS_CONFIRMED&&this._session.status!==this._session.C.STATUS_WAITING_FOR_ACK&&this._session.status!==this._session.C.STATUS_1XX_RECEIVED)throw new sa.InvalidStateError(this._session.status);let a=xi.cloneArray(s.extraHeaders);if(this.eventHandlers=xi.cloneObject(s.eventHandlers),typeof l=="string")l=l.toUpperCase();else if(typeof l=="number")l=l.toString();else throw new TypeError("Invalid tone: ".concat(l));if(l.match(/^[0-9A-DR#*]$/))this._tone=l;else throw new TypeError("Invalid tone: ".concat(l));this._duration=s.duration,a.push("Content-Type: application/dtmf-relay");let h="Signal=".concat(this._tone,"\r\n");h+="Duration=".concat(this._duration),this._session.newDTMF({originator:"local",dtmf:this,request:this._request}),this._session.sendRequest(ta.INFO,{extraHeaders:a,eventHandlers:{onSuccessResponse:t=>{this.emit("succeeded",{originator:"remote",response:t})},onErrorResponse:t=>{this.eventHandlers.onFailed&&this.eventHandlers.onFailed(),this.emit("failed",{originator:"remote",response:t})},onRequestTimeout:()=>{this._session.onRequestTimeout()},onTransportError:()=>{this._session.onTransportError()},onDialogError:()=>{this._session.onDialogError()}},body:h})}init_incoming(l){let s=/^(Signal\s*?=\s*?)([0-9A-D#*]{1})(\s)?.*/,a=/^(Duration\s?=\s?)([0-9]{1,4})(\s)?.*/;if(this._direction="incoming",this._request=l,l.reply(200),l.body){let h=l.body.split("\n");h.length>=1&&s.test(h[0])&&(this._tone=h[0].replace(s,"$2")),h.length>=2&&a.test(h[1])&&(this._duration=parseInt(h[1].replace(a,"$2"),10))}this._duration||(this._duration=Di.DEFAULT_DURATION),this._tone?this._session.newDTMF({originator:"remote",dtmf:this,request:l}):ra.debug("invalid INFO DTMF received, discarded")}};Rr.exports.C=Di});var Li=W((Xf,Pi)=>{var la=$e().EventEmitter,na=le(),ia=He(),ua=ce();Pi.exports=class extends la{constructor(l){super(),this._session=l,this._direction=null,this._contentType=null,this._body=null}get contentType(){return this._contentType}get body(){return this._body}send(l,s,a={}){if(this._direction="outgoing",l===void 0)throw new TypeError("Not enough arguments");if(this._session.status!==this._session.C.STATUS_CONFIRMED&&this._session.status!==this._session.C.STATUS_WAITING_FOR_ACK)throw new ia.InvalidStateError(this._session.status);this._contentType=l,this._body=s;let h=ua.cloneArray(a.extraHeaders);h.push("Content-Type: ".concat(l)),this._session.newInfo({originator:"local",info:this,request:this.request}),this._session.sendRequest(na.INFO,{extraHeaders:h,eventHandlers:{onSuccessResponse:t=>{this.emit("succeeded",{originator:"remote",response:t})},onErrorResponse:t=>{this.emit("failed",{originator:"remote",response:t})},onTransportError:()=>{this._session.onTransportError()},onRequestTimeout:()=>{this._session.onRequestTimeout()},onDialogError:()=>{this._session.onDialogError()}},body:s})}init_incoming(l){this._direction="incoming",this.request=l,l.reply(200),this._contentType=l.hasHeader("Content-Type")?l.getHeader("Content-Type").toLowerCase():void 0,this._body=l.body,this._session.newInfo({originator:"remote",info:this,request:l})}}});var Hi=W((Zf,Fi)=>{var oa=ae(),Mi=le(),aa=new oa("RTCSession:ReferNotifier"),br={event_type:"refer",body_type:"message/sipfrag;version=2.0",expires:300};Fi.exports=class{constructor(l,s,a){this._session=l,this._id=s,this._expires=a||br.expires,this._active=!0,this.notify(100)}notify(l,s){if(aa.debug("notify()"),this._active===!1)return;s=s||Mi.REASON_PHRASE[l]||"";let a;l>=200?a="terminated;reason=noresource":a="active;expires=".concat(this._expires),this._session.sendRequest(Mi.NOTIFY,{extraHeaders:["Event: ".concat(br.event_type,";id=").concat(this._id),"Subscription-State: ".concat(a),"Content-Type: ".concat(br.body_type)],body:"SIP/2.0 ".concat(l," ").concat(s),eventHandlers:{onErrorResponse(){this._active=!1}}})}}});var ki=W((tc,$i)=>{var fa=$e().EventEmitter,ca=ae(),Ft=le(),ha=Re(),qi=ce(),et=new ca("RTCSession:ReferSubscriber");$i.exports=class extends fa{constructor(l){super(),this._id=null,this._session=l}get id(){return this._id}sendRefer(l,s={}){et.debug("sendRefer()");let a=qi.cloneArray(s.extraHeaders),h=qi.cloneObject(s.eventHandlers);for(let g in h)Object.prototype.hasOwnProperty.call(h,g)&&this.on(g,h[g]);let t=null;s.replaces&&(t=s.replaces._request.call_id,t+=";to-tag=".concat(s.replaces._to_tag),t+=";from-tag=".concat(s.replaces._from_tag),t=encodeURIComponent(t));let u="Refer-To: <".concat(l).concat(t?"?Replaces=".concat(t):"",">");if(a.push(u),!a.some(g=>g.toLowerCase().startsWith("referred-by:"))){let g="Referred-By: <".concat(this._session._ua._configuration.uri._scheme,":").concat(this._session._ua._configuration.uri._user,"@").concat(this._session._ua._configuration.uri._host,">");a.push(g)}a.push("Contact: ".concat(this._session.contact));let p=this._session.sendRequest(Ft.REFER,{extraHeaders:a,eventHandlers:{onSuccessResponse:g=>{this._requestSucceeded(g)},onErrorResponse:g=>{this._requestFailed(g,Ft.causes.REJECTED)},onTransportError:()=>{this._requestFailed(null,Ft.causes.CONNECTION_ERROR)},onRequestTimeout:()=>{this._requestFailed(null,Ft.causes.REQUEST_TIMEOUT)},onDialogError:()=>{this._requestFailed(null,Ft.causes.DIALOG_ERROR)}}});this._id=p.cseq}receiveNotify(l){if(et.debug("receiveNotify()"),!l.body)return;let s=ha.parse(l.body.trim().split("\r\n",1)[0],"Status_Line");if(s===-1){et.debug('receiveNotify() | error parsing NOTIFY body: "'.concat(l.body,'"'));return}switch(!0){case/^100$/.test(s.status_code):this.emit("trying",{request:l,status_line:s});break;case/^1[0-9]{2}$/.test(s.status_code):this.emit("progress",{request:l,status_line:s});break;case/^2[0-9]{2}$/.test(s.status_code):this.emit("accepted",{request:l,status_line:s});break;default:this.emit("failed",{request:l,status_line:s});break}}_requestSucceeded(l){et.debug("REFER succeeded"),et.debug('emit "requestSucceeded"'),this.emit("requestSucceeded",{response:l})}_requestFailed(l,s){et.debug("REFER failed"),et.debug('emit "requestFailed"'),this.emit("requestFailed",{response:l||null,cause:s})}}});var yr=W((sc,ji)=>{var da=$e().EventEmitter,Gi=ur(),_a=ae(),D=le(),tt=He(),Bi=_t(),te=ce(),Ht=hr(),pa=xe(),Es=Oi(),ma=pt(),Ee=Ui(),Wi=Li(),ga=Hi(),Ta=ki(),Vi=qe(),E=new _a("RTCSession"),v={STATUS_NULL:0,STATUS_INVITE_SENT:1,STATUS_1XX_RECEIVED:2,STATUS_INVITE_RECEIVED:3,STATUS_WAITING_FOR_ANSWER:4,STATUS_ANSWERED:5,STATUS_WAITING_FOR_ACK:6,STATUS_CANCELED:7,STATUS_TERMINATED:8,STATUS_CONFIRMED:9},As=["audio","video"];ji.exports=class wr extends da{static get C(){return v}constructor(l){E.debug("new"),super(),this._id=null,this._ua=l,this._status=v.STATUS_NULL,this._dialog=null,this._earlyDialogs={},this._contact=null,this._from_tag=null,this._to_tag=null,this._connection=null,this._connectionPromiseQueue=Promise.resolve(),this._request=null,this._is_canceled=!1,this._cancel_reason="",this._is_confirmed=!1,this._late_sdp=!1,this._rtcOfferConstraints=null,this._rtcAnswerConstraints=null,this._localMediaStream=null,this._localMediaStreamLocallyGenerated=!1,this._rtcReady=!0,this._iceReady=!1,this._timers={ackTimer:null,expiresTimer:null,invite2xxTimer:null,userNoAnswerTimer:null},this._direction=null,this._local_identity=null,this._remote_identity=null,this._start_time=null,this._end_time=null,this._tones=null,this._audioMuted=!1,this._videoMuted=!1,this._localHold=!1,this._remoteHold=!1,this._sessionTimers={enabled:this._ua.configuration.session_timers,refreshMethod:this._ua.configuration.session_timers_refresh_method,defaultExpires:D.SESSION_EXPIRES,currentExpires:null,running:!1,refresher:!1,timer:null},this._referSubscribers={},this._data={}}get C(){return v}get causes(){return D.causes}get id(){return this._id}get connection(){return this._connection}get contact(){return this._contact}get direction(){return this._direction}get local_identity(){return this._local_identity}get remote_identity(){return this._remote_identity}get start_time(){return this._start_time}get end_time(){return this._end_time}get data(){return this._data}set data(l){this._data=l}get status(){return this._status}isInProgress(){switch(this._status){case v.STATUS_NULL:case v.STATUS_INVITE_SENT:case v.STATUS_1XX_RECEIVED:case v.STATUS_INVITE_RECEIVED:case v.STATUS_WAITING_FOR_ANSWER:return!0;default:return!1}}isEstablished(){switch(this._status){case v.STATUS_ANSWERED:case v.STATUS_WAITING_FOR_ACK:case v.STATUS_CONFIRMED:return!0;default:return!1}}isEnded(){switch(this._status){case v.STATUS_CANCELED:case v.STATUS_TERMINATED:return!0;default:return!1}}isMuted(){return{audio:this._audioMuted,video:this._videoMuted}}isOnHold(){return{local:this._localHold,remote:this._remoteHold}}connect(l,s={},a){E.debug("connect()");let h=l,t=te.cloneObject(s.eventHandlers),u=te.cloneArray(s.extraHeaders),p=te.cloneObject(s.mediaConstraints,{audio:!0,video:!0}),g=s.mediaStream||null,S=te.cloneObject(s.pcConfig,{iceServers:[]}),N=s.rtcConstraints||null,c=s.rtcOfferConstraints||null;if(this._rtcOfferConstraints=c,this._rtcAnswerConstraints=s.rtcAnswerConstraints||null,this._data=s.data||this._data,l===void 0)throw new TypeError("Not enough arguments");if(this._status!==v.STATUS_NULL)throw new tt.InvalidStateError(this._status);if(!window.RTCPeerConnection)throw new tt.NotSupportedError("WebRTC not supported");if(l=this._ua.normalizeTarget(l),!l)throw new TypeError("Invalid target: ".concat(h));this._sessionTimers.enabled&&te.isDecimal(s.sessionTimersExpires)&&(s.sessionTimersExpires>=D.MIN_SESSION_EXPIRES?this._sessionTimers.defaultExpires=s.sessionTimersExpires:this._sessionTimers.defaultExpires=D.SESSION_EXPIRES);for(let O in t)Object.prototype.hasOwnProperty.call(t,O)&&this.on(O,t[O]);this._from_tag=te.newTag();let $=s.anonymous||!1,x={from_tag:this._from_tag};this._contact=this._ua.contact.toString({anonymous:$,outbound:!0}),$?(x.from_display_name="Anonymous",x.from_uri=new Vi("sip","anonymous","anonymous.invalid"),u.push("P-Preferred-Identity: ".concat(this._ua.configuration.uri.toString())),u.push("Privacy: id")):s.fromUserName&&(x.from_uri=new Vi("sip",s.fromUserName,this._ua.configuration.uri.host),u.push("P-Preferred-Identity: ".concat(this._ua.configuration.uri.toString()))),s.fromDisplayName&&(x.from_display_name=s.fromDisplayName),u.push("Contact: ".concat(this._contact)),u.push("Content-Type: application/sdp"),this._sessionTimers.enabled&&u.push("Session-Expires: ".concat(this._sessionTimers.defaultExpires).concat(this._ua.configuration.session_timers_force_refresher?";refresher=uac":"")),this._request=new pa.InitialOutgoingInviteRequest(l,this._ua,x,u),this._id=this._request.call_id+this._from_tag,this._createRTCConnection(S,N),this._direction="outgoing",this._local_identity=this._request.from,this._remote_identity=this._request.to,a&&a(this),this._newRTCSession("local",this._request),this._sendInitialRequest(p,c,g)}init_incoming(l,s){E.debug("init_incoming()");let a,h=l.hasHeader("Content-Type")?l.getHeader("Content-Type").toLowerCase():void 0;if(l.body&&h!=="application/sdp"){l.reply(415);return}if(this._status=v.STATUS_INVITE_RECEIVED,this._from_tag=l.from_tag,this._id=l.call_id+this._from_tag,this._request=l,this._contact=this._ua.contact.toString(),l.hasHeader("expires")&&(a=l.getHeader("expires")*1e3),l.to_tag=te.newTag(),!this._createDialog(l,"UAS",!0)){l.reply(500,"Missing Contact header field");return}l.body?this._late_sdp=!1:this._late_sdp=!0,this._status=v.STATUS_WAITING_FOR_ANSWER,this._timers.userNoAnswerTimer=setTimeout(()=>{l.reply(408),this._failed("local",null,D.causes.NO_ANSWER)},this._ua.configuration.no_answer_timeout),a&&(this._timers.expiresTimer=setTimeout(()=>{this._status===v.STATUS_WAITING_FOR_ANSWER&&(l.reply(487),this._failed("system",null,D.causes.EXPIRES))},a)),this._direction="incoming",this._local_identity=l.to,this._remote_identity=l.from,s&&s(this),this._newRTCSession("remote",l),this._status!==v.STATUS_TERMINATED&&(l.reply(180,null,["Contact: ".concat(this._contact)]),this._progress("local",null))}answer(l={}){E.debug("answer()");let s=this._request,a=te.cloneArray(l.extraHeaders),h=te.cloneObject(l.mediaConstraints),t=l.mediaStream||null,u=te.cloneObject(l.pcConfig,{iceServers:[]}),p=l.rtcConstraints||null,g=l.rtcAnswerConstraints||null,S=te.cloneObject(l.rtcOfferConstraints),N,c=!1,$=!1,x=!1,O=!1;if(this._rtcAnswerConstraints=g,this._rtcOfferConstraints=l.rtcOfferConstraints||null,this._data=l.data||this._data,this._direction!=="incoming")throw new tt.NotSupportedError('"answer" not supported for outgoing RTCSession');if(this._status!==v.STATUS_WAITING_FOR_ANSWER)throw new tt.InvalidStateError(this._status);if(this._sessionTimers.enabled&&te.isDecimal(l.sessionTimersExpires)&&(l.sessionTimersExpires>=D.MIN_SESSION_EXPIRES?this._sessionTimers.defaultExpires=l.sessionTimersExpires:this._sessionTimers.defaultExpires=D.SESSION_EXPIRES),this._status=v.STATUS_ANSWERED,!this._createDialog(s,"UAS")){s.reply(500,"Error creating dialog");return}clearTimeout(this._timers.userNoAnswerTimer),a.unshift("Contact: ".concat(this._contact));let w=s.parseSDP();Array.isArray(w.media)||(w.media=[w.media]);for(let H of w.media)H.type==="audio"&&(c=!0,(!H.direction||H.direction==="sendrecv")&&(x=!0)),H.type==="video"&&($=!0,(!H.direction||H.direction==="sendrecv")&&(O=!0));if(t&&h.audio===!1){N=t.getAudioTracks();for(let H of N)t.removeTrack(H)}if(t&&h.video===!1){N=t.getVideoTracks();for(let H of N)t.removeTrack(H)}!t&&h.audio===void 0&&(h.audio=x),!t&&h.video===void 0&&(h.video=O),!t&&!c&&!S.offerToReceiveAudio&&(h.audio=!1),!t&&!$&&!S.offerToReceiveVideo&&(h.video=!1),this._createRTCConnection(u,p),Promise.resolve().then(()=>{if(t)return t;if(h.audio||h.video)return this._localMediaStreamLocallyGenerated=!0,navigator.mediaDevices.getUserMedia(h).catch(H=>{throw this._status===v.STATUS_TERMINATED?new Error("terminated"):(s.reply(480),this._failed("local",null,D.causes.USER_DENIED_MEDIA_ACCESS),E.warn('emit "getusermediafailed" [error:%o]',H),this.emit("getusermediafailed",H),new Error("getUserMedia() failed"))})}).then(H=>{if(this._status===v.STATUS_TERMINATED)throw new Error("terminated");this._localMediaStream=H,H&&H.getTracks().forEach(fe=>{this._connection.addTrack(fe,H)})}).then(()=>{if(this._late_sdp)return;let H={originator:"remote",type:"offer",sdp:s.body};E.debug('emit "sdp"'),this.emit("sdp",H);let fe=new RTCSessionDescription({type:"offer",sdp:H.sdp});return this._connectionPromiseQueue=this._connectionPromiseQueue.then(()=>this._connection.setRemoteDescription(fe)).catch(se=>{throw s.reply(488),this._failed("system",null,D.causes.WEBRTC_ERROR),E.warn('emit "peerconnection:setremotedescriptionfailed" [error:%o]',se),this.emit("peerconnection:setremotedescriptionfailed",se),new Error("peerconnection.setRemoteDescription() failed")}),this._connectionPromiseQueue}).then(()=>{if(this._status===v.STATUS_TERMINATED)throw new Error("terminated");return this._connecting(s),this._late_sdp?this._createLocalDescription("offer",this._rtcOfferConstraints).catch(()=>{throw s.reply(500),new Error("_createLocalDescription() failed")}):this._createLocalDescription("answer",g).catch(()=>{throw s.reply(500),new Error("_createLocalDescription() failed")})}).then(H=>{if(this._status===v.STATUS_TERMINATED)throw new Error("terminated");this._handleSessionTimersInIncomingRequest(s,a),s.reply(200,null,a,H,()=>{this._status=v.STATUS_WAITING_FOR_ACK,this._setInvite2xxTimer(s,H),this._setACKTimer(),this._accepted("local")},()=>{this._failed("system",null,D.causes.CONNECTION_ERROR)})}).catch(H=>{this._status!==v.STATUS_TERMINATED&&(E.warn("answer() failed: ".concat(H.message)),this._failed("system",H.message,D.causes.INTERNAL_ERROR))})}terminate(l={}){E.debug("terminate()");let s=l.cause||D.causes.BYE,a=te.cloneArray(l.extraHeaders),h=l.body,t,u=l.status_code,p=l.reason_phrase;if(this._status===v.STATUS_TERMINATED)throw new tt.InvalidStateError(this._status);switch(this._status){case v.STATUS_NULL:case v.STATUS_INVITE_SENT:case v.STATUS_1XX_RECEIVED:if(E.debug("canceling session"),u&&(u<200||u>=700))throw new TypeError("Invalid status_code: ".concat(u));u&&(p=p||D.REASON_PHRASE[u]||"",t="SIP ;cause=".concat(u,' ;text="').concat(p,'"')),this._status===v.STATUS_NULL||this._status===v.STATUS_INVITE_SENT?(this._is_canceled=!0,this._cancel_reason=t):this._status===v.STATUS_1XX_RECEIVED&&this._request.cancel(t),this._status=v.STATUS_CANCELED,this._failed("local",null,D.causes.CANCELED);break;case v.STATUS_WAITING_FOR_ANSWER:case v.STATUS_ANSWERED:if(E.debug("rejecting session"),u=u||480,u<300||u>=700)throw new TypeError("Invalid status_code: ".concat(u));this._request.reply(u,p,a,h),this._failed("local",null,D.causes.REJECTED);break;case v.STATUS_WAITING_FOR_ACK:case v.STATUS_CONFIRMED:if(E.debug("terminating session"),p=l.reason_phrase||D.REASON_PHRASE[u]||"",u&&(u<200||u>=700))throw new TypeError("Invalid status_code: ".concat(u));if(u&&a.push("Reason: SIP ;cause=".concat(u,'; text="').concat(p,'"')),this._status===v.STATUS_WAITING_FOR_ACK&&this._direction==="incoming"&&this._request.server_transaction.state!==Bi.C.STATUS_TERMINATED){let g=this._dialog;this.receiveRequest=({method:S})=>{S===D.ACK&&(this.sendRequest(D.BYE,{extraHeaders:a,body:h}),g.terminate())},this._request.server_transaction.on("stateChanged",()=>{this._request.server_transaction.state===Bi.C.STATUS_TERMINATED&&(this.sendRequest(D.BYE,{extraHeaders:a,body:h}),g.terminate())}),this._ended("local",null,s),this._dialog=g,this._ua.newDialog(g)}else this.sendRequest(D.BYE,{extraHeaders:a,body:h}),this._ended("local",null,s)}}sendDTMF(l,s={}){E.debug("sendDTMF() | tones: %s",l);let a=s.duration||null,h=s.interToneGap||null,t=s.transportType||D.DTMF_TRANSPORT.INFO;if(l===void 0)throw new TypeError("Not enough arguments");if(this._status!==v.STATUS_CONFIRMED&&this._status!==v.STATUS_WAITING_FOR_ACK&&this._status!==v.STATUS_1XX_RECEIVED)throw new tt.InvalidStateError(this._status);if(t!==D.DTMF_TRANSPORT.INFO&&t!==D.DTMF_TRANSPORT.RFC2833)throw new TypeError("invalid transportType: ".concat(t));if(typeof l=="number"&&(l=l.toString()),!l||typeof l!="string"||!l.match(/^[0-9A-DR#*,]+$/i))throw new TypeError("Invalid tones: ".concat(l));if(a&&!te.isDecimal(a))throw new TypeError("Invalid tone duration: ".concat(a));if(a?a<Ee.C.MIN_DURATION?(E.debug('"duration" value is lower than the minimum allowed, setting it to '.concat(Ee.C.MIN_DURATION," milliseconds")),a=Ee.C.MIN_DURATION):a>Ee.C.MAX_DURATION?(E.debug('"duration" value is greater than the maximum allowed, setting it to '.concat(Ee.C.MAX_DURATION," milliseconds")),a=Ee.C.MAX_DURATION):a=Math.abs(a):a=Ee.C.DEFAULT_DURATION,s.duration=a,h&&!te.isDecimal(h))throw new TypeError("Invalid interToneGap: ".concat(h));if(h?h<Ee.C.MIN_INTER_TONE_GAP?(E.debug('"interToneGap" value is lower than the minimum allowed, setting it to '.concat(Ee.C.MIN_INTER_TONE_GAP," milliseconds")),h=Ee.C.MIN_INTER_TONE_GAP):h=Math.abs(h):h=Ee.C.DEFAULT_INTER_TONE_GAP,t===D.DTMF_TRANSPORT.RFC2833){let p=this._getDTMFRTPSender();p&&(l=p.toneBuffer+l,p.insertDTMF(l,a,h));return}if(this._tones){this._tones+=l;return}this._tones=l,u.call(this);function u(){let p;if(this._status===v.STATUS_TERMINATED||!this._tones){this._tones=null;return}let g=this._tones[0];if(this._tones=this._tones.substring(1),g===",")p=2e3;else{let S=new Ee(this);s.eventHandlers={onFailed:()=>{this._tones=null}},S.send(g,s),p=a+h}setTimeout(u.bind(this),p)}}sendInfo(l,s,a={}){if(E.debug("sendInfo()"),this._status!==v.STATUS_CONFIRMED&&this._status!==v.STATUS_WAITING_FOR_ACK&&this._status!==v.STATUS_1XX_RECEIVED)throw new tt.InvalidStateError(this._status);new Wi(this).send(l,s,a)}mute(l={audio:!0,video:!1}){E.debug("mute()");let s=!1,a=!1;this._audioMuted===!1&&l.audio&&(s=!0,this._audioMuted=!0,this._toggleMuteAudio(!0)),this._videoMuted===!1&&l.video&&(a=!0,this._videoMuted=!0,this._toggleMuteVideo(!0)),(s===!0||a===!0)&&this._onmute({audio:s,video:a})}unmute(l={audio:!0,video:!0}){E.debug("unmute()");let s=!1,a=!1;this._audioMuted===!0&&l.audio&&(s=!0,this._audioMuted=!1,this._localHold===!1&&this._toggleMuteAudio(!1)),this._videoMuted===!0&&l.video&&(a=!0,this._videoMuted=!1,this._localHold===!1&&this._toggleMuteVideo(!1)),(s===!0||a===!0)&&this._onunmute({audio:s,video:a})}hold(l={},s){if(E.debug("hold()"),this._status!==v.STATUS_WAITING_FOR_ACK&&this._status!==v.STATUS_CONFIRMED||this._localHold===!0||!this.isReadyToReOffer())return!1;this._localHold=!0,this._onhold("local");let a={succeeded:()=>{s&&s()},failed:()=>{this.terminate({cause:D.causes.WEBRTC_ERROR,status_code:500,reason_phrase:"Hold Failed"})}};return l.useUpdate?this._sendUpdate({sdpOffer:!0,eventHandlers:a,extraHeaders:l.extraHeaders}):this._sendReinvite({eventHandlers:a,extraHeaders:l.extraHeaders}),!0}unhold(l={},s){if(E.debug("unhold()"),this._status!==v.STATUS_WAITING_FOR_ACK&&this._status!==v.STATUS_CONFIRMED||this._localHold===!1||!this.isReadyToReOffer())return!1;this._localHold=!1,this._onunhold("local");let a={succeeded:()=>{s&&s()},failed:()=>{this.terminate({cause:D.causes.WEBRTC_ERROR,status_code:500,reason_phrase:"Unhold Failed"})}};return l.useUpdate?this._sendUpdate({sdpOffer:!0,eventHandlers:a,extraHeaders:l.extraHeaders}):this._sendReinvite({eventHandlers:a,extraHeaders:l.extraHeaders}),!0}renegotiate(l={},s){E.debug("renegotiate()");let a=l.rtcOfferConstraints||null;if(this._status!==v.STATUS_WAITING_FOR_ACK&&this._status!==v.STATUS_CONFIRMED||!this.isReadyToReOffer())return!1;let h={succeeded:()=>{s&&s()},failed:()=>{this.terminate({cause:D.causes.WEBRTC_ERROR,status_code:500,reason_phrase:"Media Renegotiation Failed"})}};return this._setLocalMediaStatus(),l.useUpdate?this._sendUpdate({sdpOffer:!0,eventHandlers:h,rtcOfferConstraints:a,extraHeaders:l.extraHeaders}):this._sendReinvite({eventHandlers:h,rtcOfferConstraints:a,extraHeaders:l.extraHeaders}),!0}refer(l,s){E.debug("refer()");let a=l;if(this._status!==v.STATUS_WAITING_FOR_ACK&&this._status!==v.STATUS_CONFIRMED)return!1;if(l=this._ua.normalizeTarget(l),!l)throw new TypeError("Invalid target: ".concat(a));let h=new Ta(this);h.sendRefer(l,s);let t=h.id;return this._referSubscribers[t]=h,h.on("requestFailed",()=>{delete this._referSubscribers[t]}),h.on("accepted",()=>{delete this._referSubscribers[t]}),h.on("failed",()=>{delete this._referSubscribers[t]}),h}sendRequest(l,s){if(E.debug("sendRequest()"),this._dialog)return this._dialog.sendRequest(l,s);{let a=Object.values(this._earlyDialogs);if(a.length>0)return a[0].sendRequest(l,s);E.warn("sendRequest() | no valid early dialog found");return}}receiveRequest(l){if(E.debug("receiveRequest()"),l.method===D.CANCEL)(this._status===v.STATUS_WAITING_FOR_ANSWER||this._status===v.STATUS_ANSWERED)&&(this._status=v.STATUS_CANCELED,this._request.reply(487),this._failed("remote",l,D.causes.CANCELED));else switch(l.method){case D.ACK:if(this._status!==v.STATUS_WAITING_FOR_ACK)return;if(this._status=v.STATUS_CONFIRMED,clearTimeout(this._timers.ackTimer),clearTimeout(this._timers.invite2xxTimer),this._late_sdp){if(!l.body){this.terminate({cause:D.causes.MISSING_SDP,status_code:400});break}let s={originator:"remote",type:"answer",sdp:l.body};E.debug('emit "sdp"'),this.emit("sdp",s);let a=new RTCSessionDescription({type:"answer",sdp:s.sdp});this._connectionPromiseQueue=this._connectionPromiseQueue.then(()=>this._connection.setRemoteDescription(a)).then(()=>{this._is_confirmed||this._confirmed("remote",l)}).catch(h=>{this.terminate({cause:D.causes.BAD_MEDIA_DESCRIPTION,status_code:488}),E.warn('emit "peerconnection:setremotedescriptionfailed" [error:%o]',h),this.emit("peerconnection:setremotedescriptionfailed",h)})}else this._is_confirmed||this._confirmed("remote",l);break;case D.BYE:this._status===v.STATUS_CONFIRMED||this._status===v.STATUS_WAITING_FOR_ACK?(l.reply(200),this._ended("remote",l,D.causes.BYE)):this._status===v.STATUS_INVITE_RECEIVED||this._status===v.STATUS_WAITING_FOR_ANSWER?(l.reply(200),this._request.reply(487,"BYE Received"),this._ended("remote",l,D.causes.BYE)):l.reply(403,"Wrong Status");break;case D.INVITE:this._status===v.STATUS_CONFIRMED?l.hasHeader("replaces")?this._receiveReplaces(l):this._receiveReinvite(l):l.reply(403,"Wrong Status");break;case D.INFO:if(this._status===v.STATUS_1XX_RECEIVED||this._status===v.STATUS_WAITING_FOR_ANSWER||this._status===v.STATUS_ANSWERED||this._status===v.STATUS_WAITING_FOR_ACK||this._status===v.STATUS_CONFIRMED){let s=l.hasHeader("Content-Type")?l.getHeader("Content-Type").toLowerCase():void 0;s&&s.match(/^application\/dtmf-relay/i)?new Ee(this).init_incoming(l):s!==void 0?new Wi(this).init_incoming(l):l.reply(415)}else l.reply(403,"Wrong Status");break;case D.UPDATE:this._status===v.STATUS_CONFIRMED?this._receiveUpdate(l):l.reply(403,"Wrong Status");break;case D.REFER:this._status===v.STATUS_CONFIRMED?this._receiveRefer(l):l.reply(403,"Wrong Status");break;case D.NOTIFY:this._status===v.STATUS_CONFIRMED?this._receiveNotify(l):l.reply(403,"Wrong Status");break;default:l.reply(501)}}onTransportError(){E.warn("onTransportError()"),this._status!==v.STATUS_TERMINATED&&this.terminate({status_code:500,reason_phrase:D.causes.CONNECTION_ERROR,cause:D.causes.CONNECTION_ERROR})}onRequestTimeout(){E.warn("onRequestTimeout()"),this._status!==v.STATUS_TERMINATED&&this.terminate({status_code:408,reason_phrase:D.causes.REQUEST_TIMEOUT,cause:D.causes.REQUEST_TIMEOUT})}onDialogError(){E.warn("onDialogError()"),this._status!==v.STATUS_TERMINATED&&this.terminate({status_code:500,reason_phrase:D.causes.DIALOG_ERROR,cause:D.causes.DIALOG_ERROR})}newDTMF(l){E.debug("newDTMF()"),this.emit("newDTMF",l)}newInfo(l){E.debug("newInfo()"),this.emit("newInfo",l)}isReadyToReOffer(){return this._rtcReady?this._dialog?this._dialog.uac_pending_reply===!0||this._dialog.uas_pending_reply===!0?(E.debug("isReadyToReOffer() | there is another INVITE/UPDATE transaction in progress"),!1):!0:(E.debug("isReadyToReOffer() | session not established yet"),!1):(E.debug("isReadyToReOffer() | internal WebRTC status not ready"),!1)}_close(){if(E.debug("close()"),this._localMediaStream&&this._localMediaStreamLocallyGenerated&&(E.debug("close() | closing local MediaStream"),te.closeMediaStream(this._localMediaStream)),this._status!==v.STATUS_TERMINATED){if(this._status=v.STATUS_TERMINATED,this._connection)try{this._connection.close()}catch(l){E.warn("close() | error closing the RTCPeerConnection: %o",l)}for(let l in this._timers)Object.prototype.hasOwnProperty.call(this._timers,l)&&clearTimeout(this._timers[l]);clearTimeout(this._sessionTimers.timer),this._dialog&&(this._dialog.terminate(),delete this._dialog);for(let l in this._earlyDialogs)Object.prototype.hasOwnProperty.call(this._earlyDialogs,l)&&(this._earlyDialogs[l].terminate(),delete this._earlyDialogs[l]);for(let l in this._referSubscribers)Object.prototype.hasOwnProperty.call(this._referSubscribers,l)&&delete this._referSubscribers[l];this._ua.destroyRTCSession(this)}}_setInvite2xxTimer(l,s){let a=Ht.T1;function h(){this._status===v.STATUS_WAITING_FOR_ACK&&(l.reply(200,null,["Contact: ".concat(this._contact)],s),a<Ht.T2&&(a=a*2,a>Ht.T2&&(a=Ht.T2)),this._timers.invite2xxTimer=setTimeout(h.bind(this),a))}this._timers.invite2xxTimer=setTimeout(h.bind(this),a)}_setACKTimer(){this._timers.ackTimer=setTimeout(()=>{this._status===v.STATUS_WAITING_FOR_ACK&&(E.debug("no ACK received, terminating the session"),clearTimeout(this._timers.invite2xxTimer),this.sendRequest(D.BYE),this._ended("remote",null,D.causes.NO_ACK))},Ht.TIMER_H)}_createRTCConnection(l,s){this._connection=new RTCPeerConnection(l,s),this._connection.addEventListener("iceconnectionstatechange",()=>{this._connection.iceConnectionState==="failed"&&this.terminate({cause:D.causes.RTP_TIMEOUT,status_code:408,reason_phrase:D.causes.RTP_TIMEOUT})}),E.debug('emit "peerconnection"'),this.emit("peerconnection",{peerconnection:this._connection})}_createLocalDescription(l,s){if(E.debug("createLocalDescription()"),l!=="offer"&&l!=="answer")throw new Error('createLocalDescription() | invalid type "'.concat(l,'"'));let a=this._connection;return this._rtcReady=!1,Promise.resolve().then(()=>l==="offer"?a.createOffer(s).catch(h=>(E.warn('emit "peerconnection:createofferfailed" [error:%o]',h),this.emit("peerconnection:createofferfailed",h),Promise.reject(h))):a.createAnswer(s).catch(h=>(E.warn('emit "peerconnection:createanswerfailed" [error:%o]',h),this.emit("peerconnection:createanswerfailed",h),Promise.reject(h)))).then(h=>a.setLocalDescription(h).catch(t=>(this._rtcReady=!0,E.warn('emit "peerconnection:setlocaldescriptionfailed" [error:%o]',t),this.emit("peerconnection:setlocaldescriptionfailed",t),Promise.reject(t)))).then(()=>{let h=s&&s.iceRestart;if(a.iceGatheringState==="complete"&&!h||a.iceGatheringState==="gathering"&&this._iceReady){this._rtcReady=!0;let t={originator:"local",type:l,sdp:a.localDescription.sdp};return E.debug('emit "sdp"'),this.emit("sdp",t),Promise.resolve(t.sdp)}return new Promise(t=>{let u=!1,p,g;this._iceReady=!1;let S=()=>{if(u)return;a.removeEventListener("icecandidate",p),a.removeEventListener("icegatheringstatechange",g),u=!0,this._rtcReady=!0,this._iceReady=!0;let N={originator:"local",type:l,sdp:a.localDescription.sdp};E.debug('emit "sdp"'),this.emit("sdp",N),t(N.sdp)};a.addEventListener("icecandidate",p=N=>{let c=N.candidate;c?this.emit("icecandidate",{candidate:c,ready:S}):S()}),a.addEventListener("icegatheringstatechange",g=()=>{a.iceGatheringState==="complete"&&S()})})})}_createDialog(l,s,a){let h=s==="UAS"?l.to_tag:l.from_tag,t=s==="UAS"?l.from_tag:l.to_tag,u=l.call_id+h+t,p=this._earlyDialogs[u];if(a)return p?!0:(p=new Es(this,l,s,Es.C.STATUS_EARLY),p.error?(E.debug(p.error),this._failed("remote",l,D.causes.INTERNAL_ERROR),!1):(this._earlyDialogs[u]=p,!0));{if(this._from_tag=l.from_tag,this._to_tag=l.to_tag,p)return p.update(l,s),this._dialog=p,delete this._earlyDialogs[u],!0;let g=new Es(this,l,s);return g.error?(E.debug(g.error),this._failed("remote",l,D.causes.INTERNAL_ERROR),!1):(this._dialog=g,!0)}}_receiveReinvite(l){E.debug("receiveReinvite()");let s=l.hasHeader("Content-Type")?l.getHeader("Content-Type").toLowerCase():void 0,a={request:l,callback:void 0,reject:t.bind(this)},h=!1;function t(p={}){h=!0;let g=p.status_code||403,S=p.reason_phrase||"",N=te.cloneArray(p.extraHeaders);if(this._status!==v.STATUS_CONFIRMED)return!1;if(g<300||g>=700)throw new TypeError("Invalid status_code: ".concat(g));l.reply(g,S,N)}if(this.emit("reinvite",a),h)return;if(this._late_sdp=!1,!l.body){this._late_sdp=!0,this._remoteHold&&(this._remoteHold=!1,this._onunhold("remote")),this._connectionPromiseQueue=this._connectionPromiseQueue.then(()=>this._createLocalDescription("offer",this._rtcOfferConstraints)).then(p=>{u.call(this,p)}).catch(()=>{l.reply(500)});return}if(s!=="application/sdp"){E.debug("invalid Content-Type"),l.reply(415);return}this._processInDialogSdpOffer(l).then(p=>{this._status!==v.STATUS_TERMINATED&&u.call(this,p)}).catch(p=>{E.warn(p)});function u(p){let g=["Contact: ".concat(this._contact)];this._handleSessionTimersInIncomingRequest(l,g),this._late_sdp&&(p=this._mangleOffer(p)),l.reply(200,null,g,p,()=>{this._status=v.STATUS_WAITING_FOR_ACK,this._setInvite2xxTimer(l,p),this._setACKTimer()}),typeof a.callback=="function"&&a.callback()}}_receiveUpdate(l){E.debug("receiveUpdate()");let s=l.hasHeader("Content-Type")?l.getHeader("Content-Type").toLowerCase():void 0,a={request:l,callback:void 0,reject:t.bind(this)},h=!1;function t(p={}){h=!0;let g=p.status_code||403,S=p.reason_phrase||"",N=te.cloneArray(p.extraHeaders);if(this._status!==v.STATUS_CONFIRMED)return!1;if(g<300||g>=700)throw new TypeError("Invalid status_code: ".concat(g));l.reply(g,S,N)}if(this.emit("update",a),h)return;if(!l.body){u.call(this,null);return}if(s!=="application/sdp"){E.debug("invalid Content-Type"),l.reply(415);return}this._processInDialogSdpOffer(l).then(p=>{this._status!==v.STATUS_TERMINATED&&u.call(this,p)}).catch(p=>{E.warn(p)});function u(p){let g=["Contact: ".concat(this._contact)];this._handleSessionTimersInIncomingRequest(l,g),l.reply(200,null,g,p),typeof a.callback=="function"&&a.callback()}}_processInDialogSdpOffer(l){E.debug("_processInDialogSdpOffer()");let s=l.parseSDP(),a=!1;for(let u of s.media){if(As.indexOf(u.type)===-1)continue;let p=u.direction||s.direction||"sendrecv";if(p==="sendonly"||p==="inactive")a=!0;else{a=!1;break}}let h={originator:"remote",type:"offer",sdp:l.body};E.debug('emit "sdp"'),this.emit("sdp",h);let t=new RTCSessionDescription({type:"offer",sdp:h.sdp});return this._connectionPromiseQueue=this._connectionPromiseQueue.then(()=>{if(this._status===v.STATUS_TERMINATED)throw new Error("terminated");return this._connection.setRemoteDescription(t).catch(u=>{throw l.reply(488),E.warn('emit "peerconnection:setremotedescriptionfailed" [error:%o]',u),this.emit("peerconnection:setremotedescriptionfailed",u),u})}).then(()=>{if(this._status===v.STATUS_TERMINATED)throw new Error("terminated");this._remoteHold===!0&&a===!1?(this._remoteHold=!1,this._onunhold("remote")):this._remoteHold===!1&&a===!0&&(this._remoteHold=!0,this._onhold("remote"))}).then(()=>{if(this._status===v.STATUS_TERMINATED)throw new Error("terminated");return this._createLocalDescription("answer",this._rtcAnswerConstraints).catch(u=>{throw l.reply(500),E.warn('emit "peerconnection:createtelocaldescriptionfailed" [error:%o]',u),u})}).catch(u=>{E.warn("_processInDialogSdpOffer() failed [error: %o]",u)}),this._connectionPromiseQueue}_receiveRefer(l){if(E.debug("receiveRefer()"),!l.refer_to){E.debug("no Refer-To header field present in REFER"),l.reply(400);return}if(l.refer_to.uri.scheme!==D.SIP){E.debug("Refer-To header field points to a non-SIP URI scheme"),l.reply(416);return}l.reply(202);let s=new ga(this,l.cseq);E.debug('emit "refer"'),this.emit("refer",{request:l,accept:(t,u)=>{a.call(this,t,u)},reject:()=>{h.call(this)}});function a(t,u={}){if(t=typeof t=="function"?t:null,this._status!==v.STATUS_WAITING_FOR_ACK&&this._status!==v.STATUS_CONFIRMED)return!1;let p=new wr(this._ua);if(p.on("progress",({response:g})=>{s.notify(g.status_code,g.reason_phrase)}),p.on("accepted",({response:g})=>{s.notify(g.status_code,g.reason_phrase)}),p.on("_failed",({message:g,cause:S})=>{g?s.notify(g.status_code,g.reason_phrase):s.notify(487,S)}),l.refer_to.uri.hasHeader("replaces")){let g=decodeURIComponent(l.refer_to.uri.getHeader("replaces"));u.extraHeaders=te.cloneArray(u.extraHeaders),u.extraHeaders.push("Replaces: ".concat(g))}p.connect(l.refer_to.uri.toAor(),u,t)}function h(){s.notify(603)}}_receiveNotify(l){switch(E.debug("receiveNotify()"),l.event||l.reply(400),l.event.event){case"refer":{let s,a;if(l.event.params&&l.event.params.id)s=l.event.params.id,a=this._referSubscribers[s];else if(Object.keys(this._referSubscribers).length===1)a=this._referSubscribers[Object.keys(this._referSubscribers)[0]];else{l.reply(400,"Missing event id parameter");return}if(!a){l.reply(481,"Subscription does not exist");return}a.receiveNotify(l),l.reply(200);break}default:l.reply(489)}}_receiveReplaces(l){E.debug("receiveReplaces()");function s(h){if(this._status!==v.STATUS_WAITING_FOR_ACK&&this._status!==v.STATUS_CONFIRMED)return!1;let t=new wr(this._ua);t.on("confirmed",()=>{this.terminate()}),t.init_incoming(l,h)}function a(){E.debug("Replaced INVITE rejected by the user"),l.reply(486)}this.emit("replaces",{request:l,accept:h=>{s.call(this,h)},reject:()=>{a.call(this)}})}_sendInitialRequest(l,s,a){let h=new ma(this._ua,this._request,{onRequestTimeout:()=>{this.onRequestTimeout()},onTransportError:()=>{this.onTransportError()},onAuthenticated:t=>{this._request=t},onReceiveResponse:t=>{this._receiveInviteResponse(t)}});Promise.resolve().then(()=>{if(a)return a;if(l.audio||l.video)return this._localMediaStreamLocallyGenerated=!0,navigator.mediaDevices.getUserMedia(l).catch(t=>{throw this._status===v.STATUS_TERMINATED?new Error("terminated"):(this._failed("local",null,D.causes.USER_DENIED_MEDIA_ACCESS),E.warn('emit "getusermediafailed" [error:%o]',t),this.emit("getusermediafailed",t),t)})}).then(t=>{if(this._status===v.STATUS_TERMINATED)throw new Error("terminated");return this._localMediaStream=t,t&&t.getTracks().forEach(u=>{this._connection.addTrack(u,t)}),this._connecting(this._request),this._createLocalDescription("offer",s).catch(u=>{throw this._failed("local",null,D.causes.WEBRTC_ERROR),u})}).then(t=>{if(this._is_canceled||this._status===v.STATUS_TERMINATED)throw new Error("terminated");this._request.body=t,this._status=v.STATUS_INVITE_SENT,E.debug('emit "sending" [request:%o]',this._request),this.emit("sending",{request:this._request}),h.send()}).catch(t=>{this._status!==v.STATUS_TERMINATED&&E.warn(t)})}_getDTMFRTPSender(){let l=this._connection.getSenders().find(s=>s.track&&s.track.kind==="audio");if(!(l&&l.dtmf)){E.warn("sendDTMF() | no local audio track to send DTMF with");return}return l.dtmf}_receiveInviteResponse(l){if(E.debug("receiveInviteResponse()"),this._dialog&&l.status_code>=200&&l.status_code<=299)if(this._dialog.id.call_id===l.call_id&&this._dialog.id.local_tag===l.from_tag&&this._dialog.id.remote_tag===l.to_tag){this.sendRequest(D.ACK);return}else{let s=new Es(this,l,"UAC");if(s.error!==void 0){E.debug(s.error);return}this.sendRequest(D.ACK),this.sendRequest(D.BYE);return}if(this._is_canceled){l.status_code>=100&&l.status_code<200?this._request.cancel(this._cancel_reason):l.status_code>=200&&l.status_code<299&&this._acceptAndTerminate(l);return}if(!(this._status!==v.STATUS_INVITE_SENT&&this._status!==v.STATUS_1XX_RECEIVED))switch(!0){case/^100$/.test(l.status_code):this._status=v.STATUS_1XX_RECEIVED;break;case/^1[0-9]{2}$/.test(l.status_code):{if(!l.to_tag){E.debug("1xx response received without to tag");break}if(l.hasHeader("contact")&&!this._createDialog(l,"UAC",!0))break;if(this._status=v.STATUS_1XX_RECEIVED,!l.body){this._progress("remote",l);break}let s={originator:"remote",type:"answer",sdp:l.body};E.debug('emit "sdp"'),this.emit("sdp",s);let a=new RTCSessionDescription({type:"answer",sdp:s.sdp});this._connectionPromiseQueue=this._connectionPromiseQueue.then(()=>this._connection.setRemoteDescription(a)).then(()=>this._progress("remote",l)).catch(h=>{E.warn('emit "peerconnection:setremotedescriptionfailed" [error:%o]',h),this.emit("peerconnection:setremotedescriptionfailed",h)});break}case/^2[0-9]{2}$/.test(l.status_code):{if(this._status=v.STATUS_CONFIRMED,!l.body){this._acceptAndTerminate(l,400,D.causes.MISSING_SDP),this._failed("remote",l,D.causes.BAD_MEDIA_DESCRIPTION);break}if(!this._createDialog(l,"UAC"))break;let s={originator:"remote",type:"answer",sdp:l.body};E.debug('emit "sdp"'),this.emit("sdp",s);let a=new RTCSessionDescription({type:"answer",sdp:s.sdp});this._connectionPromiseQueue=this._connectionPromiseQueue.then(()=>{if(this._connection.signalingState==="stable")return this._connection.createOffer(this._rtcOfferConstraints).then(h=>this._connection.setLocalDescription(h)).catch(h=>{this._acceptAndTerminate(l,500,h.toString()),this._failed("local",l,D.causes.WEBRTC_ERROR)})}).then(()=>{this._connection.setRemoteDescription(a).then(()=>{this._handleSessionTimersInIncomingResponse(l),this._accepted("remote",l),this.sendRequest(D.ACK),this._confirmed("local",null)}).catch(h=>{this._acceptAndTerminate(l,488,"Not Acceptable Here"),this._failed("remote",l,D.causes.BAD_MEDIA_DESCRIPTION),E.warn('emit "peerconnection:setremotedescriptionfailed" [error:%o]',h),this.emit("peerconnection:setremotedescriptionfailed",h)})});break}default:{let s=te.sipErrorCause(l.status_code);this._failed("remote",l,s)}}}_sendReinvite(l={}){E.debug("sendReinvite()");let s=te.cloneArray(l.extraHeaders),a=te.cloneObject(l.eventHandlers),h=l.rtcOfferConstraints||this._rtcOfferConstraints||null,t=!1;s.push("Contact: ".concat(this._contact)),s.push("Content-Type: application/sdp"),this._sessionTimers.running&&s.push("Session-Expires: ".concat(this._sessionTimers.currentExpires,";refresher=").concat(this._sessionTimers.refresher?"uac":"uas")),this._connectionPromiseQueue=this._connectionPromiseQueue.then(()=>this._createLocalDescription("offer",h)).then(g=>{g=this._mangleOffer(g);let S={originator:"local",type:"offer",sdp:g};E.debug('emit "sdp"'),this.emit("sdp",S),this.sendRequest(D.INVITE,{extraHeaders:s,body:g,eventHandlers:{onSuccessResponse:N=>{u.call(this,N),t=!0},onErrorResponse:N=>{p.call(this,N)},onTransportError:()=>{this.onTransportError()},onRequestTimeout:()=>{this.onRequestTimeout()},onDialogError:()=>{this.onDialogError()}}})}).catch(()=>{p()});function u(g){if(this._status===v.STATUS_TERMINATED||(this.sendRequest(D.ACK),t))return;if(this._handleSessionTimersInIncomingResponse(g),g.body){if(!g.hasHeader("Content-Type")||g.getHeader("Content-Type").toLowerCase()!=="application/sdp"){p.call(this);return}}else{p.call(this);return}let S={originator:"remote",type:"answer",sdp:g.body};E.debug('emit "sdp"'),this.emit("sdp",S);let N=new RTCSessionDescription({type:"answer",sdp:S.sdp});this._connectionPromiseQueue=this._connectionPromiseQueue.then(()=>this._connection.setRemoteDescription(N)).then(()=>{a.succeeded&&a.succeeded(g)}).catch(c=>{p.call(this),E.warn('emit "peerconnection:setremotedescriptionfailed" [error:%o]',c),this.emit("peerconnection:setremotedescriptionfailed",c)})}function p(g){a.failed&&a.failed(g)}}_sendUpdate(l={}){E.debug("sendUpdate()");let s=te.cloneArray(l.extraHeaders),a=te.cloneObject(l.eventHandlers),h=l.rtcOfferConstraints||this._rtcOfferConstraints||null,t=l.sdpOffer||!1,u=!1;s.push("Contact: ".concat(this._contact)),this._sessionTimers.running&&s.push("Session-Expires: ".concat(this._sessionTimers.currentExpires,";refresher=").concat(this._sessionTimers.refresher?"uac":"uas")),t?(s.push("Content-Type: application/sdp"),this._connectionPromiseQueue=this._connectionPromiseQueue.then(()=>this._createLocalDescription("offer",h)).then(S=>{S=this._mangleOffer(S);let N={originator:"local",type:"offer",sdp:S};E.debug('emit "sdp"'),this.emit("sdp",N),this.sendRequest(D.UPDATE,{extraHeaders:s,body:S,eventHandlers:{onSuccessResponse:c=>{p.call(this,c),u=!0},onErrorResponse:c=>{g.call(this,c)},onTransportError:()=>{this.onTransportError()},onRequestTimeout:()=>{this.onRequestTimeout()},onDialogError:()=>{this.onDialogError()}}})}).catch(()=>{g.call(this)})):this.sendRequest(D.UPDATE,{extraHeaders:s,eventHandlers:{onSuccessResponse:S=>{p.call(this,S)},onErrorResponse:S=>{g.call(this,S)},onTransportError:()=>{this.onTransportError()},onRequestTimeout:()=>{this.onRequestTimeout()},onDialogError:()=>{this.onDialogError()}}});function p(S){if(this._status!==v.STATUS_TERMINATED&&!u)if(this._handleSessionTimersInIncomingResponse(S),t){if(S.body){if(!S.hasHeader("Content-Type")||S.getHeader("Content-Type").toLowerCase()!=="application/sdp"){g.call(this);return}}else{g.call(this);return}let N={originator:"remote",type:"answer",sdp:S.body};E.debug('emit "sdp"'),this.emit("sdp",N);let c=new RTCSessionDescription({type:"answer",sdp:N.sdp});this._connectionPromiseQueue=this._connectionPromiseQueue.then(()=>this._connection.setRemoteDescription(c)).then(()=>{a.succeeded&&a.succeeded(S)}).catch($=>{g.call(this),E.warn('emit "peerconnection:setremotedescriptionfailed" [error:%o]',$),this.emit("peerconnection:setremotedescriptionfailed",$)})}else a.succeeded&&a.succeeded(S)}function g(S){a.failed&&a.failed(S)}}_acceptAndTerminate(l,s,a){E.debug("acceptAndTerminate()");let h=[];s&&(a=a||D.REASON_PHRASE[s]||"",h.push("Reason: SIP ;cause=".concat(s,'; text="').concat(a,'"'))),(this._dialog||this._createDialog(l,"UAC"))&&(this.sendRequest(D.ACK),this.sendRequest(D.BYE,{extraHeaders:h})),this._status=v.STATUS_TERMINATED}_mangleOffer(l){if(!this._localHold&&!this._remoteHold)return l;if(l=Gi.parse(l),this._localHold&&!this._remoteHold){E.debug("mangleOffer() | me on hold, mangling offer");for(let s of l.media)As.indexOf(s.type)!==-1&&(s.direction?s.direction==="sendrecv"?s.direction="sendonly":s.direction==="recvonly"&&(s.direction="inactive"):s.direction="sendonly")}else if(this._localHold&&this._remoteHold){E.debug("mangleOffer() | both on hold, mangling offer");for(let s of l.media)As.indexOf(s.type)!==-1&&(s.direction="inactive")}else if(this._remoteHold){E.debug("mangleOffer() | remote on hold, mangling offer");for(let s of l.media)As.indexOf(s.type)!==-1&&(s.direction?s.direction==="sendrecv"?s.direction="recvonly":s.direction==="recvonly"&&(s.direction="inactive"):s.direction="recvonly")}return Gi.write(l)}_setLocalMediaStatus(){let l=!0,s=!0;(this._localHold||this._remoteHold)&&(l=!1,s=!1),this._audioMuted&&(l=!1),this._videoMuted&&(s=!1),this._toggleMuteAudio(!l),this._toggleMuteVideo(!s)}_handleSessionTimersInIncomingRequest(l,s){if(!this._sessionTimers.enabled)return;let a;l.session_expires&&l.session_expires>=D.MIN_SESSION_EXPIRES?(this._sessionTimers.currentExpires=l.session_expires,a=l.session_expires_refresher||"uas"):(this._sessionTimers.currentExpires=this._sessionTimers.defaultExpires,a="uas"),s.push("Session-Expires: ".concat(this._sessionTimers.currentExpires,";refresher=").concat(a)),this._sessionTimers.refresher=a==="uas",this._runSessionTimer()}_handleSessionTimersInIncomingResponse(l){if(!this._sessionTimers.enabled)return;let s;l.session_expires&&l.session_expires>=D.MIN_SESSION_EXPIRES?(this._sessionTimers.currentExpires=l.session_expires,s=l.session_expires_refresher||"uac"):(this._sessionTimers.currentExpires=this._sessionTimers.defaultExpires,s="uac"),this._sessionTimers.refresher=s==="uac",this._runSessionTimer()}_runSessionTimer(){let l=this._sessionTimers.currentExpires;this._sessionTimers.running=!0,clearTimeout(this._sessionTimers.timer),this._sessionTimers.refresher?this._sessionTimers.timer=setTimeout(()=>{this._status!==v.STATUS_TERMINATED&&this.isReadyToReOffer()&&(E.debug("runSessionTimer() | sending session refresh request"),this._sessionTimers.refreshMethod===D.UPDATE?this._sendUpdate():this._sendReinvite())},l*500):this._sessionTimers.timer=setTimeout(()=>{this._status!==v.STATUS_TERMINATED&&(E.warn("runSessionTimer() | timer expired, terminating the session"),this.terminate({cause:D.causes.REQUEST_TIMEOUT,status_code:408,reason_phrase:"Session Timer Expired"}))},l*1100)}_toggleMuteAudio(l){let s=this._connection.getSenders().filter(a=>a.track&&a.track.kind==="audio");for(let a of s)a.track.enabled=!l}_toggleMuteVideo(l){let s=this._connection.getSenders().filter(a=>a.track&&a.track.kind==="video");for(let a of s)a.track.enabled=!l}_newRTCSession(l,s){E.debug("newRTCSession()"),this._ua.newRTCSession(this,{originator:l,session:this,request:s})}_connecting(l){E.debug("session connecting"),E.debug('emit "connecting"'),this.emit("connecting",{request:l})}_progress(l,s){E.debug("session progress"),E.debug('emit "progress"'),this.emit("progress",{originator:l,response:s||null})}_accepted(l,s){E.debug("session accepted"),this._start_time=new Date,E.debug('emit "accepted"'),this.emit("accepted",{originator:l,response:s||null})}_confirmed(l,s){E.debug("session confirmed"),this._is_confirmed=!0,E.debug('emit "confirmed"'),this.emit("confirmed",{originator:l,ack:s||null})}_ended(l,s,a){E.debug("session ended"),this._end_time=new Date,this._close(),E.debug('emit "ended"'),this.emit("ended",{originator:l,message:s||null,cause:a})}_failed(l,s,a){E.debug("session failed"),E.debug('emit "_failed"'),this.emit("_failed",{originator:l,message:s||null,cause:a}),this._close(),E.debug('emit "failed"'),this.emit("failed",{originator:l,message:s||null,cause:a})}_onhold(l){E.debug("session onhold"),this._setLocalMediaStatus(),E.debug('emit "hold"'),this.emit("hold",{originator:l})}_onunhold(l){E.debug("session onunhold"),this._setLocalMediaStatus(),E.debug('emit "unhold"'),this.emit("unhold",{originator:l})}_onmute({audio:l,video:s}){E.debug("session onmute"),this._setLocalMediaStatus(),E.debug('emit "muted"'),this.emit("muted",{audio:l,video:s})}_onunmute({audio:l,video:s}){E.debug("session onunmute"),this._setLocalMediaStatus(),E.debug('emit "unmuted"'),this.emit("unmuted",{audio:l,video:s})}}});var zi=W((lc,Yi)=>{var Ca=$e().EventEmitter,Ea=ae(),Ir=le(),Aa=xe(),qt=ce(),Sa=pt(),Ki=He(),va=qe(),Ss=new Ea("Message");Yi.exports=class extends Ca{constructor(l){super(),this._ua=l,this._request=null,this._closed=!1,this._direction=null,this._local_identity=null,this._remote_identity=null,this._is_replied=!1,this._data={}}get direction(){return this._direction}get local_identity(){return this._local_identity}get remote_identity(){return this._remote_identity}send(l,s,a={}){let h=l;if(l===void 0||s===void 0)throw new TypeError("Not enough arguments");if(l=this._ua.normalizeTarget(l),!l)throw new TypeError("Invalid target: ".concat(h));let t=qt.cloneArray(a.extraHeaders),u=qt.cloneObject(a.eventHandlers),p=a.contentType||"text/plain",g={};a.fromUserName&&(g.from_uri=new va("sip",a.fromUserName,this._ua.configuration.uri.host),t.push("P-Preferred-Identity: ".concat(this._ua.configuration.uri.toString()))),a.fromDisplayName&&(g.from_display_name=a.fromDisplayName);for(let N in u)Object.prototype.hasOwnProperty.call(u,N)&&this.on(N,u[N]);t.push("Content-Type: ".concat(p)),this._request=new Aa.OutgoingRequest(Ir.MESSAGE,l,this._ua,g,t),s&&(this._request.body=s);let S=new Sa(this._ua,this._request,{onRequestTimeout:()=>{this._onRequestTimeout()},onTransportError:()=>{this._onTransportError()},onReceiveResponse:N=>{this._receiveResponse(N)}});this._newMessage("local",this._request),S.send()}init_incoming(l){this._request=l,this._newMessage("remote",l),this._is_replied||(this._is_replied=!0,l.reply(200)),this._close()}accept(l={}){let s=qt.cloneArray(l.extraHeaders),a=l.body;if(this._direction!=="incoming")throw new Ki.NotSupportedError('"accept" not supported for outgoing Message');if(this._is_replied)throw new Error("incoming Message already replied");this._is_replied=!0,this._request.reply(200,null,s,a)}reject(l={}){let s=l.status_code||480,a=l.reason_phrase,h=qt.cloneArray(l.extraHeaders),t=l.body;if(this._direction!=="incoming")throw new Ki.NotSupportedError('"reject" not supported for outgoing Message');if(this._is_replied)throw new Error("incoming Message already replied");if(s<300||s>=700)throw new TypeError("Invalid status_code: ".concat(s));this._is_replied=!0,this._request.reply(s,a,h,t)}_receiveResponse(l){if(!this._closed)switch(!0){case/^1[0-9]{2}$/.test(l.status_code):break;case/^2[0-9]{2}$/.test(l.status_code):this._succeeded("remote",l);break;default:{let s=qt.sipErrorCause(l.status_code);this._failed("remote",l,s);break}}}_onRequestTimeout(){this._closed||this._failed("system",null,Ir.causes.REQUEST_TIMEOUT)}_onTransportError(){this._closed||this._failed("system",null,Ir.causes.CONNECTION_ERROR)}_close(){this._closed=!0,this._ua.destroyMessage(this)}_newMessage(l,s){l==="remote"?(this._direction="incoming",this._local_identity=s.to,this._remote_identity=s.from):l==="local"&&(this._direction="outgoing",this._local_identity=s.from,this._remote_identity=s.to),this._ua.newMessage(this,{originator:l,message:this,request:s})}_failed(l,s,a){Ss.debug("MESSAGE failed"),this._close(),Ss.debug('emit "failed"'),this.emit("failed",{originator:l,response:s||null,cause:a})}_succeeded(l,s){Ss.debug("MESSAGE succeeded"),this._close(),Ss.debug('emit "succeeded"'),this.emit("succeeded",{originator:l,response:s})}}});var Qi=W((ic,Xi)=>{var Ra=$e().EventEmitter,ba=ae(),Nr=le(),wa=xe(),$t=ce(),ya=pt(),Ji=He(),vs=new ba("Options");Xi.exports=class extends Ra{constructor(l){super(),this._ua=l,this._request=null,this._closed=!1,this._direction=null,this._local_identity=null,this._remote_identity=null,this._is_replied=!1,this._data={}}get direction(){return this._direction}get local_identity(){return this._local_identity}get remote_identity(){return this._remote_identity}send(l,s,a={}){let h=l;if(l===void 0)throw new TypeError("A target is required for OPTIONS");if(l=this._ua.normalizeTarget(l),!l)throw new TypeError("Invalid target: ".concat(h));let t=$t.cloneArray(a.extraHeaders),u=$t.cloneObject(a.eventHandlers),p=a.contentType||"application/sdp";for(let S in u)Object.prototype.hasOwnProperty.call(u,S)&&this.on(S,u[S]);t.push("Content-Type: ".concat(p)),this._request=new wa.OutgoingRequest(Nr.OPTIONS,l,this._ua,null,t),s&&(this._request.body=s);let g=new ya(this._ua,this._request,{onRequestTimeout:()=>{this._onRequestTimeout()},onTransportError:()=>{this._onTransportError()},onReceiveResponse:S=>{this._receiveResponse(S)}});this._newOptions("local",this._request),g.send()}init_incoming(l){this._request=l,this._newOptions("remote",l),this._is_replied||(this._is_replied=!0,l.reply(200)),this._close()}accept(l={}){let s=$t.cloneArray(l.extraHeaders),a=l.body;if(this._direction!=="incoming")throw new Ji.NotSupportedError('"accept" not supported for outgoing Options');if(this._is_replied)throw new Error("incoming Options already replied");this._is_replied=!0,this._request.reply(200,null,s,a)}reject(l={}){let s=l.status_code||480,a=l.reason_phrase,h=$t.cloneArray(l.extraHeaders),t=l.body;if(this._direction!=="incoming")throw new Ji.NotSupportedError('"reject" not supported for outgoing Options');if(this._is_replied)throw new Error("incoming Options already replied");if(s<300||s>=700)throw new TypeError("Invalid status_code: ".concat(s));this._is_replied=!0,this._request.reply(s,a,h,t)}_receiveResponse(l){if(!this._closed)switch(!0){case/^1[0-9]{2}$/.test(l.status_code):break;case/^2[0-9]{2}$/.test(l.status_code):this._succeeded("remote",l);break;default:{let s=$t.sipErrorCause(l.status_code);this._failed("remote",l,s);break}}}_onRequestTimeout(){this._closed||this._failed("system",null,Nr.causes.REQUEST_TIMEOUT)}_onTransportError(){this._closed||this._failed("system",null,Nr.causes.CONNECTION_ERROR)}_close(){this._closed=!0,this._ua.destroyMessage(this)}_newOptions(l,s){l==="remote"?(this._direction="incoming",this._local_identity=s.to,this._remote_identity=s.from):l==="local"&&(this._direction="outgoing",this._local_identity=s.from,this._remote_identity=s.to),this._ua.newOptions(this,{originator:l,message:this,request:s})}_failed(l,s,a){vs.debug("OPTIONS failed"),this._close(),vs.debug('emit "failed"'),this.emit("failed",{originator:l,response:s||null,cause:a})}_succeeded(l,s){vs.debug("OPTIONS succeeded"),this._close(),vs.debug('emit "succeeded"'),this.emit("succeeded",{originator:l,response:s})}}});var xr=W(Zi=>{var Ia=ae(),Or=ce(),Na=Re(),kt=new Ia("Socket");Zi.isSocket=f=>{if(Array.isArray(f))return!1;if(typeof f=="undefined")return kt.warn("undefined JsSIP.Socket instance"),!1;try{if(!Or.isString(f.url))throw kt.warn("missing or invalid JsSIP.Socket url property"),new Error("Missing or invalid JsSIP.Socket url property");if(!Or.isString(f.via_transport))throw kt.warn("missing or invalid JsSIP.Socket via_transport property"),new Error("Missing or invalid JsSIP.Socket via_transport property");if(Na.parse(f.sip_uri,"SIP_URI")===-1)throw kt.warn("missing or invalid JsSIP.Socket sip_uri property"),new Error("missing or invalid JsSIP.Socket sip_uri property")}catch(l){return!1}try{["connect","disconnect","send"].forEach(l=>{if(!Or.isFunction(f[l]))throw kt.warn("missing or invalid JsSIP.Socket method: ".concat(l)),new Error("Missing or invalid JsSIP.Socket method: ".concat(l))})}catch(l){return!1}return!0}});var su=W((ac,tu)=>{var Oa=ae(),xa=xr(),eu=le(),pe=new Oa("Transport"),Se={STATUS_CONNECTED:0,STATUS_CONNECTING:1,STATUS_DISCONNECTED:2,SOCKET_STATUS_READY:0,SOCKET_STATUS_ERROR:1,recovery_options:{min_interval:eu.CONNECTION_RECOVERY_MIN_INTERVAL,max_interval:eu.CONNECTION_RECOVERY_MAX_INTERVAL}};tu.exports=class{constructor(l,s=Se.recovery_options){pe.debug("new()"),this.status=Se.STATUS_DISCONNECTED,this.socket=null,this.sockets=[],this.recovery_options=s,this.recover_attempts=0,this.recovery_timer=null,this.close_requested=!1;try{this.textDecoder=new TextDecoder("utf8")}catch(a){pe.warn("cannot use TextDecoder: ".concat(a))}if(typeof l=="undefined")throw new TypeError("Invalid argument. undefined 'sockets' argument");l instanceof Array||(l=[l]),l.forEach(function(a){if(!xa.isSocket(a.socket))throw new TypeError("Invalid argument. invalid 'JsSIP.Socket' instance");if(a.weight&&!Number(a.weight))throw new TypeError("Invalid argument. 'weight' attribute is not a number");this.sockets.push({socket:a.socket,weight:a.weight||0,status:Se.SOCKET_STATUS_READY})},this),this._getSocket()}get via_transport(){return this.socket.via_transport}get url(){return this.socket.url}get sip_uri(){return this.socket.sip_uri}connect(){if(pe.debug("connect()"),this.isConnected()){pe.debug("Transport is already connected");return}else if(this.isConnecting()){pe.debug("Transport is connecting");return}this.close_requested=!1,this.status=Se.STATUS_CONNECTING,this.onconnecting({socket:this.socket,attempts:this.recover_attempts}),this.close_requested||(this.socket.onconnect=this._onConnect.bind(this),this.socket.ondisconnect=this._onDisconnect.bind(this),this.socket.ondata=this._onData.bind(this),this.socket.connect())}disconnect(){pe.debug("close()"),this.close_requested=!0,this.recover_attempts=0,this.status=Se.STATUS_DISCONNECTED,this.recovery_timer!==null&&(clearTimeout(this.recovery_timer),this.recovery_timer=null),this.socket.onconnect=()=>{},this.socket.ondisconnect=()=>{},this.socket.ondata=()=>{},this.socket.disconnect(),this.ondisconnect({socket:this.socket,error:!1})}send(l){if(pe.debug("send()"),!this.isConnected())return pe.warn("unable to send message, transport is not connected"),!1;let s=l.toString();return pe.debug("sending message:\n\n".concat(s,"\n")),this.socket.send(s)}isConnected(){return this.status===Se.STATUS_CONNECTED}isConnecting(){return this.status===Se.STATUS_CONNECTING}_reconnect(){this.recover_attempts+=1;let l=Math.floor(Math.random()*Math.pow(2,this.recover_attempts)+1);l<this.recovery_options.min_interval?l=this.recovery_options.min_interval:l>this.recovery_options.max_interval&&(l=this.recovery_options.max_interval),pe.debug("reconnection attempt: ".concat(this.recover_attempts,". next connection attempt in ").concat(l," seconds")),this.recovery_timer=setTimeout(()=>{!this.close_requested&&!(this.isConnected()||this.isConnecting())&&(this._getSocket(),this.connect())},l*1e3)}_getSocket(){let l=[];if(this.sockets.forEach(a=>{a.status!==Se.SOCKET_STATUS_ERROR&&(l.length===0?l.push(a):a.weight>l[0].weight?l=[a]:a.weight===l[0].weight&&l.push(a))}),l.length===0){this.sockets.forEach(a=>{a.status=Se.SOCKET_STATUS_READY}),this._getSocket();return}let s=Math.floor(Math.random()*l.length);this.socket=l[s].socket}_onConnect(){this.recover_attempts=0,this.status=Se.STATUS_CONNECTED,this.recovery_timer!==null&&(clearTimeout(this.recovery_timer),this.recovery_timer=null),this.onconnect({socket:this})}_onDisconnect(l,s,a){this.status=Se.STATUS_DISCONNECTED,this.ondisconnect({socket:this.socket,error:l,code:s,reason:a}),!this.close_requested&&(this.sockets.forEach(function(h){this.socket===h.socket&&(h.status=Se.SOCKET_STATUS_ERROR)},this),this._reconnect(l))}_onData(l){if(l==="\r\n\r\n"){pe.debug("received message with double-CRLF Keep Alive request");try{this.socket.send("\r\n")}catch(s){pe.warn("error sending Keep Alive response: ".concat(s))}return}if(l==="\r\n"){pe.debug("received message with CRLF Keep Alive response");return}else if(typeof l!="string"){try{this.textDecoder?l=this.textDecoder.decode(l):l=String.fromCharCode.apply(null,new Uint8Array(l))}catch(s){pe.debug("received binary message failed to be converted into string: ".concat(s));return}pe.debug("received binary message:\n\n".concat(l,"\n"))}else pe.debug("received text message:\n\n".concat(l,"\n"));this.ondata({transport:this,message:l})}}});var lu=W(ru=>{var Da=ae(),Dr=Re(),Ur=xe(),Rs=new Da("Parser");ru.parseMessage=(f,l)=>{let s,a,h=f.indexOf("\r\n");if(h===-1){Rs.warn("parseMessage() | no CRLF found, not a SIP message");return}let t=f.substring(0,h),u=Dr.parse(t,"Request_Response");if(u===-1){Rs.warn('parseMessage() | error parsing first line of SIP message: "'.concat(t,'"'));return}else u.status_code?(s=new Ur.IncomingResponse,s.status_code=u.status_code,s.reason_phrase=u.reason_phrase):(s=new Ur.IncomingRequest(l),s.method=u.method,s.ruri=u.uri);s.data=f;let p=h+2;for(;;){if(h=Ua(f,p),h===-2){a=p+2;break}else if(h===-1){Rs.warn("parseMessage() | malformed message");return}if(u=Pa(s,f,p,h),u!==!0){Rs.warn("parseMessage() |",u.error);return}p=h+2}if(s.hasHeader("content-length")){let g=s.getHeader("content-length");s.body=f.substr(a,g)}else s.body=f.substring(a);return s};function Ua(f,l){let s=l,a=0,h=0;if(f.substring(s,s+2).match(/(^\r\n)/))return-2;for(;a===0;){if(h=f.indexOf("\r\n",s),h===-1)return h;!f.substring(h+2,h+4).match(/(^\r\n)/)&&f.charAt(h+2).match(/(^\s+)/)?s=h+2:a=h}return a}function Pa(f,l,s,a){let h,t=l.indexOf(":",s),u=l.substring(s,t).trim(),p=l.substring(t+1,a).trim();switch(u.toLowerCase()){case"via":case"v":f.addHeader("via",p),f.getHeaders("via").length===1?(h=f.parseHeader("Via"),h&&(f.via=h,f.via_branch=h.branch)):h=0;break;case"from":case"f":f.setHeader("from",p),h=f.parseHeader("from"),h&&(f.from=h,f.from_tag=h.getParam("tag"));break;case"to":case"t":f.setHeader("to",p),h=f.parseHeader("to"),h&&(f.to=h,f.to_tag=h.getParam("tag"));break;case"record-route":if(h=Dr.parse(p,"Record_Route"),h===-1)h=void 0;else for(let g of h)f.addHeader("record-route",p.substring(g.possition,g.offset)),f.headers["Record-Route"][f.getHeaders("record-route").length-1].parsed=g.parsed;break;case"call-id":case"i":f.setHeader("call-id",p),h=f.parseHeader("call-id"),h&&(f.call_id=p);break;case"contact":case"m":if(h=Dr.parse(p,"Contact"),h===-1)h=void 0;else for(let g of h)f.addHeader("contact",p.substring(g.possition,g.offset)),f.headers.Contact[f.getHeaders("contact").length-1].parsed=g.parsed;break;case"content-length":case"l":f.setHeader("content-length",p),h=f.parseHeader("content-length");break;case"content-type":case"c":f.setHeader("content-type",p),h=f.parseHeader("content-type");break;case"cseq":f.setHeader("cseq",p),h=f.parseHeader("cseq"),h&&(f.cseq=h.value),f instanceof Ur.IncomingResponse&&(f.method=h.method);break;case"max-forwards":f.setHeader("max-forwards",p),h=f.parseHeader("max-forwards");break;case"www-authenticate":f.setHeader("www-authenticate",p),h=f.parseHeader("www-authenticate");break;case"proxy-authenticate":f.setHeader("proxy-authenticate",p),h=f.parseHeader("proxy-authenticate");break;case"session-expires":case"x":f.setHeader("session-expires",p),h=f.parseHeader("session-expires"),h&&(f.session_expires=h.expires,f.session_expires_refresher=h.refresher);break;case"refer-to":case"r":f.setHeader("refer-to",p),h=f.parseHeader("refer-to"),h&&(f.refer_to=h);break;case"replaces":f.setHeader("replaces",p),h=f.parseHeader("replaces"),h&&(f.replaces=h);break;case"event":case"o":f.setHeader("event",p),h=f.parseHeader("event"),h&&(f.event=h);break;default:f.addHeader(u,p),h=0}return h===void 0?{error:'error parsing header "'.concat(u,'"')}:!0}});var au=W((cc,ou)=>{var La=ae(),iu=le(),nu=xe(),Pr=ce(),Lr=new La("sanityCheck"),Ma=[Va],Fa=[qa,$a,ka,Ga],Ha=[Ba,Wa],X,Pe,uu;ou.exports=(f,l,s)=>{X=f,Pe=l,uu=s;for(let a of Ma)if(a()===!1)return!1;if(X instanceof nu.IncomingRequest){for(let a of Fa)if(a()===!1)return!1}else if(X instanceof nu.IncomingResponse){for(let a of Ha)if(a()===!1)return!1}return!0};function qa(){if(X.s("to").uri.scheme!=="sip")return Gt(416),!1}function $a(){if(!X.to_tag&&X.call_id.substr(0,5)===Pe.configuration.jssip_id)return Gt(482),!1}function ka(){let f=Pr.str_utf8_length(X.body),l=X.getHeader("content-length");if(f<l)return Gt(400),!1}function Ga(){let f=X.from_tag,l=X.call_id,s=X.cseq,a;if(!X.to_tag)if(X.method===iu.INVITE){if(Pe._transactions.ist[X.via_branch])return!1;for(let h in Pe._transactions.ist)if(Object.prototype.hasOwnProperty.call(Pe._transactions.ist,h)&&(a=Pe._transactions.ist[h],a.request.from_tag===f&&a.request.call_id===l&&a.request.cseq===s))return Gt(482),!1}else{if(Pe._transactions.nist[X.via_branch])return!1;for(let h in Pe._transactions.nist)if(Object.prototype.hasOwnProperty.call(Pe._transactions.nist,h)&&(a=Pe._transactions.nist[h],a.request.from_tag===f&&a.request.call_id===l&&a.request.cseq===s))return Gt(482),!1}}function Ba(){if(X.getHeaders("via").length>1)return Lr.debug("more than one Via header field present in the response, dropping the response"),!1}function Wa(){let f=Pr.str_utf8_length(X.body),l=X.getHeader("content-length");if(f<l)return Lr.debug("message body length is lower than the value in Content-Length header field, dropping the response"),!1}function Va(){let f=["from","to","call_id","cseq","via"];for(let l of f)if(!X.hasHeader(l))return Lr.debug("missing mandatory header field : ".concat(l,", dropping the response")),!1}function Gt(f){let l=X.getHeaders("via"),s,a="SIP/2.0 ".concat(f," ").concat(iu.REASON_PHRASE[f],"\r\n");for(let h of l)a+="Via: ".concat(h,"\r\n");s=X.getHeader("To"),X.to_tag||(s+=";tag=".concat(Pr.newTag())),a+="To: ".concat(s,"\r\n"),a+="From: ".concat(X.getHeader("From"),"\r\n"),a+="Call-ID: ".concat(X.call_id,"\r\n"),a+="CSeq: ".concat(X.cseq," ").concat(X.method,"\r\n"),a+="\r\n",uu.send(a)}});var cu=W(qr=>{var gt=ce(),st=le(),Mr=Re(),fu=qe(),Fr=xr(),Hr=He();qr.settings={authorization_user:null,password:null,realm:null,ha1:null,authorization_jwt:null,display_name:null,uri:null,contact_uri:null,instance_id:null,use_preloaded_route:!1,session_timers:!0,session_timers_refresh_method:st.UPDATE,session_timers_force_refresher:!1,no_answer_timeout:60,register:!0,register_expires:600,register_from_tag_trail:"",registrar_server:null,sockets:null,connection_recovery_max_interval:st.CONNECTION_RECOVERY_MAX_INTERVAL,connection_recovery_min_interval:st.CONNECTION_RECOVERY_MIN_INTERVAL,extra_headers:null,via_host:"".concat(gt.createRandomToken(12),".invalid")};var bs={mandatory:{sockets(f){let l=[];if(Fr.isSocket(f))l.push({socket:f});else if(Array.isArray(f)&&f.length)for(let s of f)Object.prototype.hasOwnProperty.call(s,"socket")&&Fr.isSocket(s.socket)?l.push(s):Fr.isSocket(s)&&l.push({socket:s});else return;return l},uri(f){/^sip:/i.test(f)||(f="".concat(st.SIP,":").concat(f));let l=fu.parse(f);if(l)return l.user?l:void 0}},optional:{authorization_user(f){if(Mr.parse('"'.concat(f,'"'),"quoted_string")!==-1)return f},authorization_jwt(f){if(typeof f=="string")return f},user_agent(f){if(typeof f=="string")return f},connection_recovery_max_interval(f){if(gt.isDecimal(f)){let l=Number(f);if(l>0)return l}},connection_recovery_min_interval(f){if(gt.isDecimal(f)){let l=Number(f);if(l>0)return l}},contact_uri(f){if(typeof f=="string"){let l=Mr.parse(f,"SIP_URI");if(l!==-1)return l}},display_name(f){return f},instance_id(f){if(/^uuid:/i.test(f)&&(f=f.substr(5)),Mr.parse(f,"uuid")!==-1)return f},no_answer_timeout(f){if(gt.isDecimal(f)){let l=Number(f);if(l>0)return l}},session_timers(f){if(typeof f=="boolean")return f},session_timers_refresh_method(f){if(typeof f=="string"&&(f=f.toUpperCase(),f===st.INVITE||f===st.UPDATE))return f},session_timers_force_refresher(f){if(typeof f=="boolean")return f},password(f){return String(f)},realm(f){return String(f)},ha1(f){return String(f)},register(f){if(typeof f=="boolean")return f},register_expires(f){if(gt.isDecimal(f)){let l=Number(f);if(l>=0)return l}},register_from_tag_trail(f){return typeof f=="function"?f:String(f)},registrar_server(f){/^sip:/i.test(f)||(f="".concat(st.SIP,":").concat(f));let l=fu.parse(f);if(l)return l.user?void 0:l},use_preloaded_route(f){if(typeof f=="boolean")return f},extra_headers(f){let l=[];if(Array.isArray(f)&&f.length)for(let s of f)typeof s=="string"&&l.push(s);else return;return l}}};qr.load=(f,l)=>{for(let s in bs.mandatory)if(l.hasOwnProperty(s)){let a=l[s],h=bs.mandatory[s](a);if(h!==void 0)f[s]=h;else throw new Hr.ConfigurationError(s,a)}else throw new Hr.ConfigurationError(s);for(let s in bs.optional)if(l.hasOwnProperty(s)){let a=l[s];if(gt.isEmpty(a))continue;let h=bs.optional[s](a);if(h!==void 0)f[s]=h;else throw new Hr.ConfigurationError(s,a)}}});var mu=W((_c,pu)=>{var ja=$e().EventEmitter,Ka=ae(),de=le(),Ya=bi(),hu=yr(),du=zi(),_u=Qi(),$r=_t(),za=su(),ws=ce(),Ja=He(),Xa=qe(),Qa=lu(),kr=xe(),Za=au(),Gr=cu(),Q=new Ka("UA"),_e={STATUS_INIT:0,STATUS_READY:1,STATUS_USER_CLOSED:2,STATUS_NOT_READY:3,CONFIGURATION_ERROR:1,NETWORK_ERROR:2};pu.exports=class extends ja{static get C(){return _e}constructor(l){if(!l)throw new TypeError("Not enough arguments");let s=["password","ha1","authorization_jwt"];Q.debug("new() [configuration:%o]",Object.entries(l).filter(([a])=>!s.includes(a))),super(),this._cache={credentials:{}},this._configuration=Object.assign({},Gr.settings),this._dynConfiguration={},this._dialogs={},this._applicants={},this._sessions={},this._transport=null,this._contact=null,this._status=_e.STATUS_INIT,this._error=null,this._transactions={nist:{},nict:{},ist:{},ict:{}},this._data={},this._closeTimer=null;try{this._loadConfig(l)}catch(a){throw this._status=_e.STATUS_NOT_READY,this._error=_e.CONFIGURATION_ERROR,a}this._registrator=new Ya(this)}get C(){return _e}get status(){return this._status}get contact(){return this._contact}get configuration(){return this._configuration}get transport(){return this._transport}start(){Q.debug("start()"),this._status===_e.STATUS_INIT?this._transport.connect():this._status===_e.STATUS_USER_CLOSED?(Q.debug("restarting UA"),this._closeTimer!==null&&(clearTimeout(this._closeTimer),this._closeTimer=null,this._transport.disconnect()),this._status=_e.STATUS_INIT,this._transport.connect()):this._status===_e.STATUS_READY?Q.debug("UA is in READY status, not restarted"):Q.debug("ERROR: connection is down, Auto-Recovery system is trying to reconnect"),this._dynConfiguration.register=this._configuration.register}register(){Q.debug("register()"),this._dynConfiguration.register=!0,this._registrator.register()}unregister(l){Q.debug("unregister()"),this._dynConfiguration.register=!1,this._registrator.unregister(l)}registrator(){return this._registrator}isRegistered(){return this._registrator.registered}isConnected(){return this._transport.isConnected()}call(l,s){Q.debug("call()");let a=new hu(this);return a.connect(l,s),a}sendMessage(l,s,a){Q.debug("sendMessage()");let h=new du(this);return h.send(l,s,a),h}sendOptions(l,s,a){Q.debug("sendOptions()");let h=new _u(this);return h.send(l,s,a),h}terminateSessions(l){Q.debug("terminateSessions()");for(let s in this._sessions)this._sessions[s].isEnded()||this._sessions[s].terminate(l)}stop(){if(Q.debug("stop()"),this._dynConfiguration={},this._status===_e.STATUS_USER_CLOSED){Q.debug("UA already closed");return}this._registrator.close();let l=Object.keys(this._sessions).length;for(let a in this._sessions)if(Object.prototype.hasOwnProperty.call(this._sessions,a)){Q.debug("closing session ".concat(a));try{this._sessions[a].terminate()}catch(h){}}for(let a in this._applicants)if(Object.prototype.hasOwnProperty.call(this._applicants,a))try{this._applicants[a].close()}catch(h){}this._status=_e.STATUS_USER_CLOSED,Object.keys(this._transactions.nict).length+Object.keys(this._transactions.nist).length+Object.keys(this._transactions.ict).length+Object.keys(this._transactions.ist).length===0&&l===0?this._transport.disconnect():this._closeTimer=setTimeout(()=>{this._closeTimer=null,this._transport.disconnect()},2e3)}normalizeTarget(l){return ws.normalizeTarget(l,this._configuration.hostport_params)}get(l){switch(l){case"authorization_user":return this._configuration.authorization_user;case"realm":return this._configuration.realm;case"ha1":return this._configuration.ha1;case"authorization_jwt":return this._configuration.authorization_jwt;default:Q.warn('get() | cannot get "%s" parameter in runtime',l);return}}set(l,s){switch(l){case"authorization_user":{this._configuration.authorization_user=String(s);break}case"password":{this._configuration.password=String(s);break}case"realm":{this._configuration.realm=String(s);break}case"ha1":{this._configuration.ha1=String(s),this._configuration.password=null;break}case"authorization_jwt":{this._configuration.authorization_jwt=String(s);break}case"display_name":{this._configuration.display_name=s;break}case"extra_headers":{this._configuration.extra_headers=s;break}default:return Q.warn('set() | cannot set "%s" parameter in runtime',l),!1}return!0}newTransaction(l){this._transactions[l.type][l.id]=l,this.emit("newTransaction",{transaction:l})}destroyTransaction(l){delete this._transactions[l.type][l.id],this.emit("transactionDestroyed",{transaction:l})}newDialog(l){this._dialogs[l.id]=l}destroyDialog(l){delete this._dialogs[l.id]}newMessage(l,s){this._applicants[l]=l,this.emit("newMessage",s)}newOptions(l,s){this._applicants[l]=l,this.emit("newOptions",s)}destroyMessage(l){delete this._applicants[l]}newRTCSession(l,s){this._sessions[l.id]=l,this.emit("newRTCSession",s)}destroyRTCSession(l){delete this._sessions[l.id]}registered(l){this.emit("registered",l)}unregistered(l){this.emit("unregistered",l)}registrationFailed(l){this.emit("registrationFailed",l)}receiveRequest(l){let s=l.method;if(l.ruri.user!==this._configuration.uri.user&&l.ruri.user!==this._contact.uri.user){Q.debug("Request-URI does not point to us"),l.method!==de.ACK&&l.reply_sl(404);return}if(l.ruri.scheme===de.SIPS){l.reply_sl(416);return}if($r.checkTransaction(this,l))return;if(s===de.INVITE?new $r.InviteServerTransaction(this,this._transport,l):s!==de.ACK&&s!==de.CANCEL&&new $r.NonInviteServerTransaction(this,this._transport,l),s===de.OPTIONS){if(this.listeners("newOptions").length===0){l.reply(200);return}new _u(this).init_incoming(l)}else if(s===de.MESSAGE){if(this.listeners("newMessage").length===0){l.reply(405);return}new du(this).init_incoming(l)}else if(s===de.INVITE&&!l.to_tag&&this.listeners("newRTCSession").length===0){l.reply(405);return}let a,h;if(l.to_tag)a=this._findDialog(l.call_id,l.from_tag,l.to_tag),a?a.receiveRequest(l):s===de.NOTIFY?(h=this._findSession(l),h?h.receiveRequest(l):(Q.debug("received NOTIFY request for a non existent subscription"),l.reply(481,"Subscription does not exist"))):s!==de.ACK&&l.reply(481);else switch(s){case de.INVITE:if(window.RTCPeerConnection)if(l.hasHeader("replaces")){let t=l.replaces;a=this._findDialog(t.call_id,t.from_tag,t.to_tag),a?(h=a.owner,h.isEnded()?l.reply(603):h.receiveRequest(l)):l.reply(481)}else h=new hu(this),h.init_incoming(l);else Q.warn("INVITE received but WebRTC is not supported"),l.reply(488);break;case de.BYE:l.reply(481);break;case de.CANCEL:h=this._findSession(l),h?h.receiveRequest(l):Q.debug("received CANCEL request for a non existent session");break;case de.ACK:break;case de.NOTIFY:this.emit("sipEvent",{event:l.event,request:l}),l.reply(200);break;default:l.reply(405);break}}_findSession({call_id:l,from_tag:s,to_tag:a}){let h=l+s,t=this._sessions[h],u=l+a,p=this._sessions[u];return t||p||null}_findDialog(l,s,a){let h=l+s+a,t=this._dialogs[h];return t||(h=l+a+s,t=this._dialogs[h],t||null)}_loadConfig(l){Gr.load(this._configuration,l),this._configuration.display_name===0&&(this._configuration.display_name="0"),this._configuration.instance_id||(this._configuration.instance_id=ws.newUUID()),this._configuration.jssip_id=ws.createRandomToken(5);let s=this._configuration.uri.clone();s.user=null,this._configuration.hostport_params=s.toString().replace(/^sip:/i,"");try{this._transport=new za(this._configuration.sockets,{max_interval:this._configuration.connection_recovery_max_interval,min_interval:this._configuration.connection_recovery_min_interval}),this._transport.onconnecting=ef.bind(this),this._transport.onconnect=tf.bind(this),this._transport.ondisconnect=sf.bind(this),this._transport.ondata=rf.bind(this)}catch(h){throw Q.warn(h),new Ja.ConfigurationError("sockets",this._configuration.sockets)}if(delete this._configuration.sockets,this._configuration.authorization_user||(this._configuration.authorization_user=this._configuration.uri.user),!this._configuration.registrar_server){let h=this._configuration.uri.clone();h.user=null,h.clearParams(),h.clearHeaders(),this._configuration.registrar_server=h}this._configuration.no_answer_timeout*=1e3,this._configuration.contact_uri?this._configuration.via_host=this._configuration.contact_uri.host:this._configuration.contact_uri=new Xa("sip",ws.createRandomToken(8),this._configuration.via_host,null,{transport:"ws"}),this._contact={pub_gruu:null,temp_gruu:null,uri:this._configuration.contact_uri,toString(h={}){let t=h.anonymous||null,u=h.outbound||null,p="<";return t?p+=this.temp_gruu||"sip:anonymous@anonymous.invalid;transport=ws":p+=this.pub_gruu||this.uri.toString(),u&&(t?!this.temp_gruu:!this.pub_gruu)&&(p+=";ob"),p+=">",p}};let a=["authorization_user","password","realm","ha1","authorization_jwt","display_name","register","extra_headers"];for(let h in this._configuration)Object.prototype.hasOwnProperty.call(this._configuration,h)&&(a.indexOf(h)!==-1?Object.defineProperty(this._configuration,h,{writable:!0,configurable:!1}):Object.defineProperty(this._configuration,h,{writable:!1,configurable:!1}));Q.debug("configuration parameters after validation:");for(let h in this._configuration)if(Object.prototype.hasOwnProperty.call(Gr.settings,h))switch(h){case"uri":case"registrar_server":Q.debug("- ".concat(h,": ").concat(this._configuration[h]));break;case"password":case"ha1":case"authorization_jwt":Q.debug("- ".concat(h,": NOT SHOWN"));break;default:Q.debug("- ".concat(h,": ").concat(JSON.stringify(this._configuration[h])))}}};function ef(f){this.emit("connecting",f)}function tf(f){this._status!==_e.STATUS_USER_CLOSED&&(this._status=_e.STATUS_READY,this._error=null,this.emit("connected",f),this._dynConfiguration.register&&this._registrator.register())}function sf(f){let l=["nict","ict","nist","ist"];for(let s of l)for(let a in this._transactions[s])Object.prototype.hasOwnProperty.call(this._transactions[s],a)&&this._transactions[s][a].onTransportError();this.emit("disconnected",f),this._registrator.onTransportClosed(),this._status!==_e.STATUS_USER_CLOSED&&(this._status=_e.STATUS_NOT_READY,this._error=_e.NETWORK_ERROR)}function rf(f){let l=f.transport,s=f.message;if(s=Qa.parseMessage(s,this),!!s&&!(this._status===_e.STATUS_USER_CLOSED&&s instanceof kr.IncomingRequest)&&Za(s,this,l)){if(s instanceof kr.IncomingRequest)s.transport=l,this.receiveRequest(s);else if(s instanceof kr.IncomingResponse){let a;switch(s.method){case de.INVITE:a=this._transactions.ict[s.via_branch],a&&a.receiveResponse(s);break;case de.ACK:break;default:a=this._transactions.nict[s.via_branch],a&&a.receiveResponse(s);break}}}}});var Tu=W((mc,gu)=>{var lf=ae(),nf=Re(),me=new lf("WebSocketInterface");gu.exports=class{constructor(l){me.debug('new() [url:"%s"]',l),this._url=l,this._sip_uri=null,this._via_transport=null,this._ws=null;let s=nf.parse(l,"absoluteURI");if(s===-1)throw me.warn("invalid WebSocket URI: ".concat(l)),new TypeError("Invalid argument: ".concat(l));if(s.scheme!=="wss"&&s.scheme!=="ws")throw me.warn("invalid WebSocket URI scheme: ".concat(s.scheme)),new TypeError("Invalid argument: ".concat(l));this._sip_uri="sip:".concat(s.host).concat(s.port?":".concat(s.port):"",";transport=ws"),this._via_transport=s.scheme.toUpperCase()}get via_transport(){return this._via_transport}set via_transport(l){this._via_transport=l.toUpperCase()}get sip_uri(){return this._sip_uri}get url(){return this._url}connect(){if(me.debug("connect()"),this.isConnected()){me.debug("WebSocket ".concat(this._url," is already connected"));return}else if(this.isConnecting()){me.debug("WebSocket ".concat(this._url," is connecting"));return}this._ws&&this.disconnect(),me.debug("connecting to WebSocket ".concat(this._url));try{this._ws=new WebSocket(this._url,"sip"),this._ws.binaryType="arraybuffer",this._ws.onopen=this._onOpen.bind(this),this._ws.onclose=this._onClose.bind(this),this._ws.onmessage=this._onMessage.bind(this),this._ws.onerror=this._onError.bind(this)}catch(l){this._onError(l)}}disconnect(){me.debug("disconnect()"),this._ws&&(this._ws.onopen=()=>{},this._ws.onclose=()=>{},this._ws.onmessage=()=>{},this._ws.onerror=()=>{},this._ws.close(),this._ws=null)}send(l){return me.debug("send()"),this.isConnected()?(this._ws.send(l),!0):(me.warn("unable to send message, WebSocket is not open"),!1)}isConnected(){return this._ws&&this._ws.readyState===this._ws.OPEN}isConnecting(){return this._ws&&this._ws.readyState===this._ws.CONNECTING}_onOpen(){me.debug("WebSocket ".concat(this._url," connected")),this.onconnect()}_onClose({wasClean:l,code:s,reason:a}){me.debug("WebSocket ".concat(this._url," closed")),l===!1&&me.debug("WebSocket abrupt disconnection"),this.ondisconnect(!l,s,a)}_onMessage({data:l}){me.debug("received WebSocket message"),this.ondata(l)}_onError(l){me.warn("WebSocket ".concat(this._url," error: "),l)}}});var gf=W((gc,Cu)=>{var Br=er(),uf=le(),of=He(),af=ce(),ff=mu(),cf=qe(),hf=us(),df=Re(),_f=Tu(),pf=hs()("JsSIP"),mf=yr();pf("version %s",Br.version);Cu.exports={C:uf,Exceptions:of,Utils:af,UA:ff,URI:cf,NameAddrHeader:hf,WebSocketInterface:_f,Grammar:df,RTCSession:mf,debug:hs(),get name(){return Br.title},get version(){return Br.version}}});return gf();})();
